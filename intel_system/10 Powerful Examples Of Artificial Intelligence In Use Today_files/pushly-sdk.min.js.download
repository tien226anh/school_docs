/*! For license information please see pushly-sdk.min.js.LICENSE */
(()=>{var t={"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/sdk/styles/bell.scss":(s,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>o});var e=t("./node_modules/css-loader/dist/runtime/sourceMaps.js"),e=t.n(e),i=t("./node_modules/css-loader/dist/runtime/api.js"),t=t.n(i)()(e());t.push([s.id,"@media print {\n  .pushly_bell {\n    display: none !important;\n  }\n}\n.pushly_bell {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  /* desktop positioning */\n  /* mobile positioning */\n}\n.pushly_bell:not(.managed) {\n  position: fixed;\n  z-index: 1000000;\n  transition: all 0.5s ease;\n}\n.pushly_bell.subscribed .pushly_bell-tooltip-notsubscribed {\n  display: none;\n}\n.pushly_bell.subscribed svg {\n  opacity: 0.7;\n}\n.pushly_bell:not(.subscribed) .pushly_bell-tooltip-subscribed {\n  display: none;\n}\n.pushly_bell.hover svg {\n  opacity: 0.7;\n}\n.pushly_bell.hover .pushly_bell-tooltip {\n  opacity: 1;\n}\n.pushly_bell svg {\n  z-index: 1;\n  transition: all 0.5s ease;\n  box-shadow: 0px 1px 3px #888;\n  border-radius: 1000px;\n  cursor: pointer;\n}\n.pushly_bell .pushly_bell-tooltip {\n  transition: all 0.5s ease;\n  position: relative;\n  opacity: 0;\n  pointer-events: none;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  margin-right: 7.5px;\n  margin-left: 7.5px;\n}\n.pushly_bell .pushly_bell-tooltip .pushly_bell-tooltip-text {\n  padding: 8px 16px;\n  border-radius: 3px;\n  font-size: 13px;\n}\n.pushly_bell .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n  position: relative;\n  width: 15px;\n  height: 15px;\n  border-radius: 1px;\n  transform: rotate(45deg);\n}\n@media screen and (min-width: 768px) {\n  .pushly_bell.d-top-left {\n    top: 40px;\n    left: -200px;\n  }\n  .pushly_bell.d-top-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.d-top-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.d-top-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.d-top-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.d-top-right {\n    top: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-top-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.d-top-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-top-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.d-top-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.d-bottom-left {\n    bottom: 40px;\n    left: -200px;\n  }\n  .pushly_bell.d-bottom-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.d-bottom-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.d-bottom-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.d-bottom-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.d-bottom-right {\n    bottom: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-bottom-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.d-bottom-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.d-bottom-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.d-bottom-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.d-disabled {\n    display: none;\n  }\n}\n@media screen and (max-width: 768px) {\n  .pushly_bell.m-top-left {\n    top: 40px;\n    left: -200px;\n  }\n  .pushly_bell.m-top-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.m-top-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.m-top-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.m-top-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.m-top-right {\n    top: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-top-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.m-top-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-top-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.m-top-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.m-bottom-left {\n    bottom: 40px;\n    left: -200px;\n  }\n  .pushly_bell.m-bottom-left.hover .pushly_bell-tooltip {\n    left: 0;\n  }\n  .pushly_bell.m-bottom-left .pushly_bell-tooltip {\n    left: -30px;\n  }\n  .pushly_bell.m-bottom-left .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    left: 7.5px;\n  }\n  .pushly_bell.m-bottom-left.pushly-prompt-visible {\n    left: 40px;\n  }\n  .pushly_bell.m-bottom-right {\n    bottom: 40px;\n    right: -200px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-bottom-right.hover .pushly_bell-tooltip {\n    right: 0;\n  }\n  .pushly_bell.m-bottom-right .pushly_bell-tooltip {\n    right: -30px;\n    flex-direction: row-reverse;\n  }\n  .pushly_bell.m-bottom-right .pushly_bell-tooltip .pushly_bell-tooltip-arrow {\n    right: 7.5px;\n  }\n  .pushly_bell.m-bottom-right.pushly-prompt-visible {\n    right: 40px;\n  }\n  .pushly_bell.m-disabled {\n    display: none;\n  }\n}","",{version:3,sources:["webpack://./src/sdk/styles/bell.scss"],names:[],mappings:"AAKA;EACI;IACI,wBAAA;EAJN;AACF;AAOA;EACI,aAAA;EACA,mBAAA;EACA,mBAAA;EA4EA,wBAAA;EA0GA,uBAAA;AAzLJ;AAKI;EACI,eAAA;EACA,gBAAA;EACA,yBAAA;AAHR;AAOQ;EACI,aAAA;AALZ;AAQQ;EACI,YAAA;AANZ;AAWQ;EACI,aAAA;AATZ;AAcQ;EACI,YAAA;AAZZ;AAeQ;EACI,UAAA;AAbZ;AAiBI;EACI,UAAA;EACA,yBAAA;EACA,4BAAA;EACA,qBAAA;EACA,eAAA;AAfR;AAkBI;EACI,yBAAA;EAEA,kBAAA;EAEA,UAAA;EACA,oBAAA;EAEA,aAAA;EACA,mBAAA;EACA,mBAAA;EAEA,mBAAA;EACA,kBAAA;AApBR;AAsBQ;EACI,iBAAA;EACA,kBAAA;EAEA,eAAA;AArBZ;AAwBQ;EACI,kBAAA;EAEA,WA/EA;EAgFA,YAhFA;EAkFA,kBAAA;EAEA,wBAAA;AAzBZ;AA+BI;EACI;IACI,SAAA;IACA,YAAA;EA7BV;EAgCc;IACI,OAAA;EA9BlB;EAkCU;IACI,WAAA;EAhCd;EAkCc;IACI,WAAA;EAhClB;EAoCU;IACI,UAAA;EAlCd;EAsCM;IACI,SAAA;IACA,aAAA;IAEA,2BAAA;EArCV;EAwCc;IACI,QAAA;EAtClB;EA0CU;IACI,YAAA;IACA,2BAAA;EAxCd;EA0Cc;IACI,YAAA;EAxClB;EA4CU;IACI,WAAA;EA1Cd;EA8CM;IACI,YAAA;IACA,YAAA;EA5CV;EA+Cc;IACI,OAAA;EA7ClB;EAiDU;IACI,WAAA;EA/Cd;EAiDc;IACI,WAAA;EA/ClB;EAmDU;IACI,UAAA;EAjDd;EAqDM;IACI,YAAA;IACA,aAAA;IAEA,2BAAA;EApDV;EAuDc;IACI,QAAA;EArDlB;EAyDU;IACI,YAAA;IACA,2BAAA;EAvDd;EAyDc;IACI,YAAA;EAvDlB;EA2DU;IACI,WAAA;EAzDd;EA6DM;IACI,aAAA;EA3DV;AACF;AAgEI;EACI;IACI,SAAA;IACA,YAAA;EA9DV;EAiEc;IACI,OAAA;EA/DlB;EAmEU;IACI,WAAA;EAjEd;EAmEc;IACI,WAAA;EAjElB;EAqEU;IACI,UAAA;EAnEd;EAuEM;IACI,SAAA;IACA,aAAA;IAEA,2BAAA;EAtEV;EAyEc;IACI,QAAA;EAvElB;EA2EU;IACI,YAAA;IACA,2BAAA;EAzEd;EA2Ec;IACI,YAAA;EAzElB;EA6EU;IACI,WAAA;EA3Ed;EA+EM;IACI,YAAA;IACA,YAAA;EA7EV;EAgFc;IACI,OAAA;EA9ElB;EAkFU;IACI,WAAA;EAhFd;EAkFc;IACI,WAAA;EAhFlB;EAoFU;IACI,UAAA;EAlFd;EAsFM;IACI,YAAA;IACA,aAAA;IAEA,2BAAA;EArFV;EAwFc;IACI,QAAA;EAtFlB;EA0FU;IACI,YAAA;IACA,2BAAA;EAxFd;EA0Fc;IACI,YAAA;EAxFlB;EA4FU;IACI,WAAA;EA1Fd;EA8FM;IACI,aAAA;EA5FV;AACF",sourcesContent:['@import "variables";\n\n$arrowSize: 15px;\n$tooltipAnimationDisplacement: 30px;\n\n@media print {\n    .pushly_bell {\n        display: none !important;\n    }\n}\n\n.pushly_bell {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    &:not(.managed) {\n        position: fixed;\n        z-index: 1000000;\n        transition: all 0.5s ease;\n    }\n\n    &.subscribed {\n        .pushly_bell-tooltip-notsubscribed {\n            display: none;\n        }\n\n        svg {\n            opacity: 0.7;\n        }\n    }\n\n    &:not(.subscribed) {\n        .pushly_bell-tooltip-subscribed {\n            display: none;\n        }\n    }\n\n    &.hover {\n        svg {\n            opacity: 0.7;\n        }\n\n        .pushly_bell-tooltip {\n            opacity: 1;\n        }\n    }\n\n    svg {\n        z-index: 1;\n        transition: all 0.5s ease;\n        box-shadow: 0px 1px 3px #888;\n        border-radius: 1000px;\n        cursor: pointer;\n    }\n\n    .pushly_bell-tooltip {\n        transition: all 0.5s ease;\n\n        position: relative;\n\n        opacity: 0;\n        pointer-events: none;\n\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n\n        margin-right: calc($arrowSize/2);\n        margin-left: calc($arrowSize/2);\n\n        .pushly_bell-tooltip-text {\n            padding: 8px 16px;\n            border-radius: 3px;\n\n            font-size: 13px;\n        }\n\n        .pushly_bell-tooltip-arrow {\n            position: relative;\n\n            width: $arrowSize;\n            height: $arrowSize;\n\n            border-radius: 1px;\n\n            transform: rotate(45deg);\n        }\n    }\n\n    /* desktop positioning */\n\n    @media screen and (min-width: $mobile-max-size) {\n        &.d-top-left {\n            top: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.d-top-right {\n            top: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.d-bottom-left {\n            bottom: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.d-bottom-right {\n            bottom: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.d-disabled {\n            display: none;\n        }\n    }\n\n    /* mobile positioning */\n\n    @media screen and (max-width: $mobile-max-size) {\n        &.m-top-left {\n            top: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.m-top-right {\n            top: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.m-bottom-left {\n            bottom: 40px;\n            left: -200px;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    left: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                left: -$tooltipAnimationDisplacement;\n\n                .pushly_bell-tooltip-arrow {\n                    left: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                left: 40px;\n            }\n        }\n\n        &.m-bottom-right {\n            bottom: 40px;\n            right: -200px;\n\n            flex-direction: row-reverse;\n\n            &.hover {\n                .pushly_bell-tooltip {\n                    right: 0;\n                }\n            }\n\n            .pushly_bell-tooltip {\n                right: -$tooltipAnimationDisplacement;\n                flex-direction: row-reverse;\n\n                .pushly_bell-tooltip-arrow {\n                    right: calc($arrowSize/2);\n                }\n            }\n\n            &.pushly-prompt-visible {\n                right: 40px;\n            }\n        }\n\n        &.m-disabled {\n            display: none;\n        }\n    }\n}\n'],sourceRoot:""}]);const o=t},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/sdk/styles/popover.scss":(s,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>o});var e=t("./node_modules/css-loader/dist/runtime/sourceMaps.js"),e=t.n(e),i=t("./node_modules/css-loader/dist/runtime/api.js"),t=t.n(i)()(e());t.push([s.id,"@media print {\n  .pushly-prompt-window,\n  .pushly_popover {\n    display: none !important;\n  }\n}\n.pushly-prompt-window,\n.pushly_popover {\n  left: 0;\n  right: 0;\n  pointer-events: none;\n  /* theme: normal */\n  /* theme: stacked */\n  /* desktop positioning */\n  /* mobile positioning */\n}\n.pushly-prompt-window:not(.managed),\n.pushly_popover:not(.managed) {\n  position: fixed;\n  z-index: 1000000;\n  transition: all 0.5s ease;\n}\n.pushly-prompt-window .pushly-prompt-slide,\n.pushly-prompt-window .pushly_popover-box,\n.pushly_popover .pushly-prompt-slide,\n.pushly_popover .pushly_popover-box {\n  pointer-events: all;\n  margin: 0px auto;\n  box-sizing: border-box;\n  display: flex;\n  width: 400px;\n  padding: 16px;\n}\n.pushly-prompt-window .pushly-prompt-slide.pushly-prompt-visible,\n.pushly-prompt-window .pushly_popover-box.pushly-prompt-visible,\n.pushly_popover .pushly-prompt-slide.pushly-prompt-visible,\n.pushly_popover .pushly_popover-box.pushly-prompt-visible {\n  top: 0;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-icon,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-first,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-icon,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-first,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-icon,\n.pushly_popover .pushly-prompt-slide .pushly_popover-first,\n.pushly_popover .pushly_popover-box .pushly-prompt-icon,\n.pushly_popover .pushly_popover-box .pushly_popover-first {\n  position: relative;\n  max-width: 80px;\n  height: 80px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-icon img,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-first img,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-icon img,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-first img,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-icon img,\n.pushly_popover .pushly-prompt-slide .pushly_popover-first img,\n.pushly_popover .pushly_popover-box .pushly-prompt-icon img,\n.pushly_popover .pushly_popover-box .pushly_popover-first img {\n  width: 100%;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second,\n.pushly_popover .pushly_popover-box .pushly-prompt-content,\n.pushly_popover .pushly_popover-box .pushly_popover-second {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline {\n  font-size: 1em;\n  padding-top: 8px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-subheadline,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-subheadline {\n  font-size: 0.8em;\n  padding-top: 12px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-buttons {\n  margin-top: 16px;\n}\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions button,\n.pushly-prompt-window .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons button,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions button,\n.pushly-prompt-window .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons button,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions button,\n.pushly-prompt-window .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons button,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly-prompt-actions button,\n.pushly-prompt-window .pushly_popover-box .pushly_popover-second .pushly_popover-buttons button,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions button,\n.pushly_popover .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons button,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions button,\n.pushly_popover .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons button,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions button,\n.pushly_popover .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons button,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly-prompt-actions button,\n.pushly_popover .pushly_popover-box .pushly_popover-second .pushly_popover-buttons button {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 16px;\n  padding-right: 16px;\n  border: none;\n  font-size: 0.8em;\n  border-radius: 3px;\n  background: none;\n  cursor: pointer;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide,\n.pushly-prompt-window.normal .pushly_popover-box,\n.pushly_popover.normal .pushly-prompt-slide,\n.pushly_popover.normal .pushly_popover-box {\n  flex-direction: row;\n  justify-content: space-between;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second {\n  width: calc(100% - 80px);\n  padding-left: 16px;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-message .pushly_popover-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly-prompt-message-headline:first-child,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly_popover-message .pushly_popover-message-headline:first-child {\n  padding-top: 0 !important;\n}\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover.normal .pushly-prompt-slide .pushly_popover-second .pushly_popover-buttons,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly-prompt-actions,\n.pushly_popover.normal .pushly_popover-box .pushly-prompt-content .pushly_popover-buttons,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly-prompt-actions,\n.pushly_popover.normal .pushly_popover-box .pushly_popover-second .pushly_popover-buttons {\n  display: flex;\n  justify-content: flex-end;\n}\n.pushly-prompt-window.stacked .pushly-prompt-slide,\n.pushly-prompt-window.stacked .pushly_popover-box,\n.pushly_popover.stacked .pushly-prompt-slide,\n.pushly_popover.stacked .pushly_popover-box {\n  text-align: center;\n  flex-direction: column;\n  align-content: center;\n  align-items: center;\n}\n@media screen and (min-width: 768px) {\n  .pushly-prompt-window.d-top,\n  .pushly_popover.d-top {\n    top: -600px;\n    bottom: auto;\n  }\n  .pushly-prompt-window.d-top .pushly-prompt-slide,\n  .pushly-prompt-window.d-top .pushly_popover-box,\n  .pushly_popover.d-top .pushly-prompt-slide,\n  .pushly_popover.d-top .pushly_popover-box {\n    box-shadow: 0px 1px 1px #bbb;\n  }\n  .pushly-prompt-window.d-top.pushly-prompt-visible,\n  .pushly_popover.d-top.pushly-prompt-visible {\n    top: 0;\n  }\n  .pushly-prompt-window.d-bottom,\n  .pushly_popover.d-bottom {\n    bottom: -600px;\n    top: auto;\n  }\n  .pushly-prompt-window.d-bottom .pushly-prompt-slide,\n  .pushly-prompt-window.d-bottom .pushly_popover-box,\n  .pushly_popover.d-bottom .pushly-prompt-slide,\n  .pushly_popover.d-bottom .pushly_popover-box {\n    box-shadow: 0px -1px 1px #bbb;\n  }\n  .pushly-prompt-window.d-bottom.pushly-prompt-visible,\n  .pushly_popover.d-bottom.pushly-prompt-visible {\n    bottom: 0;\n  }\n  .pushly-prompt-window.d-disabled,\n  .pushly_popover.d-disabled {\n    display: none;\n  }\n}\n@media screen and (max-width: 768px) {\n  .pushly-prompt-window.m-top,\n  .pushly_popover.m-top {\n    top: -600px;\n    bottom: auto;\n  }\n  .pushly-prompt-window.m-top .pushly-prompt-slide,\n  .pushly-prompt-window.m-top .pushly_popover-box,\n  .pushly_popover.m-top .pushly-prompt-slide,\n  .pushly_popover.m-top .pushly_popover-box {\n    box-shadow: 0px 1px 1px #bbb;\n  }\n  .pushly-prompt-window.m-top.pushly-prompt-visible,\n  .pushly_popover.m-top.pushly-prompt-visible {\n    top: 0;\n  }\n  .pushly-prompt-window.m-bottom,\n  .pushly_popover.m-bottom {\n    bottom: -600px;\n    top: auto;\n  }\n  .pushly-prompt-window.m-bottom .pushly-prompt-slide,\n  .pushly-prompt-window.m-bottom .pushly_popover-box,\n  .pushly_popover.m-bottom .pushly-prompt-slide,\n  .pushly_popover.m-bottom .pushly_popover-box {\n    box-shadow: 0px -1px 1px #bbb;\n  }\n  .pushly-prompt-window.m-bottom.pushly-prompt-visible,\n  .pushly_popover.m-bottom.pushly-prompt-visible {\n    bottom: 0;\n  }\n  .pushly-prompt-window.m-disabled,\n  .pushly_popover.m-disabled {\n    display: none;\n  }\n}\n@media screen and (max-width: 480px) {\n  .pushly-prompt-window .pushly-prompt-slide,\n  .pushly-prompt-window .pushly_popover-box,\n  .pushly_popover .pushly-prompt-slide,\n  .pushly_popover .pushly_popover-box {\n    width: 100%;\n  }\n  .pushly-prompt-window .pushly-prompt-slide .pushly-prompt-icon,\n  .pushly-prompt-window .pushly-prompt-slide .pushly_popover-first,\n  .pushly-prompt-window .pushly_popover-box .pushly-prompt-icon,\n  .pushly-prompt-window .pushly_popover-box .pushly_popover-first,\n  .pushly_popover .pushly-prompt-slide .pushly-prompt-icon,\n  .pushly_popover .pushly-prompt-slide .pushly_popover-first,\n  .pushly_popover .pushly_popover-box .pushly-prompt-icon,\n  .pushly_popover .pushly_popover-box .pushly_popover-first {\n    max-width: calc(80px - 20px);\n    height: calc(80px - 20px);\n  }\n  .pushly-prompt-window.normal .pushly-prompt-slide .pushly-prompt-content,\n  .pushly-prompt-window.normal .pushly-prompt-slide .pushly_popover-second,\n  .pushly-prompt-window.normal .pushly_popover-box .pushly-prompt-content,\n  .pushly-prompt-window.normal .pushly_popover-box .pushly_popover-second,\n  .pushly_popover.normal .pushly-prompt-slide .pushly-prompt-content,\n  .pushly_popover.normal .pushly-prompt-slide .pushly_popover-second,\n  .pushly_popover.normal .pushly_popover-box .pushly-prompt-content,\n  .pushly_popover.normal .pushly_popover-box .pushly_popover-second {\n    width: calc(100% - 80px + 20px);\n  }\n  .pushly-prompt-window.m-disabled,\n  .pushly_popover.m-disabled {\n    display: none;\n  }\n}","",{version:3,sources:["webpack://./src/sdk/styles/popover.scss"],names:[],mappings:"AAMA;EACI;;IAEI,wBAAA;EALN;AACF;AAQA;;EAQI,OAAA;EACA,QAAA;EACA,oBAAA;EAkEA,kBAAA;EAiCA,mBAAA;EAYA,wBAAA;EAoCA,uBAAA;AA3JJ;AAAI;;EACI,eAAA;EACA,gBAAA;EACA,yBAAA;AAGR;AAII;;;;EAEI,mBAAA;EACA,gBAAA;EACA,sBAAA;EACA,aAAA;EACA,YA7BA;EA8BA,aA5BE;AA4BV;AAEQ;;;;EACI,MAAA;AAGZ;AAAQ;;;;;;;;EAEI,kBAAA;EACA,eAtCA;EAuCA,YAvCA;AA+CZ;AANY;;;;;;;;EACI,WAAA;AAehB;AAXQ;;;;;;;;EAEI,aAAA;EACA,sBAAA;EACA,8BAAA;AAmBZ;AAfgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEI,cAAA;EACA,gBAAA;AA+CpB;AA5CgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEI,gBAAA;EACA,iBAAA;AA4EpB;AAxEY;;;;;;;;;;;;;;;;EAEI,gBApEN;AA4JV;AAtFgB;;;;;;;;;;;;;;;;EACI,gBAAA;EACA,mBAAA;EACA,kBAAA;EACA,mBAAA;EACA,YAAA;EACA,gBAAA;EACA,kBAAA;EACA,gBAAA;EACA,eAAA;AAuGpB;AA9FQ;;;;EAEI,mBAAA;EACA,8BAAA;AAkGZ;AAhGY;;;;;;;;EAGI,wBAAA;EACA,kBAjGN;AAwMV;AAjGwB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EACI,yBAAA;AAkI5B;AA7HgB;;;;;;;;;;;;;;;;EAEI,aAAA;EACA,yBAAA;AA6IpB;AApIQ;;;;EAEI,kBAAA;EACA,sBAAA;EACA,qBAAA;EACA,mBAAA;AAwIZ;AAlII;EACI;;IACI,WAAA;IACA,YAAA;EAqIV;EAnIU;;;;IAEI,4BAAA;EAuId;EApIU;;IACI,MAAA;EAuId;EAnIM;;IACI,cAAA;IACA,SAAA;EAsIV;EApIU;;;;IAEI,6BAAA;EAwId;EArIU;;IACI,SAAA;EAwId;EApIM;;IACI,aAAA;EAuIV;AACF;AAlII;EACI;;IACI,WAAA;IACA,YAAA;EAqIV;EAnIU;;;;IAEI,4BAAA;EAuId;EApIU;;IACI,MAAA;EAuId;EAnIM;;IACI,cAAA;IACA,SAAA;EAsIV;EApIU;;;;IAEI,6BAAA;EAwId;EArIU;;IACI,SAAA;EAwId;EApIM;;IACI,aAAA;EAuIV;AACF;AApII;EACI;;;;IAEI,WAAA;EAwIV;EAtIU;;;;;;;;IAEI,4BAAA;IACA,yBAAA;EA8Id;EAvIc;;;;;;;;IAEI,+BAAA;EA+IlB;EA1IM;;IACI,aAAA;EA6IV;AACF",sourcesContent:['@import "variables";\n\n$width: 400px;\n$imageSize: 80px;\n$padding: 16px;\n\n@media print {\n    .pushly-prompt-window,\n    .pushly_popover {\n        display: none !important;\n    }\n}\n\n.pushly-prompt-window,\n.pushly_popover {\n    &:not(.managed) {\n        position: fixed;\n        z-index: 1000000;\n        transition: all 0.5s ease;\n    }\n\n    left: 0;\n    right: 0;\n    pointer-events: none;\n\n    .pushly-prompt-slide,\n    .pushly_popover-box {\n        pointer-events: all;\n        margin: 0px auto;\n        box-sizing: border-box;\n        display: flex;\n        width: $width;\n        padding: $padding;\n\n        &.pushly-prompt-visible {\n            top: 0;\n        }\n\n        .pushly-prompt-icon,\n        .pushly_popover-first {\n            position: relative;\n            max-width: $imageSize;\n            height: $imageSize;\n\n            img {\n                width: 100%;\n            }\n        }\n\n        .pushly-prompt-content,\n        .pushly_popover-second {\n            display: flex;\n            flex-direction: column;\n            justify-content: space-between;\n\n            .pushly-prompt-message,\n            .pushly_popover-message {\n                .pushly-prompt-message-headline,\n                .pushly_popover-message-headline {\n                    font-size: 1em;\n                    padding-top: 8px;\n                }\n\n                .pushly-prompt-message-subheadline,\n                .pushly_popover-message-subheadline {\n                    font-size: 0.8em;\n                    padding-top: 12px;\n                }\n            }\n\n            .pushly-prompt-actions,\n            .pushly_popover-buttons {\n                margin-top: $padding;\n\n                button {\n                    padding-top: 8px;\n                    padding-bottom: 8px;\n                    padding-left: 16px;\n                    padding-right: 16px;\n                    border: none;\n                    font-size: 0.8em;\n                    border-radius: 3px;\n                    background: none;\n                    cursor: pointer;\n                }\n            }\n        }\n    }\n\n    /* theme: normal */\n\n    &.normal {\n        .pushly-prompt-slide,\n        .pushly_popover-box {\n            flex-direction: row;\n            justify-content: space-between;\n\n            .pushly-prompt-content,\n            .pushly_popover-second {\n                //width: calc(#{$width} - #{$imageSize} - #{$padding*3});\n                width: calc(100% - #{$imageSize});\n                padding-left: $padding;\n\n                .pushly-prompt-message,\n                .pushly_popover-message {\n                    .pushly-prompt-message-headline,\n                    .pushly_popover-message-headline {\n                        &:first-child {\n                            padding-top: 0 !important;\n                        }\n                    }\n                }\n\n                .pushly-prompt-actions,\n                .pushly_popover-buttons {\n                    display: flex;\n                    justify-content: flex-end;\n                }\n            }\n        }\n    }\n\n    /* theme: stacked */\n\n    &.stacked {\n        .pushly-prompt-slide,\n        .pushly_popover-box {\n            text-align: center;\n            flex-direction: column;\n            align-content: center;\n            align-items: center;\n        }\n    }\n\n    /* desktop positioning */\n\n    @media screen and (min-width: $mobile-max-size) {\n        &.d-top {\n            top: -600px;\n            bottom: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px 1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                top: 0;\n            }\n        }\n\n        &.d-bottom {\n            bottom: -600px;\n            top: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px -1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                bottom: 0;\n            }\n        }\n\n        &.d-disabled {\n            display: none;\n        }\n    }\n\n    /* mobile positioning */\n\n    @media screen and (max-width: $mobile-max-size) {\n        &.m-top {\n            top: -600px;\n            bottom: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px 1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                top: 0;\n            }\n        }\n\n        &.m-bottom {\n            bottom: -600px;\n            top: auto;\n\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                box-shadow: 0px -1px 1px #bbb;\n            }\n\n            &.pushly-prompt-visible {\n                bottom: 0;\n            }\n        }\n\n        &.m-disabled {\n            display: none;\n        }\n    }\n\n    @media screen and (max-width: $small-screen) {\n        .pushly-prompt-slide,\n        .pushly_popover-box {\n            width: 100%;\n\n            .pushly-prompt-icon,\n            .pushly_popover-first {\n                max-width: calc(#{$imageSize} - 20px);\n                height: calc(#{$imageSize} - 20px);\n            }\n        }\n\n        &.normal {\n            .pushly-prompt-slide,\n            .pushly_popover-box {\n                .pushly-prompt-content,\n                .pushly_popover-second {\n                    width: calc(100% - #{$imageSize} + 20px);\n                }\n            }\n        }\n\n        &.m-disabled {\n            display: none;\n        }\n    }\n}\n'],sourceRoot:""}]);const o=t},"./node_modules/css-loader/dist/runtime/api.js":s=>{"use strict";s.exports=function(i){var d=[];return d.toString=function(){return this.map(function(s){var e="",t=void 0!==s[5];return s[4]&&(e+="@supports (".concat(s[4],") {")),s[2]&&(e+="@media ".concat(s[2]," {")),t&&(e+="@layer".concat(0<s[5].length?" ".concat(s[5]):""," {")),e+=i(s),t&&(e+="}"),s[2]&&(e+="}"),s[4]&&(e+="}"),e}).join("")},d.i=function(s,e,t,i,o){"string"==typeof s&&(s=[[null,s,void 0]]);var n={};if(t)for(var r=0;r<this.length;r++){var p=this[r][0];null!=p&&(n[p]=!0)}for(var l=0;l<s.length;l++){var u=[].concat(s[l]);t&&n[u[0]]||(void 0!==o&&(void 0!==u[5]&&(u[1]="@layer".concat(0<u[5].length?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),e&&(u[2]&&(u[1]="@media ".concat(u[2]," {").concat(u[1],"}")),u[2]=e),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),d.push(u))}},d}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":s=>{"use strict";s.exports=function(s){var e,t=s[1],i=s[3];return i?"function"==typeof btoa?(s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),s="/*# ".concat(s," */"),e=i.sources.map(function(s){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(s," */")}),[t].concat(e).concat([s]).join("\n")):[t].join("\n"):t}},"./node_modules/error-stack-parser/error-stack-parser.js":function(e,t,i){var o,n;!function(s){"use strict";n=[i("./node_modules/stackframe/stackframe.js")],void 0!==(n="function"==typeof(o=s)?o.apply(t,n):o)&&(e.exports=n)}(function(p){"use strict";var e=/(^|@)\S+:\d+/,t=/^\s*at .*(\S+:\d+|\(native\))/m,i=/^(eval@)?(\[native code])?$/;return{parse:function(s){if(void 0!==s.stacktrace||void 0!==s["opera#sourceloc"])return this.parseOpera(s);if(s.stack&&s.stack.match(t))return this.parseV8OrIE(s);if(s.stack)return this.parseFFOrSafari(s);throw new Error("Cannot parse given Error object")},extractLocation:function(s){if(-1===s.indexOf(":"))return[s];s=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(s.replace(/[()]/g,""));return[s[1],s[2]||void 0,s[3]||void 0]},parseV8OrIE:function(s){return s.stack.split("\n").filter(function(s){return!!s.match(t)},this).map(function(s){var e=(t=(s=-1<s.indexOf("(eval ")?s.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""):s).replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,"")).match(/ (\(.+\)$)/),t=e?t.replace(e[0],""):t,i=this.extractLocation(e?e[1]:t),e=e&&t||void 0,t=-1<["eval","<anonymous>"].indexOf(i[0])?void 0:i[0];return new p({functionName:e,fileName:t,lineNumber:i[1],columnNumber:i[2],source:s})},this)},parseFFOrSafari:function(s){return s.stack.split("\n").filter(function(s){return!s.match(i)},this).map(function(s){var e,t;return-1===(s=-1<s.indexOf(" > eval")?s.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1"):s).indexOf("@")&&-1===s.indexOf(":")?new p({functionName:s}):(e=(e=s.match(t=/((.*".+"[^@]*)?[^@]*)(?:@)/))&&e[1]?e[1]:void 0,t=this.extractLocation(s.replace(t,"")),new p({functionName:e,fileName:t[0],lineNumber:t[1],columnNumber:t[2],source:s}))},this)},parseOpera:function(s){return!s.stacktrace||-1<s.message.indexOf("\n")&&s.message.split("\n").length>s.stacktrace.split("\n").length?this.parseOpera9(s):s.stack?this.parseOpera11(s):this.parseOpera10(s)},parseOpera9:function(s){for(var e=/Line (\d+).*script (?:in )?(\S+)/i,t=s.message.split("\n"),i=[],o=2,n=t.length;o<n;o+=2){var r=e.exec(t[o]);r&&i.push(new p({fileName:r[2],lineNumber:r[1],source:t[o]}))}return i},parseOpera10:function(s){for(var e=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,t=s.stacktrace.split("\n"),i=[],o=0,n=t.length;o<n;o+=2){var r=e.exec(t[o]);r&&i.push(new p({functionName:r[3]||void 0,fileName:r[2],lineNumber:r[1],source:t[o]}))}return i},parseOpera11:function(s){return s.stack.split("\n").filter(function(s){return!!s.match(e)&&!s.match(/^Error created at/)},this).map(function(s){var e,t=s.split("@"),i=this.extractLocation(t.pop()),t=t.shift()||"",o=t.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,t=void 0===(e=t.match(/\(([^)]*)\)/)?t.replace(/^[^(]+\(([^)]*)\)$/,"$1"):e)||"[arguments not available]"===e?void 0:e.split(",");return new p({functionName:o,args:t,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:s})},this)}}})},"./node_modules/stackframe/stackframe.js":function(s,e){var t,i;!function(){"use strict";i=[],void 0!==(i="function"==typeof(t=function(){"use strict";function t(s){return!isNaN(parseFloat(s))&&isFinite(s)}function i(s){return s.charAt(0).toUpperCase()+s.substring(1)}function s(s){return function(){return this[s]}}var e=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],n=["fileName","functionName","source"],r,p,l=e.concat(o,n,["args"],["evalOrigin"]);function c(s){if(!s)return;for(var e=0;e<l.length;e++)if(s[l[e]]!==undefined)this["set"+i(l[e])](s[l[e]])}c.prototype={getArgs:function(){return this.args},setArgs:function(s){if(Object.prototype.toString.call(s)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=s},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(s){if(s instanceof c)this.evalOrigin=s;else if(s instanceof Object)this.evalOrigin=new c(s);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var s=this.getFileName()||"";var e=this.getLineNumber()||"";var t=this.getColumnNumber()||"";var i=this.getFunctionName()||"";if(this.getIsEval()){if(s)return"[eval] ("+s+":"+e+":"+t+")";return"[eval]:"+e+":"+t}if(i)return i+" ("+s+":"+e+":"+t+")";return s+":"+e+":"+t}},c.fromString=function s(e){var t=e.indexOf("(");var i=e.lastIndexOf(")");var o=e.substring(0,t);var n=e.substring(t+1,i).split(",");var r=e.substring(i+1);if(r.indexOf("@")===0){var p=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(r,"");var l=p[1];var u=p[2];var d=p[3]}return new c({functionName:o,args:n||undefined,fileName:l,lineNumber:u||undefined,columnNumber:d||undefined})};for(var u=0;u<e.length;u++){c.prototype["get"+i(e[u])]=s(e[u]);c.prototype["set"+i(e[u])]=function(e){return function(s){this[e]=Boolean(s)}}(e[u])}for(var d=0;d<o.length;d++){c.prototype["get"+i(o[d])]=s(o[d]);c.prototype["set"+i(o[d])]=function(e){return function(s){if(!t(s))throw new TypeError(e+" must be a Number");this[e]=Number(s)}}(o[d])}for(var h=0;h<n.length;h++){c.prototype["get"+i(n[h])]=s(n[h]);c.prototype["set"+i(n[h])]=function(e){return function(s){this[e]=String(s)}}(n[h])}return c})?t.apply(e,i):t)&&(s.exports=i)}()},"./src/sdk/styles/bell.scss":(s,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>u});var e=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),e=t.n(e),i=t("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),i=t.n(i),o=t("./node_modules/style-loader/dist/runtime/insertBySelector.js"),o=t.n(o),n=t("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),n=t.n(n),r=t("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),r=t.n(r),p=t("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),p=t.n(p),t=t("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/sdk/styles/bell.scss"),l={};l.styleTagTransform=p(),l.setAttributes=n(),l.insert=o().bind(null,"head"),l.domAPI=i(),l.insertStyleElement=r(),e()(t.default,l);const u=t.default&&t.default.locals?t.default.locals:void 0},"./src/sdk/styles/popover.scss":(s,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>u});var e=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),e=t.n(e),i=t("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),i=t.n(i),o=t("./node_modules/style-loader/dist/runtime/insertBySelector.js"),o=t.n(o),n=t("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),n=t.n(n),r=t("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),r=t.n(r),p=t("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),p=t.n(p),t=t("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/sass-loader/dist/cjs.js!./src/sdk/styles/popover.scss"),l={};l.styleTagTransform=p(),l.setAttributes=n(),l.insert=o().bind(null,"head"),l.domAPI=i(),l.insertStyleElement=r(),e()(t.default,l);const u=t.default&&t.default.locals?t.default.locals:void 0},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":s=>{"use strict";var u=[];function d(s){for(var e=-1,t=0;t<u.length;t++)if(u[t].identifier===s){e=t;break}return e}function p(s,e){for(var t={},i=[],o=0;o<s.length;o++){var n=s[o],r=e.base?n[0]+e.base:n[0],p=t[r]||0,l="".concat(r," ").concat(p),r=(t[r]=p+1,d(l)),p={css:n[1],media:n[2],sourceMap:n[3],supports:n[4],layer:n[5]};-1!==r?(u[r].references++,u[r].updater(p)):(n=function(e,s){var t=s.domAPI(s);return t.update(e),function(s){s?s.css===e.css&&s.media===e.media&&s.sourceMap===e.sourceMap&&s.supports===e.supports&&s.layer===e.layer||t.update(e=s):t.remove()}}(p,e),e.byIndex=o,u.splice(o,0,{identifier:l,updater:n,references:1})),i.push(l)}return i}s.exports=function(s,n){var r=p(s=s||[],n=n||{});return function(s){s=s||[];for(var e=0;e<r.length;e++){var t=d(r[e]);u[t].references--}for(var s=p(s,n),i=0;i<r.length;i++){var o=d(r[i]);0===u[o].references&&(u[o].updater(),u.splice(o,1))}r=s}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":s=>{"use strict";var t={};s.exports=function(s,e){if(!(s=function(s){if(void 0===t[s]){var e=document.querySelector(s);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(s){e=null}t[s]=e}return t[s]}(s)))throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":s=>{"use strict";s.exports=function(s){var e=document.createElement("style");return s.setAttributes(e,s.attributes),s.insert(e,s.options),e}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(s,e,t)=>{"use strict";s.exports=function(s){var e=t.nc;e&&s.setAttribute("nonce",e)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":s=>{"use strict";s.exports=function(n){var r=n.insertStyleElement(n);return{update:function(s){var e,t,i,o;e=r,t=n,i="",(s=s).supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {")),(o=void 0!==s.layer)&&(i+="@layer".concat(0<s.layer.length?" ".concat(s.layer):""," {")),i+=s.css,o&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}"),(o=s.sourceMap)&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)},remove:function(){var s;null!==(s=r).parentNode&&s.parentNode.removeChild(s)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":s=>{"use strict";s.exports=function(s,e){if(e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}},"./src/_utils/base-64.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.arrayBufferToBase64=e.base64ToArrayBuffer=void 0;const i=t("./src/sdk/utils.ts");e.base64ToArrayBuffer=function(s){s=(s+"=".repeat((4-s.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const e=(0,i.atobShim)(s),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t[s]=e.charCodeAt(s);return t},e.arrayBufferToBase64=function(s){return s=new Uint8Array(s),window.btoa(String.fromCharCode.apply(null,s)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}},"./src/_utils/consent.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buildSdkConsentEventData=e.buildSdkConsentContext=void 0;const i=t("./src/sdk/enums/consent.enum.ts");e.buildSdkConsentContext=function(s,e=!1){return{required:s=s.consentRequired||!1,status:s&&e?i.ConsentStatus.CONFIRMED:i.ConsentStatus.UNCONFIRMED}},e.buildSdkConsentEventData=function(s){return{[i.ConsentEventKeys.CONSENT_REQUIRED]:s.consent.required,[i.ConsentEventKeys.CONSENT_STATUS]:s.consent.status}}},"./src/_utils/domain-matching.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.domainMatchPredicate=void 0;const n=t("./src/_utils/global-env.ts");e.domainMatchPredicate=function(s){var e=(i=(0,n.getLocation)()).protocol+"//"+i.hostname,t=i.protocol+"//"+i.host,i=i.href;/^\*/.test(s)&&(s="."+s);const o=new RegExp(`^(http[s]?://)?${s}$`,"i");return o.test(e)||o.test(t)||o.test(i)}},"./src/_utils/global-env.ts":(s,e)=>{"use strict";function t(){return"WorkerGlobalScope"in self}function i(){return window.self!==window.top&&window.frameElement&&"about:blank"===window.frameElement.src}function o(){return i()?top:t()?self:window}Object.defineProperty(e,"__esModule",{value:!0}),e.getDocument=e.getNavigator=e.getLocation=e.getSelf=e.inSourcelessIFrameScope=e.inWorkerGlobalScope=void 0,e.inWorkerGlobalScope=t,e.inSourcelessIFrameScope=i,e.getSelf=o,e.getLocation=function(){return o().location||{}},e.getNavigator=function(){return o().navigator||{}},e.getDocument=function(){return o().document||{}}},"./src/_utils/interval-runner.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setIntervalRunner=void 0;e.setIntervalRunner=(s,e)=>{const t={id:void 0},i=(clearTimeout(t.id),()=>{clearTimeout(t.id),Promise.resolve(s()).then(()=>{t.id=setTimeout(i,e)})});return t.id=setTimeout(i,e),[()=>t.id,()=>clearTimeout(t.id)]}},"./src/_utils/permissions.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.getNotificationPermissions=void 0;const p=t("./src/_utils/global-env.ts");e.getNotificationPermissions=function(r){return i(this,void 0,void 0,function*(){const e=p.getSelf(),s=p.getNavigator();var t={permission:"default"};let i=t;var o,n=navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i)&&!navigator.userAgent.match(/Opera|OPT\//);if(!n||"PushManager"in e)if(n)i.permission=e.Notification.permission;else try{"permissions"in s&&"query"in s.permissions?(o=yield s.permissions.query({name:"notifications"}),i.permission="prompt"===o.state?"default":o.state):i.permission=e.Notification.permission}catch(s){i.permission=e.Notification.permission}else{if(!r||!r.websitePushId)throw new Error("websitePushId must be provided for Safari permission check.");i=e.safari.pushNotification.permission(r.websitePushId)}return i=i||t})}},"./src/_utils/service-worker-registration.ts":function(s,e,t){"use strict";var o=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.createPushSubscription=e.getPushSubscription=e.getPushlyServiceWorkerRegistration=e.getServiceWorkerRegistrations=e.getPushlyWorkerConfig=void 0;const r=t("./src/_utils/base-64.ts"),p=t("./src/_utils/permissions.ts"),u=t("./src/sdk/services/logging.service.ts"),d=t("./src/sdk/exceptions/worker-registration.exception.ts"),c=t("./src/_utils/global-env.ts");function h(s){var e=(0,c.getLocation)();const t=e.protocol+"//"+e.hostname+(e.port?":"+e.port:"");let i=s.app.loadConfig.sw?s.app.loadConfig.sw.replace(/^\//,""):null,o=(i&&!i.includes(t)&&(i="/"+i),s.app.loadConfig.swScope?s.app.loadConfig.swScope.replace(/^\//,""):null),n=(o&&!o.includes(t)&&(o="/"+o),i||"/pushly-sdk-worker.js");var e=n.substr(0,n.lastIndexOf("/")+1)||"/",r=s.domain.hasFlag("USE_ROOT_SW_SCOPE");let p=e;o?p=o:r&&(p="/");e=p.includes(t)?p:""+t.replace(/\/$/,"")+p,r=!s.domain.hasFlag("SW_NO_DOMAIN_KEY_PARAM");return{scope:e,installationPath:n=r?`${n}${n.includes("?")?"&":"?"}domain_key=`+s.domainKey:n}}function a(e){return o(this,void 0,void 0,function*(){let s=[];return s=e.env.isPushManagerInScope()?yield(0,c.getSelf)().navigator.serviceWorker.getRegistrations():s})}function m(t,s){var e=new Promise(s=>{let e=setTimeout(()=>{clearTimeout(e),s(null)},t)});return Promise.race([s,e])}function i(l){return o(this,void 0,void 0,function*(){var s,e=(0,c.getSelf)();let t=null;if(l.env.isPushManagerInScope()){const r=h(l);for(s of yield a(l)){yield m(50,e.navigator.serviceWorker.ready);var i=s.scope;const p=(s.active||{}).scriptURL||"";var o=i===r.scope,n=-1!==p.indexOf(r.installationPath.split("?")[0]);if(o&&n){if(t=s,!l.domain.shouldUnregisterNonPushlyWorkers())break}else if(!o&&l.domain.shouldUnregisterNonPushlyWorkers()&&(yield s.unregister(),u.Logger.info("removed worker: "+JSON.stringify({scope:i,path:p}))),o&&!n&&!l.domain.shouldReplaceExistingWorkerInPushlyScope())throw new d.WorkerRegistrationException(new Error(`Implementation Error. An existing, non-push, service worker was found at scope: ${r.scope}.`))}}return t})}e.getPushlyWorkerConfig=h,e.getServiceWorkerRegistrations=a,e.getPushlyServiceWorkerRegistration=i,e.getPushSubscription=function(n){return o(this,void 0,void 0,function*(){let e=null;if(n.env.isPushManagerInScope()&&"granted"===(yield(0,p.getNotificationPermissions)()).permission){const o=yield i(n);if(o)try{e=yield new Promise((e,t)=>{const i=setTimeout(t,5e3);o.pushManager.getSubscription().then(s=>{clearTimeout(i),s?e(s):o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(0,r.base64ToArrayBuffer)(n.domain.vapidPublicKey)}).then(s=>{e(s)}).catch(s=>{t(s),clearTimeout(i)})}).catch(s=>{t(s),clearTimeout(i)})})}catch(s){try{e=yield o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(0,r.base64ToArrayBuffer)(n.domain.vapidPublicKey)})}catch(s){u.Logger.warn(s)}}}return e})},e.createPushSubscription=function(t,i){return o(this,void 0,void 0,function*(){let s=null;var e=(0,c.getSelf)();return t.env.isPushManagerInScope()&&i&&"granted"===(yield(0,p.getNotificationPermissions)()).permission&&(yield m(50,e.navigator.serviceWorker.ready),s=yield i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(0,r.base64ToArrayBuffer)(t.domain.vapidPublicKey)})),s})}},"./src/_utils/validate-only-instance-of-sdk.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.validateOnlyInstanceOfSdk=void 0;const i=t("./src/sdk/enums/exception-message.enum.ts"),o=t("./src/sdk/exceptions/exit.exception.ts");e.validateOnlyInstanceOfSdk=s=>{var e=window.PushlySDK;if(e&&"object"==typeof e&&void 0!==e.iid&&e.iid!==s.iid)throw new o.ExitException(i.ExceptionMessage.DUPLICATE_SDK_INSTANCE);if(s.context.app&&s.context.app.isLoaded)throw new o.ExitException(i.ExceptionMessage.SDK_ALREADY_LOADED)}},"./src/common/constants.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EVENT_JITTER_MAX_MILLISECONDS=void 0,e.EVENT_JITTER_MAX_MILLISECONDS=7e3},"./src/common/data-providers/api.data-provider.ts":function(s,e,t){"use strict";var p=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.ApiDataProvider=void 0;const l=t("./src/common/utils.ts"),u=t("./src/common/constants.ts");e.ApiDataProvider=class{static get(s,e){return p(this,void 0,void 0,function*(){return this.exec(s,"GET",{},void 0,e)})}static post(s,e={},t){return p(this,void 0,void 0,function*(){return this.exec(s,"POST",{"content-type":"text/plain"},e,t)})}static exec(t,i,o,n,r){return p(this,void 0,void 0,function*(){let e=null;try{if(r){let s=0;s="object"==typeof r&&"ms"in r?r.ms:u.EVENT_JITTER_MAX_MILLISECONDS,yield l.delayRandom(s)}const s={method:i,headers:o};if("GET"!==i&&n&&(s.body="string"!=typeof n?JSON.stringify(n):n),(e=yield l.retryFetch(t,s)).ok){let s;try{s=yield e.json()}catch(s){}return s}throw new Error("Endpoint returned with status "+e.statusText)}catch(s){throw(s=s||{}).response=e,s}})}}},"./src/common/md5.ts":(s,e)=>{"use strict";function n(s,e){var t=r(s[0],n=s[1],o=s[2],i=s[3],e[0],7,-680876936),i=r(i,t,n,o,e[1],12,-389564586),o=r(o,i,t,n,e[2],17,606105819),n=r(n,o,i,t,e[3],22,-1044525330);t=r(t,n,o,i,e[4],7,-176418897),i=r(i,t,n,o,e[5],12,1200080426),o=r(o,i,t,n,e[6],17,-1473231341),n=r(n,o,i,t,e[7],22,-45705983),t=r(t,n,o,i,e[8],7,1770035416),i=r(i,t,n,o,e[9],12,-1958414417),o=r(o,i,t,n,e[10],17,-42063),n=r(n,o,i,t,e[11],22,-1990404162),t=r(t,n,o,i,e[12],7,1804603682),i=r(i,t,n,o,e[13],12,-40341101),o=r(o,i,t,n,e[14],17,-1502002290),t=l(t,n=r(n,o,i,t,e[15],22,1236535329),o,i,e[1],5,-165796510),i=l(i,t,n,o,e[6],9,-1069501632),o=l(o,i,t,n,e[11],14,643717713),n=l(n,o,i,t,e[0],20,-373897302),t=l(t,n,o,i,e[5],5,-701558691),i=l(i,t,n,o,e[10],9,38016083),o=l(o,i,t,n,e[15],14,-660478335),n=l(n,o,i,t,e[4],20,-405537848),t=l(t,n,o,i,e[9],5,568446438),i=l(i,t,n,o,e[14],9,-1019803690),o=l(o,i,t,n,e[3],14,-187363961),n=l(n,o,i,t,e[8],20,1163531501),t=l(t,n,o,i,e[13],5,-1444681467),i=l(i,t,n,o,e[2],9,-51403784),o=l(o,i,t,n,e[7],14,1735328473),t=u(t,n=l(n,o,i,t,e[12],20,-1926607734),o,i,e[5],4,-378558),i=u(i,t,n,o,e[8],11,-2022574463),o=u(o,i,t,n,e[11],16,1839030562),n=u(n,o,i,t,e[14],23,-35309556),t=u(t,n,o,i,e[1],4,-1530992060),i=u(i,t,n,o,e[4],11,1272893353),o=u(o,i,t,n,e[7],16,-155497632),n=u(n,o,i,t,e[10],23,-1094730640),t=u(t,n,o,i,e[13],4,681279174),i=u(i,t,n,o,e[0],11,-358537222),o=u(o,i,t,n,e[3],16,-722521979),n=u(n,o,i,t,e[6],23,76029189),t=u(t,n,o,i,e[9],4,-640364487),i=u(i,t,n,o,e[12],11,-421815835),o=u(o,i,t,n,e[15],16,530742520),t=d(t,n=u(n,o,i,t,e[2],23,-995338651),o,i,e[0],6,-198630844),i=d(i,t,n,o,e[7],10,1126891415),o=d(o,i,t,n,e[14],15,-1416354905),n=d(n,o,i,t,e[5],21,-57434055),t=d(t,n,o,i,e[12],6,1700485571),i=d(i,t,n,o,e[3],10,-1894986606),o=d(o,i,t,n,e[10],15,-1051523),n=d(n,o,i,t,e[1],21,-2054922799),t=d(t,n,o,i,e[8],6,1873313359),i=d(i,t,n,o,e[15],10,-30611744),o=d(o,i,t,n,e[6],15,-1560198380),n=d(n,o,i,t,e[13],21,1309151649),t=d(t,n,o,i,e[4],6,-145523070),i=d(i,t,n,o,e[11],10,-1120210379),o=d(o,i,t,n,e[2],15,718787259),n=d(n,o,i,t,e[9],21,-343485551),s[0]=h(t,s[0]),s[1]=h(n,s[1]),s[2]=h(o,s[2]),s[3]=h(i,s[3])}function p(s,e,t,i,o,n){return e=h(h(e,s),h(i,n)),h(e<<o|e>>>32-o,t)}function r(s,e,t,i,o,n,r){return p(e&t|~e&i,s,e,o,n,r)}function l(s,e,t,i,o,n,r){return p(e&i|t&~i,s,e,o,n,r)}function u(s,e,t,i,o,n,r){return p(e^t^i,s,e,o,n,r)}function d(s,e,t,i,o,n,r){return p(t^(e|~i),s,e,o,n,r)}function t(s){for(var e=s.length,t=[1732584193,-271733879,-1732584194,271733878],i=64;i<=s.length;i+=64)n(t,function(s){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=s.charCodeAt(e)+(s.charCodeAt(e+1)<<8)+(s.charCodeAt(e+2)<<16)+(s.charCodeAt(e+3)<<24);return t}(s.substring(i-64,i)));s=s.substring(i-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<s.length;i++)o[i>>2]|=s.charCodeAt(i)<<(i%4<<3);if(o[i>>2]|=128<<(i%4<<3),55<i)for(n(t,o),i=0;i<16;i++)o[i]=0;return o[14]=8*e,n(t,o),t}Object.defineProperty(e,"__esModule",{value:!0}),e.MD5=void 0;var i="0123456789abcdef".split("");function o(s){for(var e=0;e<s.length;e++)s[e]=function(s){for(var e="",t=0;t<4;t++)e+=i[s>>8*t+4&15]+i[s>>8*t&15];return e}(s[e]);return s.join("")}function c(s){return o(t(s))}e.MD5=c;let h=(s,e)=>s+e&4294967295;"5d41402abc4b2a76b9719d911017c592"!=c("hello")&&(h=(s,e)=>{var t=(65535&s)+(65535&e);return(s>>16)+(e>>16)+(t>>16)<<16|65535&t})},"./src/common/utils.ts":function(s,u){"use strict";var d=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.retryFetch=u.delayRandom=u.delay=u.awaitUntil=u.buildRegexFromArray=u.tryParseInt=u.randomString=void 0,u.randomString=(e=32)=>{var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let i="";for(let s=0;s<e;s++)i+=t[Math.floor(Math.random()*t.length)];return/undefined/i.test(i)&&"crypto"in self&&"getRandomValues"in crypto&&"Uint32Array"in self&&(i=crypto.getRandomValues(new Uint32Array(4)).join("")),i=/undefined/i.test(i)?"INVALID_RANDOM_STRING":i},u.tryParseInt=s=>{s=String(s);let e;try{isNaN(s)||(e=parseInt(s,10))}catch(s){}return e},u.buildRegexFromArray=s=>new RegExp(s.map(s=>`(${s})`).join("|"),"i"),u.awaitUntil=(o,n,r)=>d(void 0,void 0,void 0,function*(){return new Promise((e,s)=>{let t=!1;const i=setTimeout(()=>{t=!0,void 0!==r?e(r):s()},n);o.then(s=>{clearTimeout(i),t||e(s)})})}),u.delay=(t=0)=>d(void 0,void 0,void 0,function*(){return new Promise((s,e)=>{setTimeout(()=>s(),t)})});u.delayRandom=(s=0)=>d(void 0,void 0,void 0,function*(){return void 0!==s&&0<s&&(s=Math.round(Math.random()*s)),yield(0,u.delay)(s),s}),u.retryFetch=function i(o,n,r,p=8,l=800){return d(this,void 0,void 0,function*(){let s=null;var e,t=e=>d(this,void 0,void 0,function*(){var s=p-1;if(s<=0)throw e instanceof Error?e:new Error(e);return yield(0,u.delay)(l),r&&r(s),i(o,n,r,s,2*l)});try{return(s=yield fetch(o,n)).ok?s:(e=yield s.text(),t(`Retry fetch failed, ${s.status}, on url: ${o}. response object: `+e))}catch(s){return t(s)}})}},"./src/sdk/constants.ts":function(s,e,t){"use strict";var i=this&&this.__createBinding||(Object.create?function(s,e,t,i){void 0===i&&(i=t);var o=Object.getOwnPropertyDescriptor(e,t);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(s,i,o)}:function(s,e,t,i){s[i=void 0===i?t:i]=e[t]}),o=this&&this.__exportStar||function(s,e){for(var t in s)"default"===t||Object.prototype.hasOwnProperty.call(e,t)||i(e,s,t)};Object.defineProperty(e,"__esModule",{value:!0}),e.UNCAUGHT_ERROR_BLACKLIST=e.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS=e.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW=e.DEFAULT_CLASSNAME_PROMPT_CUSTOM=e.DEFAULT_CLASSNAME_PROMPT_VISIBLE=e.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE=e.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE=e.DEFAULT_CLASSNAME_SUBSCRIPTION_DISMISSED=e.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED=e.DEFAULT_CLASSNAME_SUBSCRIPTION_FALSE=e.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE=e.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE=e.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED=e.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED=e.MOBILE_MAX_SIZE=e.ENV_NAME_PRODUCTION=e.ENV_NAME_STAGING=e.ENV_NAME_DEV=e.ENV_NAME_LOCAL_PRODUCTION=e.ENV_NAME_LOCAL=e.PUSHLY_SETTINGS_CACHED_COOKIE_TIMEOUT=e.PUSHLY_STORE_NAME=e.PUSHLY_DB_NAME=e.PUSHLY_PROMPT_ID_QS=e.PUSHLY_SUBSCRIBED_URL_QS=e.PUSHLY_DOMAIN_KEY_QS=e.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT=e.PUSHLY_UNIQUE_USER_FIRST_APPEARANCE_QS=e.PUSHLY_UNIQUE_USER_ID_QS=e.PUSHLY_SDK_APPLICATION_NAME=e.INJECTED_DOMAIN_SETTINGS=e.DOMAIN_SETTINGS_INJECTION_FAILED=e.APNS_URL=e.PROXY_URL=e.SW_DEPENDENCY_URL=e.ALLOW_ENDPOINT=e.SETTINGS_ENDPOINT=e.EVENTS_ENDPOINT=e.PUSHLY_APPLICATION_VERSION=e.ENV_NAME=void 0,e.ENV_NAME="production",e.PUSHLY_APPLICATION_VERSION="37d92b3d8c2f9bfa814a193dbfab20adf1c90589",e.EVENTS_ENDPOINT="https://k.p-n.io/event-stream",e.SETTINGS_ENDPOINT="https://cdn.p-n.io/domain-settings",e.ALLOW_ENDPOINT="https://k.p-n.io/allow",e.SW_DEPENDENCY_URL="https://cdn.p-n.io/pushly-sw.min.js",e.PROXY_URL="https://notifications.p-n.io",e.APNS_URL="https://cdn.p-n.io/apns",e.DOMAIN_SETTINGS_INJECTION_FAILED=/{{INJECTED_DOMAIN_SETTINGS}}/i,e.INJECTED_DOMAIN_SETTINGS={"domain": {"id": 12149, "name": "forbes.com", "domain_key": "qmhdz0KFKfsfhQQeCP5Js1NFta1P8jkwbf05", "integration_type": "direct", "custom_allow_domain": null, "frequency_caps": {"prompt": {"occurrences": 1, "fcap_seconds": 604800, "display_metric": "days"}}, "global_prompt_settings": null, "flags": ["FEAT_CUSTOM_VAPID", "FEAT_VAPID_ONLY", "REPLACE_EXISTING_WORKERS", "USE_ROOT_SW_SCOPE", "FEAT_NATIVE_ANDROID_NOTIFICATIONS_FG_DISPLAY", "FEAT_NATIVE_IOS_NOTIFICATIONS_FG_DISPLAY"], "custom_sdk_package_name": null, "vapid_public_key": "BJdOWbKbyFwt3bOoHlyU0RJE1sLzBYI16hOgmKUTirAIT1F-ReJDqNjrVmit429UYrDUjA0If_2FTwDPNEj-y3U", "additional_subscription_data": null, "whitelist_domains": ["www.forbes.com"], "sdk_event_only_domains": [], "apns_configuration": {"is_active": false, "push_package": null}, "domain_integrations": null}, "prompts": [{"id": 31383, "domain_id": 12149, "style": "NATIVE", "config": {"behavior": {"cookie_length_seconds": 604800}}, "is_auto_show": true, "weight": 100, "conditions_json": {"visitor": {"time_on_page_seconds": 4}}, "prompt_group_id": 33186, "name": null}], "prompt_groups": [{"id": 33186, "domain_id": 12149, "name": "4 Second 1-Step", "is_active": true, "priority": 0, "display_to_pct": 100, "conditions_json": {"display": {"mobile": "enabled", "desktop": "enabled"}}}]},o(t("./src/common/constants.ts"),e),e.PUSHLY_SDK_APPLICATION_NAME="pushly-sdk",e.PUSHLY_UNIQUE_USER_ID_QS="pushly_unique_user_id",e.PUSHLY_UNIQUE_USER_FIRST_APPEARANCE_QS="pushly_unique_user_first_appearance",e.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT=7,e.PUSHLY_DOMAIN_KEY_QS="pushly_domain_key",e.PUSHLY_SUBSCRIBED_URL_QS="pushly_subscribed_url",e.PUSHLY_PROMPT_ID_QS="pushly_prompt_id",e.PUSHLY_DB_NAME="pushly_db",e.PUSHLY_STORE_NAME="pushly_store",e.PUSHLY_SETTINGS_CACHED_COOKIE_TIMEOUT=1/24/12,e.ENV_NAME_LOCAL="local",e.ENV_NAME_LOCAL_PRODUCTION="local-production",e.ENV_NAME_DEV="dev",e.ENV_NAME_STAGING="staging",e.ENV_NAME_PRODUCTION="production",e.MOBILE_MAX_SIZE=768,e.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED="pushly-web-push-unsupported",e.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED="pushly-web-push-supported",e.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE="pushly-subscription-none",e.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE="pushly-subscription-subscribed",e.DEFAULT_CLASSNAME_SUBSCRIPTION_FALSE="pushly-subscription-unsubscribed",e.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED="pushly-subscription-denied",e.DEFAULT_CLASSNAME_SUBSCRIPTION_DISMISSED="pushly-subscription-dismissed",e.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE="pushly-prompt-ineligible",e.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE="pushly-prompt-eligible",e.DEFAULT_CLASSNAME_PROMPT_VISIBLE="pushly-prompt-visible",e.DEFAULT_CLASSNAME_PROMPT_CUSTOM="pushly-prompt-custom",e.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW="pushly-prompt-buttons-allow",e.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS="pushly-prompt-buttons-dismiss",e.UNCAUGHT_ERROR_BLACKLIST=["^UnknownError","^NotAllowedError$","^AbortError$","^QuotaExceededError$","Only secure origins are allowed"]},"./src/sdk/cross-frame-messenger/base-messenger.ts":function(s,e,t){"use strict";var r=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseMessenger=void 0;const p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/services/logging.service.ts");class i extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{constructor(){super(),this.portListeners={}}sendToPort(e,t,i=null,o=null,n=!1){try{var r=o||crypto.getRandomValues(new Uint8Array(10)).join("");e.postMessage({id:r,topic:t,data:i,isReply:n});let s=new Promise(s=>s());if(!n){let e=void 0;s=new Promise(s=>e=s),this.portListeners[r]=e}return s}catch(s){l.Logger.error(s)}}listenToPort(e){e.onmessage=s=>{this.handleMessageEvent(s,e)}}handleMessageEvent(s,e){const t=s.ports[0]||e;try{if(s.data&&s.data.topic){const o=s.data.topic;var i=s.data.data;const n=s.data.id;n in this.portListeners?(this.portListeners[n](i),delete this.portListeners[n]):this.dispatch(new p.EventModel(o,{port:t,data:i,reply:s=>r(this,void 0,void 0,function*(){yield this.sendToPort(t,o,s,n,!0)})}))}}catch(s){l.Logger.warn(s)}}}e.BaseMessenger=i},"./src/sdk/cross-frame-messenger/messenger-client-connection-pool.ts":function(s,e,t){"use strict";var n=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.MessengerClientConnectionPool=void 0;const r=t("./src/sdk/cross-frame-messenger/models/connection-pool-record.ts"),p=t("./src/sdk/cross-frame-messenger/messenger-client.ts"),l=t("./src/sdk/services/logging.service.ts");class u{checkout(o){return n(this,void 0,void 0,function*(){l.Logger.debug("MessengerClientConnectionPool checking out "+o);let i;return o in u.connections?(l.Logger.debug("Returning existing connection"),i=u.connections[o]):(l.Logger.debug("Creating new connection"),(i=new r.ConnectionPoolRecord).checkouts=0,i.messengerClient=new Promise((e,t)=>n(this,void 0,void 0,function*(){const s=new p.MessengerClient;try{i.close=yield s.connectUrl(o),e(s)}catch(s){l.Logger.warn(s),delete u.connections[o],t(s)}})),u.connections[o]=i),i.checkouts+=1,i.messengerClient})}release(t){return n(this,void 0,void 0,function*(){for(const s in u.connections){const e=u.connections[s];if((yield e.messengerClient)===t){l.Logger.debug("MessengerClientConnectionPool releasing connection to "+s),--e.checkouts,e.checkouts<1&&(l.Logger.debug("MessengerClientConnectionPool closing connection to "+s),e.close(),delete u.connections[s]);break}}})}}(e.MessengerClientConnectionPool=u).connections={}},"./src/sdk/cross-frame-messenger/messenger-client.ts":function(s,e,t){"use strict";var r=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},i=(Object.defineProperty(e,"__esModule",{value:!0}),e.MessengerClient=void 0,t("./src/sdk/cross-frame-messenger/base-messenger.ts"));const d=t("./src/common/utils.ts"),c=t("./src/sdk/enums/messenger-topic.enum.ts"),p=t("./src/sdk/exceptions/no-connection.exception.ts"),h=t("./src/sdk/exceptions/no-response.exception.ts"),a=t("./src/sdk/services/logging.service.ts");class o extends i.BaseMessenger{connect(l,u=3){return r(this,void 0,void 0,function*(){this.port&&(a.Logger.warn("ClientMessenger reused. Existing port closed."),this.close());let s,t=null,i=1,o=!1;do{s&&s.close();var n=new MessageChannel,r=((s=n.port1).onmessage=this.handleMessageEvent.bind(this),crypto.getRandomValues(new Uint8Array(10)).join(""));let e=void 0;var p=new Promise(s=>e=s);this.portListeners[r]=e,l.postMessage({id:r,topic:c.MessengerTopic.CONNECT_HANDSHAKE},"*",[n.port2]),u&&(t=yield(0,d.awaitUntil)(p,500*i,null),i+=1,o=!t&&i<=u)}while(o);if(!t&&u)throw new h.NoResponseException(new Error("Failed to connect"));return this.port=s,this.close.bind(this)})}connectUrl(o,n=3){return r(this,void 0,void 0,function*(){const i=document.createElement("div");return i.setAttribute("style","display:none;position:absolute;overflow:hidden;width:1px;height:1px;bottom:0;left:0"),new Promise((e,t)=>r(this,void 0,void 0,function*(){try{a.Logger.info("Creating iframe "+o);const s=document.createElement("iframe");if(s.width="1px",s.height="1px",s.setAttribute("style","width:1px;height:1px;display:none;"),s.src=o,i.appendChild(s),document.body.appendChild(i),yield(0,d.delay)(300),s.contentWindow)try{e(yield this.connect(s.contentWindow,n)),this.connectedHost=new URL(o).hostname,this.connectedElement=i}catch(s){t(s)}else t(new p.NoConnectionException(new Error("iframe failed to load "+o)))}catch(s){throw document.body.removeChild(i),s}}))})}close(){this.port.close(),this.connectedElement&&document.body.removeChild(this.connectedElement),this.connectedHost=null,this.connectedElement=null,this.port=null}send(e,t=null){return r(this,void 0,void 0,function*(){if(!this.port)throw new p.NoConnectionException(new Error("MessengerClient::send called before connection opened."));var s=(0,d.randomString)();return this.sendToPort(this.port,e,t,s,!1)})}sendTimeout(s,e=null,t){return r(this,void 0,void 0,function*(){return(0,d.awaitUntil)(this.send(s,e),t)})}}e.MessengerClient=o},"./src/sdk/cross-frame-messenger/messenger-server.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.MessengerServer=void 0,t("./src/sdk/cross-frame-messenger/base-messenger.ts"));const n=t("./src/sdk/enums/messenger-topic.enum.ts"),r=t("./src/sdk/data-providers/event.data-provider.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/logging.service.ts");class u extends o.BaseMessenger{constructor(){super(),this.ready=new Promise((s,e)=>{r.EventManager.once(p.EventType.APPLICATION_READY,()=>{l.Logger.info("Application is ready"),s()})})}accept(){window.addEventListener("message",this.handleMessageEvent.bind(this)),this.watch(n.MessengerTopic.CONNECT_HANDSHAKE,this.handleHandshakeEvent.bind(this))}handleHandshakeEvent(s){return i(this,void 0,void 0,function*(){return this.listenToPort(s.port),yield this.ready,s.reply(!0)})}}(e.MessengerServer=u).global=new u},"./src/sdk/cross-frame-messenger/models/connection-pool-record.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionPoolRecord=void 0;e.ConnectionPoolRecord=class{constructor(){this.checkouts=0}}},"./src/sdk/data-providers/abstract-permission.data-provider.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractPermissionDataProvider=void 0;const o=t("./src/_utils/base-64.ts"),n=t("./src/_utils/service-worker-registration.ts"),r=t("./src/_utils/global-env.ts");e.AbstractPermissionDataProvider=class{constructor(s){this.context=s,this.context=s}getLocalPermissions(){return i(this,void 0,void 0,function*(){let e={permission:"default",host:(0,r.getSelf)().location.hostname,subscription:null,applicationServerKey:null,deviceToken:null};if(this.context.env.isSafari()&&!this.context.env.isPushManagerInScope()){if(!this.context.domain.getWebsitePushId())throw new Error("websitePushId must be provided for Safari permission check.");e=self.safari.pushNotification.permission(this.context.domain.getWebsitePushId())||e}else if(this.context.env.isSafari())e.permission=(0,r.getSelf)().Notification?(0,r.getSelf)().Notification.permission.toString():e.permission;else try{let s=(yield navigator.permissions.query({name:"notifications"})).state;"prompt"===s&&(s="default"),e.permission=s}catch(s){e.permission=(0,r.getSelf)().Notification?(0,r.getSelf)().Notification.permission.toString():e.permission}if("granted"===e.permission&&this.context.env.isPushManagerInScope()){const s=yield(0,n.getPushSubscription)(this.context);s&&(e.subscription=s.toJSON(),e.applicationServerKey=(0,o.arrayBufferToBase64)(s.options.applicationServerKey))}return e})}unregisterWorker(){return i(this,void 0,void 0,function*(){let s=!1;if(this.context.env.isPushManagerInScope())try{const e=yield(0,n.getPushlyServiceWorkerRegistration)(this.context);e&&(s=yield e.unregister())}catch(s){}return s})}isSafari(){return navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i)&&!navigator.userAgent.match(/Opera|OPT\//)}}},"./src/sdk/data-providers/abstract-session.data-provider.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractSessionDataProvider=void 0;e.AbstractSessionDataProvider=class{}},"./src/sdk/data-providers/brokered-permission.data-provider.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.BrokeredPermissionDataProvider=void 0,t("./src/sdk/data-providers/abstract-permission.data-provider.ts"));const l=t("./src/sdk/data-providers/cookie.data-provider.ts"),n=t("./src/common/utils.ts"),r=t("./src/sdk/cross-frame-messenger/messenger-client-connection-pool.ts"),u=t("./src/_utils/global-env.ts"),p=t("./src/sdk/enums/messenger-topic.enum.ts"),d=t("./src/sdk/exceptions/no-response.exception.ts"),c=t("./src/sdk/services/logging.service.ts"),h=t("./src/sdk/enums/permission-broker-topic.enum.ts");class a extends o.AbstractPermissionDataProvider{constructor(s){super(s),this.messengerClientConnectionPool=new r.MessengerClientConnectionPool}getPushPermission(){return i(this,void 0,void 0,function*(){const s=[(0,u.getSelf)().location.hostname];var e=yield this.getLocalPermissions();let t;if("default"===e.permission&&(c.Logger.info("BrokeredPermissionDataProvider: Local permissions are: "+e.permission),this.messengerClient&&(s.push(this.messengerClient.connectedHost),t=yield a.getCalculatedPermissions(this.messengerClient)),!t||"default"===t.permission)){var i,o=l.CookieDataProvider.get("_pnpds");if(o&&-1===s.indexOf(o)&&(s.push(o),i=this.context.app.getBrokeredFrameMessengerPath(o),yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(i),t=(yield a.getCalculatedPermissions(this.messengerClient))||t,c.Logger.info(`BrokeredPermissionDataProvider: ${o} permissions are: `+t.permission)),!t||"default"===t.permission)for(const p of this.context.domain.whitelistDomains)if(l.CookieDataProvider.getDomain(p)===l.CookieDataProvider.getDomain()&&-1===s.indexOf(p)){var n=this.context.app.getBrokeredFrameMessengerPath(p);if(yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(n),t=(yield a.getCalculatedPermissions(this.messengerClient))||t,c.Logger.info(`BrokeredPermissionDataProvider: ${p} permissions are: `+t.permission),"default"!==t.permission)break}}let r;return t&&"default"!==t.permission?(r=t,l.CookieDataProvider.set("_pnpds",t.host)):r=e,c.Logger.info("BrokeredPermissionDataProvider: Calculated permissions are: "+r.permission),r})}removeRegistration(){return i(this,void 0,void 0,function*(){const s=[(0,u.getSelf)().location.hostname];let e=yield this.unregisterWorker();if(!e&&(this.messengerClient&&(s.push(this.messengerClient.connectedHost),e=yield a.sendUnregisterRequest(this.messengerClient)),!e)){var t=l.CookieDataProvider.get("_pnpds");if(t&&-1===s.indexOf(t)&&(s.push(t),t=this.context.app.getBrokeredFrameMessengerPath(t),yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(t),e=(yield a.sendUnregisterRequest(this.messengerClient))||e),!e)for(const o of this.context.domain.whitelistDomains)if(l.CookieDataProvider.getDomain(o)===l.CookieDataProvider.getDomain()&&-1===s.indexOf(o)){var i=this.context.app.getBrokeredFrameMessengerPath(o);if(yield this.messengerClientConnectionPool.release(this.messengerClient),this.messengerClient=yield this.messengerClientConnectionPool.checkout(i),e=(yield a.sendUnregisterRequest(this.messengerClient))||e)break}}return c.Logger.info("BrokeredPermissionDataProvider: Registration removed "+e),e})}static getCalculatedPermissions(e){return i(this,void 0,void 0,function*(){try{const s=yield(0,n.awaitUntil)(e.send(h.PermissionBrokerTopic.PERMISSION_GET_PUSH_PERMISSION),500);return s&&"denied"===s.permission&&"blocked"!==l.CookieDataProvider.get("_pnss")&&(s.permission="default"),s}catch(s){throw new d.NoResponseException(new Error("Failed to get calculated permissions due to timeout."))}})}static sendUnregisterRequest(e){return i(this,void 0,void 0,function*(){let s=!1;try{s=yield(0,n.awaitUntil)(e.send(p.MessengerTopic.SERVICE_WORKER_UNREGISTER),500)}catch(s){}return s})}}e.BrokeredPermissionDataProvider=a},"./src/sdk/data-providers/brokered-session.data-provider.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.BrokeredSessionDataProvider=void 0,t("./src/sdk/data-providers/abstract-session.data-provider.ts"));const n=t("./src/sdk/enums/session-broker-topic.enum.ts");class r extends o.AbstractSessionDataProvider{constructor(s){super(),this.messengerClient=s}set(s,e){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_SET,[s,e])})}get(s){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET,[s])})}remove(s){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_REMOVE,[s])})}getCurrentPageViews(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET_CURRENT_PAGE_VIEWS)})}getCurrentTotalPageViews(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET_CURRENT_TOTAL_PAGE_VIEWS)})}setRootDomainPermissionData(s){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_SET,["rdpData",s])})}getRootDomainPermissionData(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET,["rdpData"])})}clearRootDomainPermissionData(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_REMOVE,["rdpData"])})}getCurrentSession(){return i(this,void 0,void 0,function*(){return this.messengerClient.send(n.SessionBrokerTopic.SESSION_GET_CURRENT_SESSION)})}}e.BrokeredSessionDataProvider=r},"./src/sdk/data-providers/cookie.data-provider.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CookieDataProvider=void 0;const r=t("./src/_utils/global-env.ts"),o=t("./src/sdk/services/logging.service.ts");function p(){return!("WorkerGlobalScope"in self)}e.CookieDataProvider=class{static get isIsolatedMode(){return!!this.domain&&this.domain.hasFlag("USE_ISOLATED_COOKIE_STORAGE_LOCATION")}static get document(){return(0,r.getDocument)()}static get location(){return(0,r.getLocation)()}static getDomain(s){let e=s||(0,r.getSelf)().location.hostname;return this.isIsolatedMode||(e=this.domain.whitelistDomains&&1==this.domain.whitelistDomains.length?this.domain.whitelistDomains[0]:(s=>{const e=(0,r.getDocument)();let t,i,o="_sw_tld_check=cookie",n=(s||e.location.hostname).split(".");for(t=n.length-2;0<=t;t--)if(i=n.slice(t).join("."),e.cookie=o+";domain=."+i+";SameSite=strict;",-1<e.cookie.indexOf(o))return e.cookie=o.split("=")[0]+"=;domain=."+i+";SameSite=strict;expires=Thu, 01 Jan 1970 00:00:01 GMT;",i})(s))||"localhost"!==(e=(0,r.getSelf)().location.hostname)&&(e="."+e.split(".").splice(-2).join(".")),e}static set(e,t,i=730,o="d"){if(p()){null==t&&(i=-1);try{const r=new Date;var n=this.getDomain();let s=1;switch(o){case"d":case"days":s=86400;break;case"h":case"hours":s=3600;break;case"m":case"minutes":s=60}return r.setTime(r.getTime()+i*s*1e3),this.document.cookie=`${this.buildName(e)}=${t};expires=${r.toUTCString()};path=/;domain=${n};SameSite=Strict`,t}catch(s){}}}static setWithRawExpires(s,e,t){if(p())try{var i=this.getDomain();return this.document.cookie=this.buildName(s)+`=${e};expires=${t};path=/;domain=${i};SameSite=Strict`,e}catch(s){o.Logger.warn(s)}}static get(i,s=null){if(p()){var o=this.document.cookie.split(";");for(let t=0;t<o.length;t++){let s=o[t],e=s.split("=");if(e[0].trim()===this.buildName(i))return e[1].trim()}return s}}static getmv(s,e=null,t=null){let i=this.get(s,null);return null===i&&null!==t&&this.has(t)&&(i=this.get(t,e),this.clear(t),null!==i&&this.set(s,i)),i||e}static clear(s){return this.set(s,null,-1)}static has(s){return null!==this.get(s)}static buildName(s){return this.isIsolatedMode?s+"_"+this.domain.domainKey.substr(-8):s}}},"./src/sdk/data-providers/event.data-provider.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.EventManager=e.EventDataProvider=void 0;const o=t("./src/sdk/enums/messenger-topic.enum.ts"),n=t("./src/sdk/enums/amp-message-topic.enum.ts"),r=t("./src/sdk/enums/event-type.enum.ts"),p=t("./src/sdk/exceptions/invalid-event.exception.ts"),l=t("./src/sdk/enums/session-broker-topic.enum.ts"),u=t("./src/sdk/enums/permission-broker-topic.enum.ts"),d=t("./src/sdk/utils.ts");class c{constructor(){this.listeners={}}on(s,e){var t;const i=[];for(t of Array.isArray(s)?s:[s]){t=t.trim(),this.validateEventType(t);let s=(0,d.randomString)();var o=t.split(".");o&&2===o.length&&(t=o[0],s=o[1]),this.listeners[t]=this.listeners[t]||{},this.listeners[t][s]=e,i.push(this.unregisterCallback(t,s))}return Array.isArray(s)?i:i[0]}once(s,t){const e=Array.isArray(s)?s:[s],i=[];return e.forEach(s=>{s=s.trim();this.validateEventType(s);let e;e=this.on(s,s=>{null!=s?t(s):t(),e()}),i.push(e)}),Array.isArray(s)?i:i[0]}dispatch(n){return i(this,void 0,void 0,function*(){this.validateEventType(n.type);var s,e,t=this.listeners[n.type]||{};const i=[];for(s of Object.keys(t)){const o=t[s];null!=n.data?(e=Array.isArray(n.data)?n.data:[n.data],i.push(o(...e))):i.push(o())}yield Promise.all(i)})}unregisterCallback(s,e){return()=>{this.listeners[s][e]&&delete this.listeners[s][e]}}validateEventType(s){const e=[].concat(Object.keys(r.EventType).map(s=>r.EventType[s]),Object.keys(o.MessengerTopic).map(s=>o.MessengerTopic[s]),Object.keys(n.AmpMessageTopic).map(s=>n.AmpMessageTopic[s]),Object.keys(l.SessionBrokerTopic).map(s=>l.SessionBrokerTopic[s]),Object.keys(u.PermissionBrokerTopic).map(s=>u.PermissionBrokerTopic[s]));if(-1===e.indexOf(s))throw new p.InvalidEventException(s)}}e.EventDataProvider=c,e.EventManager=new c},"./src/sdk/data-providers/local-permission.data-provider.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},t=(Object.defineProperty(e,"__esModule",{value:!0}),e.LocalPermissionDataProvider=void 0,t("./src/sdk/data-providers/abstract-permission.data-provider.ts"));class o extends t.AbstractPermissionDataProvider{getPushPermission(){return i(this,void 0,void 0,function*(){return this.getLocalPermissions()})}removeRegistration(){return i(this,void 0,void 0,function*(){return this.unregisterWorker()})}}e.LocalPermissionDataProvider=o},"./src/sdk/data-providers/local-session.data-provider.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.LocalSessionDataProvider=void 0,t("./src/sdk/data-providers/abstract-session.data-provider.ts"));const n=t("./src/_utils/global-env.ts"),r=t("./src/sdk/services/logging.service.ts"),p="pushly-session";class l extends o.AbstractSessionDataProvider{set(e,t){return i(this,void 0,void 0,function*(){const s=yield this.getCurrentSession();s[e]=t,l.store.setItem(p,JSON.stringify(s))})}get(s){return i(this,void 0,void 0,function*(){return(yield this.getCurrentSession())[s]})}remove(s){return i(this,void 0,void 0,function*(){return l.store.removeItem(s)})}getCurrentTotalPageViews(){return i(this,void 0,void 0,function*(){return((yield this.getCurrentSession()).pageViews||[]).length})}setRootDomainPermissionData(s){return i(this,void 0,void 0,function*(){yield this.set("rdpData",s)})}getRootDomainPermissionData(){return i(this,void 0,void 0,function*(){return this.get("rdpData")})}clearRootDomainPermissionData(){return i(this,void 0,void 0,function*(){yield this.remove("rdpData")})}getCurrentPageViews(){return i(this,void 0,void 0,function*(){return(yield this.getCurrentSession()).pageViews})}getCurrentSession(){return i(this,void 0,void 0,function*(){var e={sessionStart:Date.now(),pageViews:[]};const t=l.store;let i=t.getItem(p);if(i)try{i=JSON.parse(i)}catch(s){r.Logger.warn("Corrupt session encountered. Resetting current session."),i=Object.assign({},e),t.setItem(p,JSON.stringify(i))}else i=Object.assign({},e),t.setItem(p,JSON.stringify(i));return i.sessionStart||(r.Logger.warn("Corrupt session encountered. Resetting current session."),i=Object.assign({},e),t.setItem(p,JSON.stringify(i))),i})}static get store(){return(0,n.getSelf)().sessionStorage}}e.LocalSessionDataProvider=l},"./src/sdk/enums/amp-message-topic.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AmpMessageTopic=void 0,(e=e.AmpMessageTopic||(e.AmpMessageTopic={})).CONNECT_HANDSHAKE="topic-connect-handshake",e.NOTIFICATION_PERMISSION_STATE="topic-notification-permission-state",e.SERVICE_WORKER_STATE="topic-service-worker-state",e.SERVICE_WORKER_REGISTRATION="topic-service-worker-registration",e.SERVICE_WORKER_QUERY="topic-service-worker-query",e.STORAGE_GET="topic-storage-get"},"./src/sdk/enums/amp-worker-message-topic.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AmpWorkerMessageTopic=void 0,(e=e.AmpWorkerMessageTopic||(e.AmpWorkerMessageTopic={})).AMP_SUBSCRIPTION_STATE="amp-web-push-subscription-state",e.AMP_SUBSCRIBE="amp-web-push-subscribe",e.AMP_UNSUBSCRIBE="amp-web-push-unsubscribe"},"./src/sdk/enums/bell-prompt-display-behavior.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BellPromptDisplayBehavior=void 0,(e=e.BellPromptDisplayBehavior||(e.BellPromptDisplayBehavior={})).ALWAYS="ALWAYS",e.PRE_SUBSCRIPTION="PRE_SUBSCRIPTION",e.POST_SUBSCRIPTION="POST_SUBSCRIPTION"},"./src/sdk/enums/consent.enum.ts":(s,e)=>{"use strict";var t;Object.defineProperty(e,"__esModule",{value:!0}),e.ConsentStatus=e.ConsentEventKeys=void 0,(t=e.ConsentEventKeys||(e.ConsentEventKeys={})).CONSENT_REQUIRED="ca_rq",t.CONSENT_STATUS="ca_st",(t=e.ConsentStatus||(e.ConsentStatus={}))[t.UNCONFIRMED=0]="UNCONFIRMED",t[t.CONFIRMED=1]="CONFIRMED"},"./src/sdk/enums/debug-cookie-code.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DebugCookieCode=void 0,(e=e.DebugCookieCode||(e.DebugCookieCode={})).sdk_impression="si",e.load_failed="lf",e.web_push_unsupported="unsp",e.mixed_integration="mxi",e.apns_not_configured="apl0",e.apns_not_enabled="apl1",e.apns_invalid_config="apl2",e.host_not_whitelisted="wlx",e.no_eligible_prompts="prx",e.platform_disabled_mobile="pldm",e.platform_disabled_desktop="pldd",e.prompt_ineligible_fcap="prif",e.user_permission_denied="updn",e.user_permission_dismissed="updm",e.user_permission_granted="upgr",e.user_ineligible="ui",e.referrer_allow="rfa",e.referrer_ignore="rfi",e.referrer_block="rfb"},"./src/sdk/enums/event-priority.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventPriority=void 0,(e=e.EventPriority||(e.EventPriority={}))[e.QUEUED=0]="QUEUED",e[e.IMMEDIATE=1]="IMMEDIATE"},"./src/sdk/enums/event-type.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventType=void 0,(e=e.EventType||(e.EventType={})).CONFIRM_CONSENT="confirm_consent",e.EXISTING_SUBSCRIPTION_DETECTED="existing_subscription_detected",e.APPLICATION_LOAD="load",e.APPLICATION_LOADED="loaded",e.APPLICATION_LOAD_ERROR="load_error",e.APPLICATION_LOAD_FAILED="load_failed",e.APPLICATION_READY="ready",e.APPLICATION_ERROR="error",e.EXIT_PERMISSIONS_DISMISSED="permission_previously_dismissed",e.EXIT_PERMISSIONS_DENIED="permission_previousy_denied",e.WEB_PUSH_SUPPORTED="web_push_supported",e.WEB_PUSH_NOT_SUPPORTED="web_push_unsupported",e.WEB_PUSH_NOT_CONFIGURED="web_push_not_configured",e.REQUEST_USER_DELETION="request_user_deletion",e.REVERT_USER_DELETION="revert_user_deletion",e.USER_DELETION_REQUEST="user_deletion_request",e.DOMAIN_APNS_NOT_CONFIGURED="apns_not_configured",e.DOMAIN_APNS_NOT_ENABLED="apns_not_enabled",e.DOMAIN_APNS_INVALID_CONFIG="apns_invalid_config",e.PROFILE_UPDATE="profile",e.PROFILE_UPDATE_EXTERNAL_ID="external_id",e.PROFILE_UPDATE_TAGS="tag",e.PROFILE_UPDATE_USER_EVENT="event",e.PROFILE_APPEND="profile_append",e.PROFILE_REMOVE="profile_remove",e.PROFILE_DEREGISTER_EXTERNAL_ID="deregister_external_id",e.PAGE_TAG_VISIT="page_tag_visit",e.PROXY_PERMISSION_DIALOG_LOAD="proxy_permission_dialog",e.PROXY_FRAME_HELPER_LOAD="proxy_frame_helper",e.AMP_FRAME_HELPER_LOAD="amp_frame_helper",e.AMP_PERMISSION_DIALOG_LOAD="amp_permission_dialog",e.AMP_HANDSHAKE="handshake",e.AMP_CONNECT="connect",e.FLOW_LOADED="flow_loaded",e.BROKERED_DATA_SERVER_LOAD="brokered_data_server",e.NO_ELIGIBLE_PROMPTS="no_eligible_prompts",e.PROMPT_ELIGIBLE="prompt_eligible",e.PROMPT_INELIGIBLE="prompt_ineligible",e.PROMPT_SHOW="show_prompt",e.PROMPT_SHOWN="prompt_shown",e.PROMPT_ALLOWED="prompt_allowed",e.PROMPT_DISMISSED="prompt_dismissed",e.PROMPT_HIDE="prompt_hide",e.PROMPT_DISABLED="prompt_disabled",e.FOLLOW_SHOWN="prompt_shown",e.FOLLOWED="followed",e.SW_INSTALLED="sw_installed",e.SW_SETUP_COMPLETE="sw_setup_complete",e.REGISTRATION_ATTEMPT="attempt_registration",e.REGISTRATION_SUBSCRIBED="subscribed",e.REGISTRATION_UNSUBSCRIBED="unsubscribed",e.REGISTRATION_MIGRATED="migrated",e.LEGACY_PERMISSION_DIALOG_SHOWN="permission_prompted",e.PERMISSION_DIALOG_SHOWN="permission_shown",e.LEGACY_PERMISSION_GRANTED="permission_accepted",e.PERMISSION_GRANTED="permission_allowed",e.PERMISSION_DISMISSED="permission_dismissed",e.PERMISSION_DENIED="permission_denied",e.FCM_TOKEN_REFRESH="token_refreshed",e.VIEW_ITEM="view_item",e.SAVE_ITEM="save_item",e.ADD_TO_CART="add_to_cart",e.UPDATE_CART_ITEM="update_cart_item",e.PURCHASE="purchase"},"./src/sdk/enums/exception-message.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExceptionMessage=void 0,(e=e.ExceptionMessage||(e.ExceptionMessage={})).ENV_NOT_SUPPORTED="Environment is not supported.",e.USER_ABORT_REQUESTED="Aborting execution due to user request.",e.FLOW_NOT_SUPPORTED_IN_EVENT_MODE="Current flow is not supported in event only mode.",e.SDK_ALREADY_LOADED="SDK has already been loaded.",e.DUPLICATE_SDK_INSTANCE="Another instance of the Pushly SDK is already running.",e.WORKER_LOAD_FAILED="ServiceWorker could not be loaded.",e.MIGRATION_FAILED="Pushly data migration failed.",e.DOMAIN_KEY_NOT_SPECIFIED="Domain key must be specified",e.DOMAIN_UNABLE_TO_LOAD="Domain settings could not be loaded.",e.DOMAIN_APNS_NOT_CONFIGURED="Domain is not configured for use with Safari.",e.DOMAIN_APNS_NOT_ENABLED="Domain is currently disabled on Safari.",e.DOMAIN_APNS_INVALID_CONFIG="Domain configuration is invalid.",e.MIXED_INTEGRATION="Domain was configured to use both a proxy integration and native prompt.",e.HOST_NOT_WHITELISTED="Current host is not whitelisted for use",e.EXISTING_SUBSCRIPTION_DETECTED="An existing Pushly subscription has been detected",e.DIRECT_INTEGRATION_NOT_SECURE="Environment is not secure. The ServiceWorker cannot be loaded.",e.USER_UNABLE_TO_LOAD="User could not be initialized.",e.USER_INVALID_PUSH_PACKAGE="Subscription state cannot be determined.",e.USER_STATE_DENIED="Subscription state is currently set to denied.",e.USER_STATE_DISMISSED="Subscription state is currently set to dismissed.",e.USER_STATE_UNSUBBED="Subscription state is currently set to unsubscribed.",e.FAILED_TO_GET_GRANTED_TOKEN="Failed to fetch token from subscription endpoint after permission was granted. Exiting flow.",e.APNS_FAILED_TO_GET_GRANTED_TOKEN="Failed to fetch token from APNS after permission was granted. Exiting flow.",e.INVALID_TOKEN_TYPE="Token is not a valid string"},"./src/sdk/enums/integration-type.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IntegrationType=void 0,(e=e.IntegrationType||(e.IntegrationType={})).DIRECT="direct",e.PROXY="proxy"},"./src/sdk/enums/messenger-topic.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MessengerTopic=void 0,(e=e.MessengerTopic||(e.MessengerTopic={})).CONNECT_HANDSHAKE="topic-connect-handshake",e.SERVICE_WORKER_UNREGISTER="topic-service-worker-unregister"},"./src/sdk/enums/notification-permission-state.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NotificationPermissionState=void 0,(e=e.NotificationPermissionState||(e.NotificationPermissionState={})).DEFAULT="default",e.GRANTED="granted",e.DENIED="denied"},"./src/sdk/enums/permission-broker-topic.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PermissionBrokerTopic=void 0,(e.PermissionBrokerTopic||(e.PermissionBrokerTopic={})).PERMISSION_GET_PUSH_PERMISSION="permission-get-push-permission"},"./src/sdk/enums/prompt-referrer-condition.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PromptReferrerCondition=void 0,(e=e.PromptReferrerCondition||(e.PromptReferrerCondition={})).ALLOW="allow",e.IGNORE="ignore",e.BLOCK="block"},"./src/sdk/enums/prompt-style.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PromptStyle=void 0,(e=e.PromptStyle||(e.PromptStyle={})).Native="NATIVE",e.Custom="PUBLISHER_CUSTOM",e.Slide="SLIDE",e.Bell="BELL"},"./src/sdk/enums/runtime-environment.enum.ts":(s,e)=>{"use strict";var t,i;Object.defineProperty(e,"__esModule",{value:!0}),e.RuntimeEnvironmentName=e.RuntimeEnvironment=void 0,(i=t=e.RuntimeEnvironment||(e.RuntimeEnvironment={}))[i.DIRECT=100]="DIRECT",i[i.PROXY=200]="PROXY",i[i.PROXY_PERMISSION_DIALOG=201]="PROXY_PERMISSION_DIALOG",i[i.PROXY_FRAME_HELPER=202]="PROXY_FRAME_HELPER",i[i.AMP=300]="AMP",i[i.AMP_PERMISSION_DIALOG=301]="AMP_PERMISSION_DIALOG",i[i.AMP_FRAME_HELPER=302]="AMP_FRAME_HELPER",i[i.BROKERED_DATA_SERVER=400]="BROKERED_DATA_SERVER",i[i.SERVICE_WORKER=1e3]="SERVICE_WORKER",e.RuntimeEnvironmentName={[t.DIRECT]:"Direct",[t.PROXY]:"Proxy",[t.PROXY_PERMISSION_DIALOG]:"Proxy Permission Dialog",[t.PROXY_FRAME_HELPER]:"Proxy Frame Helper",[t.AMP]:"AMP",[t.AMP_PERMISSION_DIALOG]:"AMP Permission Dialog",[t.AMP_FRAME_HELPER]:"AMP Frame Helper",[t.BROKERED_DATA_SERVER]:"Brokered Data Server",[t.SERVICE_WORKER]:"Service Worker"}},"./src/sdk/enums/session-broker-topic.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SessionBrokerTopic=void 0,(e=e.SessionBrokerTopic||(e.SessionBrokerTopic={})).SESSION_GET="session-get",e.SESSION_SET="session-set",e.SESSION_REMOVE="session-remove",e.SESSION_GET_CURRENT_PAGE_VIEWS="session-get-current-page-views",e.SESSION_GET_CURRENT_TOTAL_PAGE_VIEWS="session-get-current-total-page-views",e.SESSION_GET_CURRENT_SESSION="session-get-current-session"},"./src/sdk/enums/steamable-event-type.enum.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StreamableEventType=void 0,(e=e.StreamableEventType||(e.StreamableEventType={})).ERROR="error",e.UDR="udr",e.ANONYMOUS_PAGE_VIEW="anonymous_view_page",e.PAGE_VIEW="view_page",e.PAGE_TAG_VISITS="page_tag_visit",e.PROMPT_SHOWN="prompt_shown",e.PROMPT_ALLOWED="prompt_allow",e.PROMPT_DISMISSED="prompt_dismiss",e.PROMPT_NOT_SHOWN="prompt_not_shown",e.FOLLOW_SHOWN="follow_shown",e.FOLLOWED="follow",e.PERMISSION_PROMPTED="permission_prompted",e.PERMISSION_ACCEPTED="permission_accepted",e.PERMISSION_DENIED="permission_denied",e.PERMISSION_DISMISSED="permission_dismissed",e.SUBSCRIBED="subscribed",e.MIGRATED="migrated",e.SUBSCRIPTION_CHANGED="subscription_changed",e.TOKEN_REFRESHED="token_refreshed",e.UNSUBSCRIBED="unsubscribed",e.MANUAL_UNSUBSCRIBED="manual_unsubscribed",e.PROXY_WINDOW_BLOCKED="proxy_window_blocked",e.PROXY_WINDOW_OPENED="proxy_window_opened",e.PROXY_WINDOW_CLOSED="proxy_window_closed",e.PROFILE_UPDATE="profile",e.PROFILE_APPEND="profile_append",e.PROFILE_REMOVE="profile_remove",e.DEREGISTER_EXTERNAL_ID="deregister_external_id",e.SDK_IMPRESSION="sdk_impression",e.VIEW_ITEM="view_item",e.SAVE_ITEM="save_item",e.ADD_TO_CART="add_to_cart",e.UPDATE_CART_ITEM="update_cart_item",e.PURCHASE="purchase"},"./src/sdk/exceptions/domain-load.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DomainLoadException=void 0;var i=t("./src/sdk/exceptions/pushly.exception.ts");const o=t("./src/sdk/enums/exception-message.enum.ts"),n=["Failed to Fetch","Retry fetch failed","NetworkError when attempting to fetch","Network request failed","The internet connection appears to be offline","A server with the specified hostname could not be found"];class r extends i.PushlyException{constructor(s){super(s,o.ExceptionMessage.DOMAIN_UNABLE_TO_LOAD,r),this.blacklistedErrors=n,this.name="DomainLoadException"}}e.DomainLoadException=r},"./src/sdk/exceptions/exit.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExitException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(s,e){"string"==typeof s&&(e=s,s=null),super(s,e,i),this.name="ExitException"}}e.ExitException=i},"./src/sdk/exceptions/fail.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FailException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(s,e){"string"==typeof s&&(e=s,s=null),super(s,e,i),this.name="FailException"}}e.FailException=i},"./src/sdk/exceptions/invalid-event.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InvalidEventException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(s){super(null,`Invalid event '${s}' specified.`,i),this.name="InvalidEventException"}}e.InvalidEventException=i},"./src/sdk/exceptions/no-connection.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NoConnectionException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(s){super(s),this.name="NoConnectionException"}}e.NoConnectionException=i},"./src/sdk/exceptions/no-response.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NoResponseException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(s){super(s),this.name="NoResponseException"}}e.NoResponseException=i},"./src/sdk/exceptions/profile.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ProfileException=void 0;class i extends t("./src/sdk/exceptions/pushly.exception.ts").PushlyException{constructor(s,e){"string"==typeof s&&(e=s,s=null),super(s,e,i),this.name="ProfileException"}}e.ProfileException=i},"./src/sdk/exceptions/pushly.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PushlyException=void 0;const o=t("./src/common/utils.ts"),n=["Invalid argument","無効な引数です","参数无效","Недопустимый аргумент","Ungültiges Argument","Nieprawidłowy argument","Ongeldig argument","Ogiltigt argument","Argumento inválido","Argomento non valido","Virheellinen argumentti","Argument non valide"];class i extends Error{constructor(s,e,t=i){super(e||s.message),this.isPushlyException=!0,this.suppressed=!1,this.blacklistedErrors=[],this.name="PushlyException",this.originError=s;try{Object.setPrototypeOf(this,t.prototype)}catch(s){}}shouldSuppress(){if(this.suppressed)return!0;let s=this.suppressed;var e=this.originError||this;if(!s&&0<this.blacklistedErrors.length){const t=(0,o.buildRegexFromArray)(this.blacklistedErrors);s=t.test(this.name)||t.test(this.message)||t.test(e.name)||t.test(e.message)}if(!s){const i=(0,o.buildRegexFromArray)(n);s=i.test(this.name)||i.test(this.message)||i.test(e.name)||i.test(e.message)}return s}}e.PushlyException=i},"./src/sdk/exceptions/worker-registration.exception.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerRegistrationException=void 0;var i=t("./src/sdk/exceptions/pushly.exception.ts");const o=t("./src/sdk/enums/exception-message.enum.ts"),n=["ServiceWorker script evaluation failed","An unknown error occurred when fetching the script","Encountered an error during installation","Operation has been aborted","Operation was aborted","ServiceWorker cannot be started","Timed out while trying to start the service worker","Worker system has shutdown","Could not find a renderer process to run a service worker","The user denied permission to use Service Worker","An attempt was made to use an object that is not, or is no longer, usable","Request to fetch the script was interrupted","HTTP response code .?(4|5)[\\d]{2}.? was received","An SSL certificate error occurred","An SSL error has occurred","SecurityError","Please ensure that .messagingSenderId. is set correctly","The expression cannot be converted to return the specified type"];class r extends i.PushlyException{constructor(s){super(s,o.ExceptionMessage.WORKER_LOAD_FAILED,r),this.blacklistedErrors=n,this.name="WorkerRegistrationException"}}e.WorkerRegistrationException=r},"./src/sdk/factories/data-provider-factory.ts":function(s,e,t){"use strict";var p=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DataProviderFactory=void 0;const i=t("./src/sdk/data-providers/local-session.data-provider.ts"),l=t("./src/sdk/data-providers/brokered-session.data-provider.ts"),o=t("./src/sdk/data-providers/brokered-permission.data-provider.ts"),n=t("./src/sdk/data-providers/local-permission.data-provider.ts"),u=t("./src/sdk/cross-frame-messenger/messenger-client-connection-pool.ts"),d=t("./src/_utils/global-env.ts"),c=t("./src/sdk/enums/runtime-environment.enum.ts"),h=t("./src/sdk/services/logging.service.ts");class r{static getSessionDataProvider(r){return p(this,void 0,void 0,function*(){if(!this.sessionDataProvider){const n=r.domain.whitelistDomains?r.domain.whitelistDomains[0]:(0,d.getSelf)().location.hostname;r.runtimeEnvironment!==c.RuntimeEnvironment.BROKERED_DATA_SERVER&&r.domain.hasFlag("FEAT_USE_DATA_BROKER")&&n!==(0,d.getSelf)().location.hostname?(h.Logger.info("Using BrokeredSessionDataProvider"),this.sessionDataProvider=new Promise((i,o)=>p(this,void 0,void 0,function*(){var s=r.app.getBrokeredFrameMessengerPath(n);try{const t=new u.MessengerClientConnectionPool;var e=yield t.checkout(s);i(new l.BrokeredSessionDataProvider(e))}catch(s){o(s)}}))):(h.Logger.info("Using LocalSessionDataProvider"),this.sessionDataProvider=Promise.resolve(new i.LocalSessionDataProvider))}return this.sessionDataProvider})}static getPermissionDataProvider(t){return p(this,void 0,void 0,function*(){return this.permissionDataProvider||(t.runtimeEnvironment!==c.RuntimeEnvironment.BROKERED_DATA_SERVER&&t.domain.hasFlag("FEAT_USE_DATA_BROKER")&&!t.env.isSafari()?(h.Logger.info("Using BrokeredPermissionDataProvider"),this.permissionDataProvider=new Promise((s,e)=>p(this,void 0,void 0,function*(){s(new o.BrokeredPermissionDataProvider(t))}))):(h.Logger.info("Using LocalPermissionDataProvider"),this.permissionDataProvider=Promise.resolve(new n.LocalPermissionDataProvider(t)))),this.permissionDataProvider})}}(e.DataProviderFactory=r).permissionDataProvider=null,r.sessionDataProvider=null},"./src/sdk/factories/flow.factory.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlowFactory=void 0;const o=t("./src/sdk/flows/proxy.flow.ts"),n=t("./src/sdk/flows/amp-frame-helper.flow.ts"),r=t("./src/sdk/enums/exception-message.enum.ts"),p=t("./src/sdk/enums/runtime-environment.enum.ts"),l=t("./src/sdk/flows/direct.flow.ts"),u=t("./src/sdk/flows/brokered-data-server.flow.ts"),d=t("./src/sdk/flows/proxy-permission-dialog.flow.ts"),c=t("./src/sdk/exceptions/exit.exception.ts"),h=t("./src/sdk/flows/amp-permission-dialog.flow.ts");e.FlowFactory=class{static getFlow(s){let e=s.env.primaryRuntimeEnvironment;var t=s.env.subRuntimeEnvironment;t&&(e=t);const i={[p.RuntimeEnvironment.DIRECT]:l.DirectFlow,[p.RuntimeEnvironment.PROXY]:o.ProxyFlow,[p.RuntimeEnvironment.PROXY_PERMISSION_DIALOG]:d.ProxyPermissionDialogFlow,[p.RuntimeEnvironment.AMP_PERMISSION_DIALOG]:h.AmpPermissionDialogFlow,[p.RuntimeEnvironment.AMP_FRAME_HELPER]:n.AmpFrameHelperFlow,[p.RuntimeEnvironment.BROKERED_DATA_SERVER]:u.BrokeredDataServerFlow}[e];if(s.domain.isEventOnlyMode()&&i!==l.DirectFlow)throw new c.ExitException(r.ExceptionMessage.FLOW_NOT_SUPPORTED_IN_EVENT_MODE);return new i(s)}}},"./src/sdk/factories/prompt.factory.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PromptFactory=void 0;const c=t("./src/sdk/enums/prompt-style.enum.ts"),i=t("./src/sdk/prompts/native.prompt.ts"),o=t("./src/sdk/prompts/custom.prompt.ts"),h=t("./src/sdk/services/logging.service.ts");var n=t("./src/sdk/models/events/eventable.model.ts");const r=t("./src/sdk/prompts/slide.prompt.ts"),p=t("./src/sdk/prompts/bell.prompt.ts");class l extends n.EventableModel{static getPrompts(t,s={}){const i=[],e=this._selectEligiblePrompts(t,s);return 0<e.length?e.forEach(s=>{const e=this._selectPromptClass(s.prompt.style);i.push(new e(t,s))}):(this.debugPromptNotShown(t,"no_eligible_prompts"),h.Logger.info("No eligible prompts found")),i}static getPromptById(s,e){const t={};let i;if(t.prompt=s.domain.prompts.find(s=>s.id.toString()===e.toString()),t.prompt&&(t.group=s.domain.promptGroups.find(s=>s.id.toString()===t.prompt.prompt_group_id.toString())),t.group){const o=this._selectPromptClass(t.prompt.style);i=new o(s,t)}return i}static _selectPromptClass(s){return{[c.PromptStyle.Native]:i.NativePrompt,[c.PromptStyle.Slide]:r.SlidePrompt,[c.PromptStyle.Bell]:p.BellPrompt,[c.PromptStyle.Custom]:o.CustomPrompt}[s]}static _selectEligiblePrompts(n,s=0){const r=[],p=n.user.env.location.href||"",l=n.user.env.getCurrentMetaKeywords(),u=n.user.env.getDeviceType(),e=n.domain.promptGroups,d=n.domain.prompts,t=e.sort((s,e)=>s.priority>e.priority?1:s.priority<e.priority?-1:0);t.some(t=>{let s=!1,i=(n.env.requires2Step()&&(s=!0,h.Logger.info("Browser requiring 2-step detected. Filtering prompts for 2-Step experience.")),d.filter(s=>s.prompt_group_id===t.id));if(0<(i=s?i.filter(s=>s.style!==c.PromptStyle.Native):i).length){let s=!0,e;var o;return(s=t.conditions_json&&!(e=this._validatePromptConditions(n,t,u,p,l)).matched?!1:s)?(o=1===i.length?i[0]:this._pickWeightedRandomPrompt(i),r.push({group:t,prompt:o}),!0):!(!e||!e.stopEvaluation)||void 0}});let i;var o;return(i=(i=0<r.length?r[0]:i)&&i.group&&void 0!==i.group.display_to_pct&&(o=i.group.display_to_pct)<100&&o<Math.floor(100*Math.random())?void 0:i)?[i]:[]}static _validatePromptConditions(s,e,t,i,o){let n={matched:!0,stopEvaluation:!1};var r;return e.conditions_json&&(r=e.conditions_json.display||{},e=e.conditions_json.page||{},(n=this._validateDisplayConditions(r,t)).matched&&(r=this._validateMetaKeywordConditions(e,o),n.matched=r.matched),n.matched&&(t=this._validatePageUrlConditions(e,i),n.matched=t.matched)),n.stopEvaluation&&n.stopEvaluationReason&&this.debugPromptNotShown(s,n.stopEvaluationReason),n}static _validateDisplayConditions(s,e){const t={matched:!0,stopEvaluation:!1};return(s.mobile||s.desktop)&&(!(e="desktop"===e)&&t.matched&&s.mobile&&("pass"===s.mobile&&(t.matched=!1),"disabled"===s.mobile&&(t.matched=!1,t.stopEvaluation=!0,t.stopEvaluationReason="platform_disabled_mobile")),e&&t.matched&&s.desktop&&("pass"===s.desktop&&(t.matched=!1),"disabled"===s.desktop&&(t.matched=!1,t.stopEvaluation=!0,t.stopEvaluationReason="platform_disabled_desktop"))),t}static _validateMetaKeywordConditions(s,t){const i={matched:!0,stopEvaluation:!1};if(i.matched&&Array.isArray(s.keywords))if(0===t.length)i.matched=!1;else{let e=!1;s.keywords.some(s=>{if(-1!==t.indexOf(s))return e=!0}),i.matched=e}return i}static _validatePageUrlConditions(s,i){const e={matched:!0,stopEvaluation:!1};if(e.matched&&s.excluded_page_urls){let t=!1;Array.isArray(s.excluded_page_urls)&&0<s.excluded_page_urls.length&&s.excluded_page_urls.some(s=>{const e=new RegExp(this._prepareRgxUrl(s),"i");if(e.test(i))return t=!0}),e.matched=!t}if(e.matched&&s.page_urls){let t=!1;Array.isArray(s.page_urls)&&0<s.page_urls.length?s.page_urls.some(s=>{const e=new RegExp(this._prepareRgxUrl(s),"i");if(e.test(i))return t=!0}):t=!0,e.matched=t}return e}static _prepareRgxUrl(s){return s.replace(/\?/g,"\\?").replace(/\+|%20/g,"(?:\\+|%20)")}static _pickWeightedRandomPrompt(s){const e=[];for(var t of s)for(let s=0;s<t.weight;s++)e.push(t);return e[Math.floor(Math.random()*e.length)]}}e.PromptFactory=l},"./src/sdk/flows/amp-frame-helper.flow.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.AmpFrameHelperFlow=void 0;const o=t("./src/sdk/message-servers/amp-frame-helper-server.ts");var n=t("./src/sdk/flows/base.flow.ts");const r=t("./src/sdk/models/events/event.model.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/worker.service.ts");class u extends n.BaseFlow{constructor(s){super(s,!1)}_wireEvents(){this.ampFrameHelperServer=new o.AmpFrameHelperServer(this.context)}run(){return i(this,void 0,void 0,function*(){yield l.WorkerService.registerWorker(this.context),yield this.dispatch(new r.EventModel(p.EventType.FLOW_LOADED))})}}e.AmpFrameHelperFlow=u},"./src/sdk/flows/amp-permission-dialog.flow.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.AmpPermissionDialogFlow=void 0;const o=t("./src/sdk/constants.ts");var n=t("./src/sdk/flows/base.flow.ts");const r=t("./src/sdk/cross-frame-messenger/messenger-client.ts"),p=t("./src/common/utils.ts"),l=t("./src/sdk/models/events/event.model.ts"),u=t("./src/sdk/enums/amp-message-topic.enum.ts"),d=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/enums/notification-permission-state.enum.ts"),h=t("./src/sdk/services/registration.service.ts"),a=t("./src/sdk/services/logging.service.ts"),m=t("./src/sdk/services/worker.service.ts");class v extends n.BaseFlow{_wireEvents(){var s=this.handlePermissionGranted.bind(this),e=this.handlePermissionDenied.bind(this);this.watch(d.EventType.REGISTRATION_SUBSCRIBED,s),this.watch(d.EventType.PERMISSION_DENIED,e),this.watch(d.EventType.PERMISSION_DISMISSED,e)}run(){return i(this,void 0,void 0,function*(){this.messengerClient=new r.MessengerClient,yield this.messengerClient.connect(window.opener,0),yield m.WorkerService.registerWorker(this.context),this.loadLanternShark(),yield this.dispatch(new l.EventModel(d.EventType.FLOW_LOADED))})}loadLanternShark(){var s=this.context.domain.domainKey;const e=document.createElement("iframe");s=o.PROXY_URL+`/amp/${s}?pushly_domain_key=`+s;e.addEventListener("load",()=>i(this,void 0,void 0,function*(){try{this.initializeDialogContent(e.contentWindow),yield h.RegistrationService.performManualRegistrationAttempt(this.context,999)}catch(s){a.Logger.error(this.context,s)}})),e.setAttribute("src",s),e.setAttribute("frame-border","0"),e.setAttribute("style","width: 100vw; height: 100vh; border: none;"),document.body.appendChild(e)}initializeDialogContent(s){s.postMessage({action:"lite-reboot",data:{context:this.context}},"*")}handlePermissionGranted(){return i(this,void 0,void 0,function*(){try{yield(0,p.awaitUntil)(this.messengerClient.send(u.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,c.NotificationPermissionState.GRANTED),500)}catch(s){}window.close()})}handlePermissionDenied(){return i(this,void 0,void 0,function*(){try{yield(0,p.awaitUntil)(this.messengerClient.send(u.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,c.NotificationPermissionState.DENIED),500)}catch(s){}window.close()})}}e.AmpPermissionDialogFlow=v},"./src/sdk/flows/base.flow.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseFlow=void 0;const p=t("./src/sdk/utils.ts"),o=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),n=t("./src/sdk/models/events/base-streamable-event.model.ts"),r=t("./src/sdk/enums/steamable-event-type.enum.ts"),l=t("./src/sdk/factories/data-provider-factory.ts");var u=t("./src/sdk/models/events/eventable.model.ts");const d=t("./src/_utils/interval-runner.ts");class c extends u.EventableModel{constructor(s,e=!0){super(),this.context=s,this.isPromptableFlow=e,this.pageChangeTrackerStarted=!1,this._wireEvents()}_startPageChangeTracker(e){let t;var s=()=>i(this,void 0,void 0,function*(){var s=this.context.env.location.href;s!=t&&(this._logSessionPageView(s),(yield this.context.user.isSubscribed(this.context))?this.post(new o.SubscriberStreamableEventModel(r.StreamableEventType.PAGE_VIEW,{meta:{subscription_data:e}},this.context)):-1!==this.context.domain.flags.indexOf("FEAT_INFORMED_CONTENT")&&this.post(new n.BaseStreamableEventModel(r.StreamableEventType.ANONYMOUS_PAGE_VIEW,{meta:{page_url:s}},this.context))),t=s});this.pageChangeTrackerStarted||(this.pageChangeTrackerStarted=!0,(0,d.setIntervalRunner)(s,1e3))}_logSessionPageView(r){return i(this,void 0,void 0,function*(){try{const n=yield l.DataProviderFactory.getSessionDataProvider(this.context);var s,e=(0,p.hashFromString)(r),t=(yield n.getCurrentSession()).pageViews||[],i=0===t.length,o=!i&&t[t.length-1]!==e;(i||o)&&(s=[...t,e],yield n.set("pageViews",s))}catch(s){}})}}e.BaseFlow=c},"./src/sdk/flows/brokered-data-server.flow.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.BrokeredDataServerFlow=void 0,t("./src/sdk/flows/base.flow.ts"));const n=t("./src/sdk/message-servers/brokered-session-server.ts"),r=t("./src/sdk/message-servers/brokered-permission-server.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/cross-frame-messenger/messenger-server.ts"),d=t("./src/sdk/services/registration.service.ts");class c extends o.BaseFlow{constructor(s){super(s,!1)}_wireEvents(){this.brokeredSessionServer=new n.BrokeredSessionServer(u.MessengerServer.global),this.brokeredPermissionServer=new r.BrokeredPermissionServer(this.context,u.MessengerServer.global)}run(){return i(this,void 0,void 0,function*(){yield d.RegistrationService.tryMigration(this.context,!1),yield this.dispatch(new p.EventModel(l.EventType.FLOW_LOADED))})}}e.BrokeredDataServerFlow=c},"./src/sdk/flows/direct.flow.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.DirectFlow=void 0,t("./src/sdk/flows/base.flow.ts"));const n=t("./src/_utils/global-env.ts"),r=t("./src/sdk/models/events/event.model.ts"),p=t("./src/sdk/enums/exception-message.enum.ts"),l=t("./src/sdk/enums/runtime-environment.enum.ts"),u=t("./src/sdk/enums/event-type.enum.ts"),d=t("./src/sdk/services/registration.service.ts"),c=t("./src/sdk/exceptions/exit.exception.ts"),h=t("./src/sdk/services/worker.service.ts");class a extends o.BaseFlow{_wireEvents(){}run(){return i(this,void 0,void 0,function*(){var s=yield this.context.user.getComputedPushPermission(this.context);if(!this.context.domain.isEventOnlyMode()&&this.context.env.primaryRuntimeEnvironment!==l.RuntimeEnvironment.PROXY){if(this.context.env.isPushManagerInScope()){if(!this.context.env.isHTTPS()&&!this.context.env.isDevMode())throw new c.ExitException(p.ExceptionMessage.DIRECT_INTEGRATION_NOT_SECURE);this.context.domain.shouldUseVapid()&&!(yield this.context.user.isSubscribed(this.context))||s.host===(0,n.getSelf)().location.hostname&&(yield h.WorkerService.registerWorker(this.context))}yield d.RegistrationService.tryMigration(this.context)}this._startPageChangeTracker(s.subscription),yield this.dispatch(new r.EventModel(u.EventType.FLOW_LOADED))})}}e.DirectFlow=a},"./src/sdk/flows/proxy-permission-dialog.flow.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.ProxyPermissionDialogFlow=void 0,t("./src/sdk/flows/base.flow.ts"));const n=t("./src/sdk/models/events/event.model.ts"),r=t("./src/sdk/enums/event-type.enum.ts"),p=t("./src/sdk/services/logging.service.ts"),l=t("./src/sdk/services/worker.service.ts");class u extends o.BaseFlow{_wireEvents(){var s=this._handlePermissionPrompted.bind(this),e=this._handlePermissionGranted.bind(this),t=this._handlePermissionDismissed.bind(this),i=this._handlePermissionDenied.bind(this);this.watch(r.EventType.PERMISSION_DIALOG_SHOWN,s),this.watch(r.EventType.REGISTRATION_SUBSCRIBED,e),this.watch(r.EventType.PERMISSION_DISMISSED,t),this.watch(r.EventType.PERMISSION_DENIED,i)}run(){return i(this,void 0,void 0,function*(){this.context.env.isPushManagerInScope()&&(yield l.WorkerService.registerWorker(this.context)),yield this.dispatch(new n.EventModel(r.EventType.FLOW_LOADED))})}_handlePermissionPrompted(){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.PERMISSION_DIALOG_SHOWN,void 0,!1)})}_handlePermissionGranted(s){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.REGISTRATION_SUBSCRIBED,s)})}_handlePermissionDismissed(){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.PERMISSION_DISMISSED)})}_handlePermissionDenied(){return i(this,void 0,void 0,function*(){this._postMessage(r.EventType.PERMISSION_DENIED)})}_postMessage(s,e,t=!0){try{window.opener.postMessage({action:s,data:e},"*")}catch(s){p.Logger.warn(s)}finally{t&&this._closeWindow()}}_closeWindow(){setTimeout(()=>{window.close()})}}e.ProxyPermissionDialogFlow=u},"./src/sdk/flows/proxy.flow.ts":function(s,e,t){"use strict";var o=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},i=(Object.defineProperty(e,"__esModule",{value:!0}),e.ProxyFlow=void 0,t("./src/sdk/flows/direct.flow.ts"));const n=t("./src/sdk/models/events/event.model.ts"),r=t("./src/sdk/services/user.service.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/logging.service.ts");class u extends i.DirectFlow{_wireEvents(){var s=this._handleWindowMessage.bind(this);window.addEventListener("message",s)}run(){const s=Object.create(null,{run:{get:()=>super.run}});return o(this,void 0,void 0,function*(){yield r.UserService.reloadUserWithCachePriority(this.context.user),yield s.run.call(this)})}_handleWindowMessage(i){return o(this,void 0,void 0,function*(){try{var s=this.context.domain;if(-1!==i.origin.indexOf(s.customAllowDomain)){var e=i.data.action,t=i.data.data;switch(l.Logger.info("Got message from proxy window: "+e),e){case p.EventType.PERMISSION_DIALOG_SHOWN:yield this._handlePermissionPrompted();break;case p.EventType.REGISTRATION_SUBSCRIBED:yield this._handlePermissionAccepted(t);break;case p.EventType.PERMISSION_DISMISSED:yield this._handlePermissionDismissed();break;case p.EventType.PERMISSION_DENIED:yield this._handlePermissionDenied()}yield this.dispatch(new n.EventModel(e,t))}}catch(s){l.Logger.error(this.context,s)}})}_handlePermissionPrompted(){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_DIALOG_SHOWN,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId)))})}_handlePermissionAccepted(s){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_GRANTED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),yield r.UserService.setSubscriptionState(this.context.user,"subscribed",s)})}_handlePermissionDismissed(){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_DISMISSED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),yield r.UserService.setSubscriptionState(this.context.user,"dismissed")})}_handlePermissionDenied(){return o(this,void 0,void 0,function*(){this.dispatch(new n.EventModel(p.EventType.PERMISSION_DENIED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),yield r.UserService.setSubscriptionState(this.context.user,"blocked")})}_buildClientFeedbackEventPack(s=null,e=[]){return{prompt:{id:s,keywords:e}}}}e.ProxyFlow=u},"./src/sdk/message-servers/abstract-message-server.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractMessageServer=void 0;const i=t("./src/sdk/services/logging.service.ts");class o extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{andReply(s){return e=>{s(e.data).then(s=>{e.reply(s)}).catch(s=>{i.Logger.warn("MessageServerError encountered:",s)})}}}e.AbstractMessageServer=o},"./src/sdk/message-servers/amp-frame-helper-server.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.AmpFrameHelperServer=void 0,t("./src/sdk/message-servers/abstract-message-server.ts"));const n=t("./src/sdk/cross-frame-messenger/messenger-server.ts"),r=t("./src/sdk/enums/amp-message-topic.enum.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/amp-worker-message-topic.enum.ts"),u=t("./src/sdk/services/user.service.ts"),d=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/enums/notification-permission-state.enum.ts"),h=t("./src/sdk/services/registration.service.ts");class a extends o.AbstractMessageServer{constructor(s){super(),this.context=s,this.bindEvents()}bindEvents(){n.MessengerServer.global.watch(r.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,this.andReply(this.handlePermissionStateMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.SERVICE_WORKER_STATE,this.andReply(this.handleWorkerStateMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.SERVICE_WORKER_REGISTRATION,this.andReply(this.handleWorkerRegistrationMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.SERVICE_WORKER_QUERY,this.andReply(this.handleWorkerQueryMessage.bind(this))),n.MessengerServer.global.watch(r.AmpMessageTopic.STORAGE_GET,this.andReply(this.handleStorageGetMessage.bind(this)))}handlePermissionStateMessage(){return i(this,void 0,void 0,function*(){return{success:!0,result:!0}})}handleWorkerStateMessage(){return i(this,void 0,void 0,function*(){return{success:!0,result:{isControllingFrame:!!window.navigator.serviceWorker.controller,url:window.navigator.serviceWorker.controller?window.navigator.serviceWorker.controller.scriptURL.split("?")[0]:null,state:window.navigator.serviceWorker.controller?window.navigator.serviceWorker.controller.state:null}}})}handleWorkerRegistrationMessage(){return i(this,void 0,void 0,function*(){return{success:!0,result:null}})}handleWorkerQueryMessage(t){return i(this,void 0,void 0,function*(){const s=this.context.user;let e=null;switch(t.topic){case l.AmpWorkerMessageTopic.AMP_SUBSCRIPTION_STATE:e=yield s.isSubscribed(this.context);break;case l.AmpWorkerMessageTopic.AMP_UNSUBSCRIBE:yield h.RegistrationService.unsubscribe(this.context);break;case l.AmpWorkerMessageTopic.AMP_SUBSCRIBE:}return{success:!0,result:e}})}handleStorageGetMessage(){return i(this,void 0,void 0,function*(){const s=this.context.user;let e=c.NotificationPermissionState.DEFAULT;return(yield s.isSubscribed(this.context))&&(e=c.NotificationPermissionState.GRANTED,"subscribed"!==s.subscriberState&&(yield u.UserService.reloadUserWithCachePriority(s),yield this.dispatch(new p.EventModel(d.EventType.REGISTRATION_SUBSCRIBED,s.token)))),(s.isBlocked()||s.isDismissed())&&(e=c.NotificationPermissionState.DENIED,"none"===s.subscriberState&&(yield this.dispatch(new p.EventModel(d.EventType.PERMISSION_DENIED)))),{success:!0,result:e}})}}e.AmpFrameHelperServer=a},"./src/sdk/message-servers/brokered-permission-server.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BrokeredPermissionServer=void 0;const i=t("./src/sdk/data-providers/local-permission.data-provider.ts");var o=t("./src/sdk/message-servers/abstract-message-server.ts");const n=t("./src/sdk/enums/messenger-topic.enum.ts"),r=t("./src/sdk/enums/permission-broker-topic.enum.ts");class p extends o.AbstractMessageServer{constructor(s,e){super(),this.context=s,this.messengerServer=e,this.dataProvider=new i.LocalPermissionDataProvider(s),this.bindEvents()}bindEvents(){this.messengerServer.watch(r.PermissionBrokerTopic.PERMISSION_GET_PUSH_PERMISSION,this.andReply(this.dataProvider.getPushPermission.bind(this.dataProvider))),this.messengerServer.watch(n.MessengerTopic.SERVICE_WORKER_UNREGISTER,this.andReply(this.dataProvider.removeRegistration.bind(this.dataProvider)))}}e.BrokeredPermissionServer=p},"./src/sdk/message-servers/brokered-session-server.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.BrokeredSessionServer=void 0,t("./src/sdk/message-servers/abstract-message-server.ts"));const n=t("./src/sdk/data-providers/local-session.data-provider.ts"),r=t("./src/sdk/enums/session-broker-topic.enum.ts");class p extends o.AbstractMessageServer{constructor(s){super(),this.messengerServer=s,this.dataProvider=new n.LocalSessionDataProvider,this.bindEvents()}bindEvents(){this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET,this.andReply(this.dataProvider.get.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_REMOVE,this.andReply(this.dataProvider.remove.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET_CURRENT_PAGE_VIEWS,this.andReply(this.dataProvider.getCurrentPageViews.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET_CURRENT_TOTAL_PAGE_VIEWS,this.andReply(this.dataProvider.getCurrentTotalPageViews.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_GET_CURRENT_SESSION,this.andReply(this.dataProvider.getCurrentSession.bind(this.dataProvider))),this.messengerServer.watch(r.SessionBrokerTopic.SESSION_SET,this.andReply(s=>i(this,void 0,void 0,function*(){return this.dataProvider.set(s[0],s[1])})))}}e.BrokeredSessionServer=p},"./src/sdk/models/application/app.model.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AppModel=void 0;const i=t("./src/sdk/constants.ts");e.AppModel=class{constructor(){this.env=i.ENV_NAME,this.version=i.PUSHLY_APPLICATION_VERSION,this.classNames={},this.isLoaded=!1,this.isReady=!1,this.isDisabled=!1,this.isVisibleLoggingEnabled=!1,this.isEventOnlyMode=!1,this.mode="production"}getBrokeredFrameMessengerPath(s){return this.loadConfig.frameMessenger?"https://"+s+this.loadConfig.frameMessenger:this.loadConfig.sw?`https://${s}${this.loadConfig.sw.substr(0,this.loadConfig.sw.lastIndexOf("/"))}/pushly-frame-messenger.html`:`https://${s}/pn-brokered-data-server.html`}}},"./src/sdk/models/application/environment.model.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.EnvironmentModel=void 0;const o=t("./src/sdk/data-providers/local-permission.data-provider.ts"),n=t("./src/_utils/global-env.ts"),r=t("./src/sdk/utils.ts"),p=t("./src/sdk/factories/data-provider-factory.ts");e.EnvironmentModel=class{constructor(){this.mode="production"}get scope(){return(0,n.getSelf)()}get navigator(){return(0,n.getNavigator)()}get location(){return(0,n.getLocation)()}get document(){return(0,n.getDocument)()}get referrer(){return(0,n.getDocument)().referrer}get userAgent(){return(0,n.getNavigator)().userAgent}getDeviceType(){let s;return s=navigator.userAgentData?navigator.userAgentData.mobile?"mobile":"desktop":/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?"mobile":"desktop"}getCurrentMetaKeywords(){const s=[...document.querySelectorAll("meta[name='keywords'], meta[name='parsely-tags'], meta[name='sailthru.tags']")||[]];return[...new Set(s.flatMap(s=>{return null==(s=s.content)?void 0:s.split(",").flatMap(s=>s.toString().trim().toLowerCase())}))].filter(s=>s)}getQueryString(){return(0,r.parseQueryString)(this.location.search)}getGlobalScope(){return this.inSourcelessIFrame()?top:this.inWorkerGlobalScope()?self:window}inWorkerGlobalScope(){return"WorkerGlobalScope"in self}inSourcelessIFrame(){return window.self!==window.top&&window.frameElement&&"about:blank"===window.frameElement.src}requires2Step(){if(this.isSafari())return!0;if(!navigator.userAgentData)return!0;for(const s of navigator.userAgentData.brands){if(/firefox/i.test(s.brand))return!0;if("Microsoft Edge"===s.brand)return!0}return!1}isSafari(){return navigator.vendor.match(/apple/i)&&!navigator.userAgent.match(/crios/i)&&!navigator.userAgent.match(/fxios/i)&&!navigator.userAgent.match(/Opera|OPT\//)}isSafariPushCapable(){return this.isSafari()&&"object"==typeof this.scope.safari&&"pushNotification"in this.scope.safari}isPushManagerInScope(){return"PushManager"in this.scope}isArrayFullySupported(){return"Array"in this.scope&&"from"in Array&&"some"in[]}isDevMode(){return"development"===this.mode}isHTTPS(){return"https:"===this.location.protocol}isLocal(){return"localhost"===this.location.hostname||"127.0.0.1"===this.location.hostname}getLocalPushPermission(e){return i(this,void 0,void 0,function*(){const s=yield new o.LocalPermissionDataProvider(e);return yield s.getPushPermission()})}getComputedPushPermission(e){return i(this,void 0,void 0,function*(){const s=yield p.DataProviderFactory.getPermissionDataProvider(e);return yield s.getPushPermission()})}isPushSupported(){return i(this,void 0,void 0,function*(){let e="location"in this.scope;if(e||(this.unsupportedReason="self.location not accessible"),!e||(e="navigator"in this.scope)||(this.unsupportedReason="self.navigator not accessible"),!e||(e="userAgent"in this.navigator)||(this.unsupportedReason="self.userAgent not accessible"),!e||(e=this.navigator.cookieEnabled)||(this.unsupportedReason="self.navigator.cookieEnabled is FALSE"),!e||(e="Notification"in this.scope)||(this.unsupportedReason="self.Notification not accessible"),!e||(e=this.isArrayFullySupported())||(this.unsupportedReason="required Array functionality not accessible"),!e||(e=!!this.location.host)||(this.unsupportedReason="self.location.host is undefined"),!e||(e=!!this.location.hostname)||(this.unsupportedReason="self.location.hostname is undefined"),e)try{e=!!this.location.hostname.split("")}catch(s){e=!1,this.unsupportedReason="self.location.hostname is not a valid String"}if(e){const t=/HeadlessChrome|googlebot|crawler|spider|robot|crawling|facebookexternalhit/im;(e=!t.test(this.navigator.userAgent))||(this.unsupportedReason="self.navigator.userAgent is recognizedBot"),!e||(e=!t.test(this.navigator.appVersion))||(this.unsupportedReason="self.navigator.appVersion is recognizedBot"),!e||(e=!t.test(this.navigator.appCodeName))||(this.unsupportedReason="self.navigator.appCodeName is recognizedBot"),!e||(e=!t.test(this.navigator.product))||(this.unsupportedReason="self.navigator.product is recognizedBot")}var s=this.isPushManagerInScope();if(e&&!s){const i=/iphone|ipad/i;(e=!i.test(this.navigator.userAgent))||(this.unsupportedReason="self.navigator.userAgent is iDevice"),!e||(e=!(this.navigator.platform&&i.test(this.navigator.platform)))||(this.unsupportedReason="self.navigator.platform is iDevice")}if(e&&this.isSafari()&&!s)!e||(e=this.isSafariPushCapable())||(this.unsupportedReason="self.safari.pushNotification is not accessible");else if(!e||(e="PushManager"in this.scope)||(this.unsupportedReason="self.PushManager is not accessible"),!e||(e="PushSubscription"in this.scope)||(this.unsupportedReason="self.PushSubscription is not accessible"),!e||(e=this.scope.PushSubscription.prototype.hasOwnProperty("getKey"))||(this.unsupportedReason="self.PushSubscription.prototype.getKey is not accessible"),(this.isHTTPS()||this.isDevMode())&&(e&&!(e="ServiceWorker"in this.scope)&&(this.unsupportedReason="self.ServiceWorker is not accessible"),e&&!(e="serviceWorker"in this.navigator)&&(this.unsupportedReason="self.navigator.serviceWorker is not accessible"),e&&!(e="ServiceWorkerRegistration"in this.scope)&&(this.unsupportedReason="self.ServiceWorkerRegistration is not accessible"),e&&!(e=this.scope.ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification"))&&(this.unsupportedReason="self.ServiceWorkerRegistration.prototype.showNotification is not accessible"),e))try{yield this.navigator.serviceWorker.getRegistration()}catch(s){e=!1,this.unsupportedReason="call to self.navigator.serviceWorker.getRegistration() failed"}return e})}}},"./src/sdk/models/context.model.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContextModel=void 0;e.ContextModel=class{constructor(){this.clock=0,this.s=!1}}},"./src/sdk/models/domains/domain.model.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DomainModel=e.DomainFrequencyCapMetric=void 0;const n=t("./src/_utils/domain-matching.ts"),i=t("./src/_utils/global-env.ts");(t=e.DomainFrequencyCapMetric||(e.DomainFrequencyCapMetric={})).DAYS="days",t.HOURS="hours",t.MINUTES="minutes";e.DomainModel=class{constructor(){this.flags=[],this.additionalSubscriptionData=[],this.promptGroups=[],this.prompts=[],this.isCached=!1}shouldReplaceExistingWorkerInPushlyScope(){return this.hasFlag("REPLACE_EXISTING_WORKERS")}shouldUnregisterNonPushlyWorkers(){return this.hasFlag("UNREGISTER_ALL_NON_PUSHLY_WORKERS")}shouldUseCustomVapidKey(){return!!this.vapidPublicKey}shouldUseVapid(){return"PushManager"in(0,i.getSelf)()}hasFlag(s){return Array.isArray(this.flags)&&-1!==this.flags.indexOf(s.toString().toUpperCase())}hasApnsConfig(){return!!this.apnsConfiguration}isApnsConfigEnabled(){return this.hasApnsConfig()&&!0===this.apnsConfiguration.is_active}getPushPackageSettings(){return(this.apnsConfiguration||{}).push_package||{}}getWebsitePushId(){return this.getPushPackageSettings().website_push_id}isEventOnlyMode(){const s=this.whitelistDomains||[],e=this.sdkEventOnlyDomains||["oceans3.deepbluedev.com"];var t=this.hasFlag("FEAT_SDK_EVENT_ONLY_DOMAINS"),i=s.some(n.domainMatchPredicate),o=e.some(n.domainMatchPredicate);return t&&i&&o}}},"./src/sdk/models/domains/global-prompt-referrer-conditions.model.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalPromptReferrerConditionsModel=void 0;const i=t("./src/sdk/enums/prompt-referrer-condition.enum.ts").PromptReferrerCondition.IGNORE;e.GlobalPromptReferrerConditionsModel=class o{constructor(){this.persist_ttl_seconds=259200}static parse(s){const e=new o;return s=s||{},e.enabled=s.enabled||!1,e.persist_ttl_seconds=s.persist_ttl_seconds||e.persist_ttl_seconds,e.when_self=s.when_self||i,e.when_blank=s.when_blank||i,e.allowed=s.allowed||void 0,e.blocked=s.blocked||void 0,e}}},"./src/sdk/models/events/base-streamable-event.model.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStreamableEventModel=void 0;const o=t("./src/sdk/constants.ts"),n=t("./src/sdk/utils.ts"),r=t("./src/sdk/enums/event-priority.enum.ts");e.BaseStreamableEventModel=class{constructor(s,e,t){this.type=s,this.additionalData=e,this.context=t,this.id=(0,n.randomString)(),this.eventDate=(new Date).toISOString()}getPostData(){return i(this,void 0,void 0,function*(){return Object.assign(Object.assign({},this.additionalData),{action:this.type,domain_id:this.context.domain.id,event_date:this.eventDate,meta:Object.assign(Object.assign({},this.additionalData.meta||{}),{event_id:this.id,source:{application:o.PUSHLY_SDK_APPLICATION_NAME,version:o.PUSHLY_APPLICATION_VERSION}})})})}getRequestObject(e,t){return i(this,void 0,void 0,function*(){let s={"content-type":"text/plain"};return t===r.EventPriority.IMMEDIATE&&(s["X-Event-Priority"]=t),{endpoint:e||o.EVENTS_ENDPOINT,method:"POST",headers:s,body:JSON.stringify(yield this.getPostData())}})}}},"./src/sdk/models/events/event.model.ts":(s,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventModel=void 0;e.EventModel=class{constructor(s,...e){this.type=s,this.data=e}}},"./src/sdk/models/events/eventable.model.ts":function(s,e,t){"use strict";var n=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.EventableModel=void 0;const r=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),i=(t("./src/sdk/enums/debug-cookie-code.enum.ts"),t("./src/sdk/utils.ts")),o=t("./src/common/data-providers/api.data-provider.ts"),p=t("./src/sdk/enums/steamable-event-type.enum.ts"),l=t("./src/sdk/data-providers/event.data-provider.ts");class u{constructor(){this.e=(0,i.randomString)()}static post(e,t,i){return n(this,void 0,void 0,function*(){var s=yield e.getRequestObject(t,i);return o.ApiDataProvider.exec(s.endpoint,s.method,s.headers,s.body,!1)})}static debug(e,t,i,o){return n(this,void 0,void 0,function*(){try{if(e.domain&&e.domain.hasFlag("SDK_DEBUG_EVENTS")){let s={};return t===p.StreamableEventType.PROMPT_NOT_SHOWN&&(s={prompt_not_shown_reason:i||"unknown"},o&&(s.error_message=o)),this.post(new r.SubscriberStreamableEventModel(t,{meta:s},e))}}catch(s){}})}static debugPromptNotShown(s,e,t){return n(this,void 0,void 0,function*(){return this.debug(s,p.StreamableEventType.PROMPT_NOT_SHOWN,e,t)})}watch(s,e){return l.EventManager.on(s,e)}watchOnce(s,e){return l.EventManager.once(s,e)}unwatch(s,e){l.EventManager.unregisterCallback(s,e)}dispatch(s){return n(this,void 0,void 0,function*(){yield l.EventManager.dispatch(s)})}post(s,e,t){return n(this,void 0,void 0,function*(){return u.post(s,e,t)})}debug(s,e,t){return n(this,void 0,void 0,function*(){return u.debug(s,e,t,null)})}debugPromptNotShown(s,e,t){return n(this,void 0,void 0,function*(){return u.debugPromptNotShown(s,e,t)})}}e.EventableModel=u},"./src/sdk/models/events/subscriber-streamable-event.model.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.SubscriberStreamableEventModel=void 0;const d=t("./src/_utils/consent.ts");var o=t("./src/sdk/models/events/base-streamable-event.model.ts");const c=t("./src/_utils/global-env.ts"),h=t("./src/sdk/utils.ts"),a=t("./src/sdk/data-providers/cookie.data-provider.ts");class n extends o.BaseStreamableEventModel{getPostData(){const u=Object.create(null,{getPostData:{get:()=>super.getPostData}});return i(this,void 0,void 0,function*(){var s=yield u.getPostData.call(this);let e,t,i,o,n,r,p,l;if(this.context.user||this.context.domain&&this.context.domain.hasFlag("SDK_DEBUG_EVENTS")){this.context.user&&(t=this.context.user.puuid,i=this.context.user.externalId,o=this.context.user.token,n=this.context.user.lastSeenPromptId),r=(0,c.getLocation)().href;try{p=Intl.DateTimeFormat().resolvedOptions().locale,l=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(s){}}if(!t)try{let s=a.CookieDataProvider.get("pushly.user_puuid");s||(s=(0,h.randomString)(),a.CookieDataProvider.set("pushly.user_puuid",s)),t=s}catch(s){}if(t&&/undefined/i.test(t.toString())&&(t=(0,h.randomString)(),a.CookieDataProvider.set("pushly.user_puuid",t)),e=Object.assign(Object.assign(Object.assign(Object.assign({},s),{domain_key:this.context.domainKey}),(0,d.buildSdkConsentEventData)(this.context)),{meta:Object.assign(Object.assign({},s.meta),{pushly_unique_user_id:t,external_id:i})}),this.context.env&&this.context.env.isSafari()&&!this.context.env.isPushManagerInScope()&&(e.meta.apns_token=o),e.meta){let s=e.meta;s.prompt_id=s.promptId||s.prompt_id,s.prompt_id||(s.prompt_id=n),delete s.promptId}return e.meta.page_url=r,e.meta.language=p,e.meta.time_zone=l,e})}}e.SubscriberStreamableEventModel=n},"./src/sdk/models/users/user.model.ts":function(s,e){"use strict";var t=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.UserModel=void 0;e.UserModel=class i{constructor(){this.subscriberState="none",this.isInUdr=!1}static of(s){const e=new i;return Object.assign(e,s),e.subscriberState||(e.subscriberState="none"),e}isUnsubscribed(s){return t(this,void 0,void 0,function*(){return"unsubscribed"===this.subscriberState&&"default"===(yield this.getComputedPushPermission(s)).permission||this.isInUdr})}getComputedPushPermission(s){return t(this,void 0,void 0,function*(){return this._computedPushPermission||(this._computedPushPermission=yield this.env.getComputedPushPermission(s)),this._computedPushPermission})}getLocalPushPermission(s,e=!1){return t(this,void 0,void 0,function*(){return this._localPushPermission&&!e||(this._localPushPermission=yield this.env.getLocalPushPermission(s)),this._localPushPermission})}setPushPermission(s){this._localPushPermission=s,this._computedPushPermission=s}isSubscribed(s){return t(this,void 0,void 0,function*(){return("subscribed"===this.subscriberState||"granted"===(yield this.getComputedPushPermission(s)).permission)&&!this.isInUdr})}isDismissed(){return"dismissed"===this.subscriberState}isBlocked(){return"blocked"===this.subscriberState}isEligibleToPrompt(s){return t(this,void 0,void 0,function*(){return!(yield this.isSubscribed(s))&&!this.isDismissed()&&!this.isBlocked()})}}},"./src/sdk/prompts/base.prompt.ts":function(s,e,t){"use strict";var u=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.BasePrompt=void 0;const d=t("./src/sdk/utils.ts"),i=t("./src/sdk/enums/prompt-style.enum.ts"),o=t("./src/sdk/models/events/event.model.ts"),n=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/services/user.service.ts"),l=t("./src/sdk/enums/prompt-referrer-condition.enum.ts"),r=t("./src/sdk/models/domains/global-prompt-referrer-conditions.model.ts"),p=t("./src/sdk/factories/data-provider-factory.ts"),h=t("./src/sdk/services/logging.service.ts");class a extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{constructor(s,e,t=!0){super(),this.context=s,this.settings=e,this.envSupported=t,this.userReferrerIsAllowed=!0,this.bypassEligibilityCheck=!1,t&&(h.Logger.info(`Preloading ${this.style} prompt ${this.promptId}, `+this.name),this._wireEvents())}get groupId(){return this.settings.group.id}get promptId(){return this.settings.prompt.id}get style(){return this.settings.prompt.style}get name(){let s=this.settings.group.name;return s=this.settings.prompt.name?s+" - "+this.settings.prompt.name:s}get promptConfig(){return this.settings.prompt.config||{}}get promptConditions(){return this.settings.prompt.conditions_json||{}}isNativePrompt(){return this.style===i.PromptStyle.Native}isSlidePrompt(){return this.style===i.PromptStyle.Slide}isBellPrompt(){return this.style===i.PromptStyle.Bell}get isUserSubscribed(){return this.context.user.isSubscribed(this.context)}run(s){return u(this,void 0,void 0,function*(){this.bypassEligibilityCheck=!!s&&!!s.bypassEligibilityCheck,this.userReferrerIsAllowed=yield this._evaluateCurrentReferrer()})}_attemptToShow(){return u(this,void 0,void 0,function*(){yield(0,d.delay)(Math.floor(50*Math.random()))})}_show(){return u(this,void 0,void 0,function*(){h.Logger.info(`Showing prompt ${this.promptId}, `+this.name),this.dispatch(new o.EventModel(n.EventType.PROMPT_SHOWN,this._buildDispatchEventPack())),this._incrementUserPromptCount(),yield this._setLastSeenPromptId()})}_buildDispatchEventPack(){return u(this,void 0,void 0,function*(){return{prompt:{id:this.promptId,keywords:[]},subscribed:this.isUserSubscribed}})}_buildPostEventPack(){return u(this,void 0,void 0,function*(){return{meta:{promptId:this.promptId,subscribed:yield this.isUserSubscribed}}})}_incrementUserPromptCount(){try{var s=this.isNativePrompt()||this.isSlidePrompt(),e=!!this.context.domain&&!!this.context.domain.frequencyCaps&&!!this.context.domain.frequencyCaps.prompt;if(s&&e){var t,i=this.context.domain.frequencyCaps.prompt.fcap_seconds;if(0<i){const o=this.context.user.promptCountState;let s=0,e=new Date;e.setTime(e.getTime()+1e3*i),!o||2===(t=o.split("|")).length&&(s=parseInt(t[0],10),e=t[1]),e instanceof Date&&(e=e.toUTCString()),c.UserService.setPromptState(this.context.user,i,s+1+"|"+e,e)}}}catch(s){h.Logger.warn("Encountered an error while updating prompt frequency cap",s)}}_setLastSeenPromptId(){return u(this,void 0,void 0,function*(){(yield this.isUserSubscribed)||(yield c.UserService.setLastSeenPromptId(this.context.user,this.promptId))})}_canShow(){return u(this,void 0,void 0,function*(){var s=this._isPlacementEnabled();return(yield this._isUserEligibleToPrompt())&&s})}_isPlacementEnabled(){let s=!1;var e="desktop"===this.context.env.getDeviceType(),t=this.promptConfig.position||{},i="disabled"!==t.desktop,t="disabled"!==t.mobile;return s=e&&i||!e&&t?!0:s}_isCustomOrBaseSubStateEligible(){return u(this,void 0,void 0,function*(){var s=yield this.context.user.getComputedPushPermission(this.context);return this.style===i.PromptStyle.Custom||"denied"!==s.permission})}_isUserEligibleToPrompt(){return u(this,void 0,void 0,function*(){let e=!1;if(this.bypassEligibilityCheck)e=yield this._isCustomOrBaseSubStateEligible();else{const i=this.context.user;var t=yield this.context.user.isEligibleToPrompt(this.context),t=this.isBellPrompt()||t;let s=!0;t&&(this.isNativePrompt()||this.isSlidePrompt())&&(s=this._evaluateFcapConditions()),this.userReferrerIsAllowed?t?s?e=!0:this.debugPromptNotShown(this.context,"prompt_ineligible_fcap"):i.isBlocked()?this.debugPromptNotShown(this.context,"user_permission_denied"):i.isDismissed()?this.debugPromptNotShown(this.context,"user_permission_dismissed"):(yield i.isSubscribed(this.context))?this.debugPromptNotShown(this.context,"user_permission_granted"):this.debugPromptNotShown(this.context,"user_ineligible"):this.debugPromptNotShown(this.context,"referrer_"+this.userReferrerState)}return e})}_evaluateRunConditions(){return u(this,void 0,void 0,function*(){return new Promise(l=>u(this,void 0,void 0,function*(){const i=this.promptConfig.behavior||{},o=this.promptConditions.visitor||{},n=!!o.time_on_page_seconds,t=!!o.session_page_views,r=!!o.session_time_on_site_seconds,s=new Promise(e=>u(this,void 0,void 0,function*(){if(t)if(yield this._evaluateSessionPageViewConditions())e();else{h.Logger.info(`Prompt condition: Page views [at least ${o.session_page_views} pages]`);const s=setInterval(()=>u(this,void 0,void 0,function*(){(yield this._evaluateSessionPageViewConditions())&&(clearInterval(s),e())}),1e3)}else e()})),e=new Promise(e=>u(this,void 0,void 0,function*(){if(r)if(yield this._evaluateSessionTimeOnSiteConditions())e();else{h.Logger.info(`Prompt condition: Time on site [at least ${o.session_time_on_site_seconds} seconds]`);const s=setInterval(()=>u(this,void 0,void 0,function*(){(yield this._evaluateSessionTimeOnSiteConditions())&&(clearInterval(s),e())}),1e3)}else e()})),p=new Promise(t=>u(this,void 0,void 0,function*(){var s=self._swclk_||0;let e=i.delay_seconds||0;n&&(e=o.time_on_page_seconds||0,h.Logger.info(`Prompt condition: Time on page [at least ${e} seconds]`)),(e=e>s?e-s:0)<0&&(e=0),yield(0,d.delay)(1e3*e),t()}));yield Promise.all([s.then(()=>{t&&h.Logger.info("Prompt condition: Page views [satisfied]")}),e.then(()=>{r&&h.Logger.info("Prompt condition: Time on site [satisfied]")}),p.then(()=>{n&&h.Logger.info("Prompt condition: Time on page [satisfied]")})]),l()}))})}_evaluateSessionPageViewConditions(){return u(this,void 0,void 0,function*(){const s=yield p.DataProviderFactory.getSessionDataProvider(this.context);let e=!1;var t=this.promptConditions.visitor.session_page_views,i=yield s.getCurrentTotalPageViews();return e=t<=i?!0:e})}_evaluateSessionTimeOnSiteConditions(){return u(this,void 0,void 0,function*(){const s=yield p.DataProviderFactory.getSessionDataProvider(this.context);let e=!1;var t=Date.now(),i=(yield s.getCurrentSession()).sessionStart,o=this.promptConditions.visitor.session_time_on_site_seconds;return e=o<=(t-i)/1e3?!0:e})}_evaluateFcapConditions(){let s=!0,e=0;try{var t=this.isNativePrompt()||this.isSlidePrompt(),i=!!this.context.domain&&!!this.context.domain.frequencyCaps&&!!this.context.domain.frequencyCaps.prompt;if(t)if(i){var o=this.context.domain.frequencyCaps.prompt;const l=this.context.user.promptCountState;var n=this.context.user.promptFcapSeconds;if(String(n)!==String(o.fcap_seconds))c.UserService.clearPromptFcapState();else if(l){var r=l.split("|");if(2===r.length){var p=r[1];if(((0,d.tryParseInt)(r[0])||0)>=o.occurrences){s=!1;try{e=Math.floor((Date.parse(p)-(new Date).getTime())/1e3)}catch(s){}}}}}else c.UserService.clearPromptFcapState()}catch(s){h.Logger.warn("Encountered an error while checking prompt frequency cap")}return s||h.Logger.info("Prompt frequency cap has been met"+(0<e?` - ${e} seconds remain`:"")),s}_evaluateCurrentReferrer(){return u(this,void 0,void 0,function*(){let s=!0;var e;return!0!==this.bypassEligibilityCheck&&(e=this.context.domain.globalPromptSettings)&&e.referrers&&(e=e.referrers,(e=r.GlobalPromptReferrerConditionsModel.parse(e)).enabled&&(e=yield this._evaluateReferrerConditions(e),this.userReferrerState=e.referrerResponse,s=e.pass)),s||h.Logger.info(`Based on client referrer, prompt, ${this.promptId}, is currently disabled`),s})}_evaluateReferrerConditions(r){return u(this,void 0,void 0,function*(){let s={pass:!0,referrerResponse:l.PromptReferrerCondition.ALLOW},e=this.context.env.referrer;var t=this.context.user.lastReferrerState,i=yield this._evaluateExistingReferrerState(r,t,e),t=!(e=t&&!i.updateRequired?i.referrer:e)||""===e;const o=String(e);var n=!t&&-1!==o.indexOf(this.context.domain.name);return!((s=t?a._evaluateSimpleReferrerCondition(r.when_blank,s):n?a._evaluateSimpleReferrerCondition(r.when_self,s):this._evaluateExternalReferrerConditions(r,s,e)).referrerResponse===l.PromptReferrerCondition.IGNORE)&&i.updateRequired&&(yield c.UserService.setLastReferrerState(this.context.user,o)),s})}_evaluateExistingReferrerState(i,o,n){return u(this,void 0,void 0,function*(){const s={referrer:n,updateRequired:!1};if(o&&o.lastSetAt){const t=new Date;var e=(t.getTime()-o.lastSetAt)/1e3;(i.persist_ttl_seconds||0)<e?(yield c.UserService.clearLastReferrerState(this.context.user),s.updateRequired=!0):s.referrer=o.referrer}return s})}static _evaluateSimpleReferrerCondition(s,e){const t=Object.assign({},e);switch(s){case l.PromptReferrerCondition.IGNORE:t.pass=!1,t.referrerResponse=l.PromptReferrerCondition.IGNORE;break;case l.PromptReferrerCondition.BLOCK:t.pass=!1,t.referrerResponse=l.PromptReferrerCondition.BLOCK}return t}_evaluateExternalReferrerConditions(s,e,t){const i=Object.assign({},e);let o=!0,n=!0,r=!1,p=!1;s.allowed&&(Array.isArray(s.allowed.contains)&&(n=s.allowed.contains.some(s=>-1!==t.indexOf(s))),Array.isArray(s.allowed.exact)&&(o=s.allowed.exact.some(s=>t===s))),s.blocked&&(Array.isArray(s.blocked.contains)&&(p=s.blocked.contains.some(s=>-1!==t.indexOf(s))),Array.isArray(s.blocked.exact)&&(r=s.blocked.exact.some(s=>t===s)));e=o||n,s=r||p;return e&&!s||(i.pass=!1,i.referrerResponse=l.PromptReferrerCondition.BLOCK),i}}e.BasePrompt=a},"./src/sdk/prompts/bell.prompt.ts":function(s,e,i){"use strict";var n=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},t=(Object.defineProperty(e,"__esModule",{value:!0}),e.BellPrompt=void 0,i("./src/sdk/prompts/dom.prompt.ts"));const o=i("./src/sdk/constants.ts"),r=i("./src/sdk/models/events/event.model.ts"),p=i("./src/sdk/enums/event-type.enum.ts"),l=i("./src/sdk/services/logging.service.ts"),u=i("./src/sdk/enums/bell-prompt-display-behavior.enum.ts"),d={"top-left":"d-top-left","top-right":"d-top-right","bottom-right":"d-bottom-right","bottom-left":"d-bottom-left",disabled:"d-disabled"},c={"top-left":"m-top-left","top-right":"m-top-right","bottom-right":"m-bottom-right","bottom-left":"m-bottom-left",disabled:"m-disabled"};let h=null;class a extends t.DomPrompt{constructor(){super(...arguments),this.stylesAdded=!1}_wireEvents(){var s=this._handleFlowLoaded.bind(this),e=this._handleShowPrompt.bind(this),t=this._handleHidePrompt.bind(this),i=this._handleSubscription.bind(this),o=this._handleUnsubscription.bind(this),n=[p.EventType.REGISTRATION_SUBSCRIBED,p.EventType.REGISTRATION_MIGRATED],r=[p.EventType.PERMISSION_DISMISSED,p.EventType.PERMISSION_DENIED];this.watch(p.EventType.FLOW_LOADED,s),this.watch(p.EventType.PROMPT_SHOW,e),this.watch(r,t),this.watch(n,i),this.watch(p.EventType.REGISTRATION_UNSUBSCRIBED,o)}_wireElementEvents(){var s=this._handleButtonMouseOver.bind(this),e=this._handleButtonMouseOut.bind(this),t=this._handleButtonClick.bind(this),i=this._handleWindowResize.bind(this);this.svgBtn.addEventListener("mouseover",s),this.svgBtn.addEventListener("mouseout",e),this.svgBtn.addEventListener("click",t),!0===this.promptConfig.preview_mode&&this.svgBtn.removeEventListener("click",t),this.context.env.scope.addEventListener("resize",i)}attachToDom(e){const t=Object.create(null,{attachToDom:{get:()=>super.attachToDom}});return n(this,void 0,void 0,function*(){var s;this.stylesAdded||(this.stylesAdded=!0,i("./src/sdk/styles/bell.scss")),yield t.attachToDom.call(this,e),this.parentReady&&(s=yield this._buildTemplate(),this.parent.appendChild(s),this._wireElementEvents())})}run(s={}){const e=Object.create(null,{run:{get:()=>super.run}});return n(this,void 0,void 0,function*(){yield e.run.call(this,s),(yield this._canShow())?(this.dispatch(new r.EventModel(p.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),yield this._evaluateDisplayBehavior(!!this.bypassEligibilityCheck)):this.dispatch(new r.EventModel(p.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack()))})}_attemptToShow(e=!1){return n(this,void 0,void 0,function*(){var s=this.settings.prompt.is_auto_show||e;this._isPlacementEnabled()?(yield this._canShow())&&s&&(yield this._evaluateRunConditions(),yield this._show()):l.Logger.info("Current prompt is not enabled for this placement")})}_show(){const s=Object.create(null,{_show:{get:()=>super._show}});return n(this,void 0,void 0,function*(){yield s._show.call(this)})}_buildTemplate(){return n(this,void 0,void 0,function*(){if(!this.element){const s=["pushly_bell",(yield this.isUserSubscribed)?"subscribed":"not-subscribed",this.promptConfig.managed?"managed":"non-managed",d[this.promptTheme.position.desktop],c[this.promptTheme.position.mobile]];this.element=this._createDivElement({className:s.join(" ")}),this.svgBtn=this._createSvgElement("0 0 512 512"),this.svgBtn.innerHTML=`
<circle fill="${this.promptTheme.primary_color}" cx="256" cy="256" r="255.059" />
<path fill="${this.promptTheme.accent_color}" d="M256,46.349C140.398,46.349,46.349,140.398,46.349,256c0,115.603,94.049,209.651,209.651,209.651
    c115.603,0,209.651-94.049,209.651-209.651C465.651,140.398,371.603,46.349,256,46.349z M256,450.411
    c-107.198,0-194.41-87.213-194.41-194.411c0-107.198,87.212-194.41,194.41-194.41c107.198,0,194.411,87.212,194.411,194.41
    C450.411,363.198,363.198,450.411,256,450.411z" />
<g>
    <path fill="${this.promptTheme.accent_color}" d="M341.024,293.378v-58.851c0-41.452-28.823-76.096-67.492-85.197c-0.235-10.897-9.101-19.647-20.033-19.647
        c-10.941,0-19.847,8.789-20.076,19.647c-38.669,9.101-67.495,43.745-67.495,85.197v58.851c-14.569,0-26.369,11.797-26.369,26.365
        v18.603h227.829v-18.603C367.389,305.175,355.596,293.378,341.024,293.378z" />
    <path fill="${this.promptTheme.accent_color}" d="M253.5,381.699c17.454,0,32.062-11.757,36.661-27.781h-73.376C221.393,369.942,236,381.699,253.5,381.699z" />
</g>
        `.trim(),this.tooltipContainer=this._createDivElement({className:"pushly_bell-tooltip-container"}),this.tooltipContainer.innerHTML=`
<div class="pushly_bell-tooltip pushly_bell-tooltip-subscribed" ${this.promptTheme.tooltip.subscribed?"":'style="display: none;"'}>
    <div class="pushly_bell-tooltip-arrow" style="background-color: ${this.promptTheme.primary_color};"></div>
    <div class="pushly_bell-tooltip-text" style="background-color: ${this.promptTheme.primary_color}; color: ${this.promptTheme.accent_color};">${this.promptTheme.tooltip.subscribed}</div>
</div>
<div class="pushly_bell-tooltip pushly_bell-tooltip-notsubscribed" ${this.promptTheme.tooltip.unsubscribed?"":'style="display: none;"'}>
    <div class="pushly_bell-tooltip-arrow" style="background-color: ${this.promptTheme.primary_color};"></div>
    <div class="pushly_bell-tooltip-text" style="background-color: ${this.promptTheme.primary_color}; color: ${this.promptTheme.accent_color};">${this.promptTheme.tooltip.unsubscribed}</div>
</div>
        `.trim(),this.element.appendChild(this.svgBtn),this.element.appendChild(this.tooltipContainer),this._updateSize()}return this.element})}_updateSize(){let s=this.promptTheme.size;this.context.env.scope.innerWidth<o.MOBILE_MAX_SIZE&&this.promptTheme.mobile_size&&(s=this.promptTheme.mobile_size),this.svgBtn.setAttribute("height",s),this.svgBtn.style.height=s,this.svgBtn.setAttribute("width",s),this.svgBtn.style.width=s}_handleFlowLoaded(){return n(this,void 0,void 0,function*(){yield this.run()})}_handleShowPrompt(){return n(this,void 0,void 0,function*(){this.context.app.loadConfig.manualPromptMode||this.element.classList.contains(o.DEFAULT_CLASSNAME_PROMPT_VISIBLE)||(yield this._evaluateDisplayBehavior(!0))})}_handleHidePrompt(){return n(this,void 0,void 0,function*(){yield this._hide()})}_handleSubscription(){return n(this,void 0,void 0,function*(){return this.element.classList.add("subscribed"),this._evaluateDisplayBehavior()})}_handleUnsubscription(){return n(this,void 0,void 0,function*(){return this.element.classList.remove("subscribed"),this._evaluateDisplayBehavior()})}_evaluateDisplayBehavior(o=!1){return n(this,void 0,void 0,function*(){var s,e,t=yield this.isUserSubscribed,i=this.promptConfig.behavior;i&&(s=i.display_behavior===u.BellPromptDisplayBehavior.PRE_SUBSCRIPTION,e=i.display_behavior===u.BellPromptDisplayBehavior.POST_SUBSCRIPTION,i.display_behavior===u.BellPromptDisplayBehavior.ALWAYS?(l.Logger.info("Bell prompt display mode: always.","User Subscribed: "+(t?"true":"false")),yield this._attemptToShow()):s?(l.Logger.info("Bell prompt display mode: pre-subscription.","User Subscribed: "+(t?"true":"false")),t?yield this._hide():yield this._attemptToShow(o)):e&&(l.Logger.info("Bell prompt display mode: post-subscription.","User Subscribed: "+(t?"true":"false")),t?yield this._attemptToShow(o):yield this._hide()))})}_handleButtonClick(){return n(this,void 0,void 0,function*(){(yield this.isUserSubscribed)||(yield this._allow())})}_handleButtonMouseOver(){return n(this,void 0,void 0,function*(){this.element.classList.add("hover")})}_handleButtonMouseOut(){return n(this,void 0,void 0,function*(){this.element.classList.remove("hover")})}_handleWindowResize(){return n(this,void 0,void 0,function*(){h&&clearTimeout(h),h=setTimeout(()=>{h=null,this._updateSize()},50)})}}e.BellPrompt=a},"./src/sdk/prompts/custom.prompt.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.CustomPrompt=void 0,t("./src/sdk/prompts/dom.prompt.ts"));const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/models/events/event.model.ts"),p=t("./src/sdk/enums/event-type.enum.ts"),l=t("./src/sdk/services/logging.service.ts");class u extends o.DomPrompt{constructor(){super(...arguments),this.allowBtns=[],this.dismissBtns=[]}_wireEvents(){var s=this._handleShowPrompt.bind(this),e=this._handlePermissionGranted.bind(this),t=this._handlePermissionDismissed.bind(this),i=this._handlePermissionDenied.bind(this),o=[p.EventType.REGISTRATION_SUBSCRIBED,p.EventType.REGISTRATION_MIGRATED,p.EventType.PERMISSION_GRANTED,p.EventType.FOLLOWED],n=[p.EventType.PROMPT_DISMISSED,p.EventType.PERMISSION_DISMISSED],r=[p.EventType.PERMISSION_DENIED];this.watch(p.EventType.PROMPT_SHOW,s),this.watch(o,e),this.watch(n,t),this.watch(r,i)}_locateAndAssignElement(){const e=setInterval(()=>i(this,void 0,void 0,function*(){var s=this.parent.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_CUSTOM);s&&0<s.length&&(clearInterval(e),this.element=s[0],this.envSupported?(this._setSupportedClassname(),yield this._setInitialSubscriptionClassname(),this._resolveKeywords(),this._assignButtonElements()):this._setUnsupportedClassname())}),500)}attachToDom(){const s=Object.create(null,{attachToDom:{get:()=>super.attachToDom}});return i(this,void 0,void 0,function*(){yield s.attachToDom.call(this),yield this._locateAndAssignElement()})}runInUnsupportedMode(){return i(this,void 0,void 0,function*(){yield this.attachToDom()})}_run(){return i(this,void 0,void 0,function*(){l.Logger.info("Custom prompt ready"),(yield this._isUserEligibleToPrompt())?(this._setEligibleClassnames(),this.dispatch(new r.EventModel(p.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack()))):(this._setIneligibleClassnames(),this.dispatch(new r.EventModel(p.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())))})}_attemptToShow(s=0){return i(this,void 0,void 0,function*(){this.bypassEligibilityCheck&&this._setEligibleClassnames(),(yield this._isUserEligibleToPrompt())?this._setEligibleClassnames():this._setIneligibleClassnames()})}_show(){return i(this,void 0,void 0,function*(){})}_assignButtonElements(){return i(this,void 0,void 0,function*(){var s=this.element.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW),e=this.element.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS);s&&0<s.length?Array.from(s).forEach(s=>{s.addEventListener("click",this._allow.bind(this)),this.allowBtns.push(s)}):l.Logger.warn("Prompt allow button cannot be located"),e&&0<e.length?Array.from(e).forEach(s=>{s.addEventListener("click",this._dismiss.bind(this)),this.dismissBtns.push(s)}):l.Logger.warn("Prompt dismiss button cannot be located"),yield this._run()})}_getConfigClassNames(){const s=this.context.app.classNames||{};return s.webPushUnsupported=s.webPushUnsupported||n.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED,s.webPushSupported=s.webPushSupported||n.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED,s.subscriptionNone=s.subscriptionNone||n.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE,s.subscriptionSubscribed=s.subscriptionSubscribed||n.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE,s.subscriptionUnsubscribed=s.subscriptionUnsubscribed||n.DEFAULT_CLASSNAME_SUBSCRIPTION_FALSE,s.subscriptionDenied=s.subscriptionDenied||n.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED,s.subscriptionDismissed=s.subscriptionDismissed||n.DEFAULT_CLASSNAME_SUBSCRIPTION_DISMISSED,s.promptIneligible=s.promptIneligible||n.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE,s.promptEligible=s.promptEligible||n.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE,s}_setInitialSubscriptionClassname(){return i(this,void 0,void 0,function*(){this.context.user.isBlocked()?this._setDeniedClassnames():this.context.user.isDismissed()?this._setDismissedClassnames():(yield this.isUserSubscribed)?this._setSubscribedClassnames():this._setNoSubscriptionClassnames()})}_setPromptCompositeSubscribedClassnames(){this._setIneligibleClassnames(),this._setSubscribedClassnames(),this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_setSubscriptionDismissedClassnames(){this._setIneligibleClassnames(),this._setDismissedClassnames(),this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_setSubscriptionDeniedClassnames(){this._setIneligibleClassnames(),this._setDeniedClassnames(),this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_setUnsupportedClassname(){var s=this._getConfigClassNames();this.element.classList.add(s.webPushUnsupported),this.element.classList.remove(s.webPushSupported)}_setSupportedClassname(){var s=this._getConfigClassNames();this.element.classList.add(s.webPushSupported),this.element.classList.remove(s.webPushUnsupported)}_setEligibleClassnames(){var s=this._getConfigClassNames();this.element.classList.remove(s.promptIneligible),this.element.classList.add(s.promptEligible)}_setIneligibleClassnames(){var s=this._getConfigClassNames();this.element.classList.remove(s.promptEligible),this.element.classList.add(s.promptIneligible)}_setNoSubscriptionClassnames(){var s=this._getConfigClassNames();this.element.classList.add(s.subscriptionNone),this.element.classList.remove(s.subscriptionSubscribed,s.subscriptionDismissed,s.subscriptionDenied,s.subscriptionUnsubscribed)}_setSubscribedClassnames(){var s=this._getConfigClassNames();this.element.classList.add(s.subscriptionSubscribed),this.element.classList.remove(s.subscriptionNone,s.subscriptionDismissed,s.subscriptionDenied,s.subscriptionUnsubscribed)}_setDismissedClassnames(){var s=this._getConfigClassNames();this.element.classList.add(s.subscriptionDismissed),this.element.classList.remove(s.subscriptionNone,s.subscriptionSubscribed,s.subscriptionDenied,s.subscriptionUnsubscribed)}_setDeniedClassnames(){var s=this._getConfigClassNames();this.element.classList.add(s.subscriptionDenied),this.element.classList.remove(s.subscriptionNone,s.subscriptionSubscribed,s.subscriptionDismissed,s.subscriptionUnsubscribed)}_handleShowPrompt(){return i(this,void 0,void 0,function*(){var s;this.context.app.loadConfig.manualPromptMode||(s=yield this._isUserEligibleToPrompt(),!this.element.classList.contains(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)&&s&&(yield this._attemptToShow(!0)))})}_handlePermissionGranted(){return i(this,void 0,void 0,function*(){this._setPromptCompositeSubscribedClassnames(),yield this._hide()})}_handlePermissionDismissed(){return i(this,void 0,void 0,function*(){this._setSubscriptionDismissedClassnames(),yield this._hide()})}_handlePermissionDenied(){return i(this,void 0,void 0,function*(){this._setSubscriptionDeniedClassnames(),yield this._hide()})}}e.CustomPrompt=u},"./src/sdk/prompts/dom.prompt.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.DomPrompt=void 0,t("./src/sdk/prompts/base.prompt.ts"));const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/prompt-style.enum.ts"),u=t("./src/sdk/enums/steamable-event-type.enum.ts"),d=t("./src/sdk/enums/event-type.enum.ts"),c=t("./src/sdk/services/user.service.ts"),h=t("./src/sdk/services/logging.service.ts"),a=t("./src/sdk/utils.ts");let m=0;class v extends o.BasePrompt{constructor(s,e,t=!0){super(s,e,t),this.parentReady=!1,this._handlePromptAllowedError=s=>i(this,void 0,void 0,function*(){/prompting has been disabled/i.test(String(s))&&this.dispatch(new p.EventModel(d.EventType.PROMPT_DISABLED,yield this._buildDispatchEventPack(),this.context,this,{message:s}))}),t&&this._wireRenderEvent()}_wireRenderEvent(){var s=this._handleFlowLoadedRender.bind(this);this.watchOnce(d.EventType.FLOW_LOADED,s)}get promptTheme(){return this.promptConfig.theme||{}}attachToDom(e){return i(this,void 0,void 0,function*(){var s;this.element||(s=this.context.env.document.body,this.parent=e||s,this.parent?this.parentReady=!0:m<5?(h.Logger.info(`Prompt parent element, ${String(this.parent)}, could not be resolved. Attempts: `+m),m++,yield(0,a.delay)(100*m*2),yield this.attachToDom(e)):h.Logger.warn(`Prompt parent element, ${String(this.parent)}, unavailable`))})}_canShow(){const e=Object.create(null,{_canShow:{get:()=>super._canShow}});return i(this,void 0,void 0,function*(){var s=yield e._canShow.call(this);return!!this.element&&s})}_show(){return i(this,void 0,void 0,function*(){h.Logger.info(`Showing prompt ${this.promptId}, `+this.name),this._incrementUserPromptCount(),yield this._setLastSeenPromptId(),this._addVisibleClassName();const s=yield this._buildPostEventPack();this._hasKeywords()&&(s.meta.keywords=this.keywords),(yield this.isUserSubscribed)?this.style===l.PromptStyle.Custom&&(this.dispatch(new p.EventModel(d.EventType.FOLLOW_SHOWN,yield this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.FOLLOW_SHOWN,s,this.context))):(this.dispatch(new p.EventModel(d.EventType.PROMPT_SHOWN,yield this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.PROMPT_SHOWN,s,this.context)))})}_hide(){return i(this,void 0,void 0,function*(){this._removeVisibleClassName(),this.dispatch(new p.EventModel(d.EventType.PROMPT_HIDE,yield this._buildDispatchEventPack()))})}_allow(s){return i(this,void 0,void 0,function*(){const s=yield this._buildPostEventPack();this._hasKeywords()&&(s.meta.keywords=this.keywords),(yield this.isUserSubscribed)?this.style===l.PromptStyle.Custom&&(this.dispatch(new p.EventModel(d.EventType.FOLLOWED,this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.FOLLOWED,s,this.context))):(this.dispatch(new p.EventModel(d.EventType.PROMPT_ALLOWED,this._buildDispatchEventPack(),this.context,this)).catch(this._handlePromptAllowedError),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.PROMPT_ALLOWED,s,this.context)))})}_dismiss(s){return i(this,void 0,void 0,function*(){yield this._hide(),this.dispatch(new p.EventModel(d.EventType.PROMPT_DISMISSED,this._buildDispatchEventPack())),this.post(new r.SubscriberStreamableEventModel(u.StreamableEventType.PROMPT_DISMISSED,yield this._buildPostEventPack(),this.context)),yield c.UserService.setPromptDismissed(this.context.user,this)})}_addVisibleClassName(){this.element&&this.element.classList.add(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_removeVisibleClassName(){this.element&&this.element.classList.remove(n.DEFAULT_CLASSNAME_PROMPT_VISIBLE)}_resolveKeywords(){try{if(this.element){const e=(this.element.dataset||{}).keywords||"";if(""!==e.trim()){const t=e.toString().split(",");var s=t.map(s=>s.toString().trim());this.keywords=[...Array.from(new Set(s))]}}}catch(s){h.Logger.warn("Could not resolve prompt keywords - "+s.message)}}_hasKeywords(){return!!this.keywords&&Array.isArray(this.keywords)&&0<this.keywords.length}_buildDispatchEventPack(){const e=Object.create(null,{_buildDispatchEventPack:{get:()=>super._buildDispatchEventPack}});return i(this,void 0,void 0,function*(){const s=yield e._buildDispatchEventPack.call(this);return s.keywords=this.keywords||[],s})}_handleFlowLoadedRender(){return i(this,void 0,void 0,function*(){yield this.attachToDom()})}_createDivElement(s={}){return this._createDomElement("div",s)}_createButtonElement(s={}){return this._createDomElement("button",s)}_createImgElement(s,e){const t=this._createDomElement("img");return s&&(t.src=s),e&&(t.alt=e),t}_createSvgElement(s){const e=this.context.env.document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("viewBox",s),e}_createDomElement(s,e={}){const t=this.context.env.document.createElement(s);return e.className&&t.setAttribute("class",e.className),e.style&&t.setAttribute("style",e.style),e.innerText&&(t.innerText=e.innerText),t}}e.DomPrompt=v},"./src/sdk/prompts/native.prompt.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},o=(Object.defineProperty(e,"__esModule",{value:!0}),e.NativePrompt=void 0,t("./src/sdk/prompts/base.prompt.ts"));const n=t("./src/sdk/models/events/event.model.ts"),r=t("./src/sdk/enums/exception-message.enum.ts"),p=t("./src/sdk/enums/runtime-environment.enum.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/services/logging.service.ts"),d=t("./src/sdk/enums/integration-type.enum.ts"),c=t("./src/sdk/exceptions/fail.exception.ts");class h extends o.BasePrompt{constructor(){super(...arguments),this.shown=!1}_wireEvents(){var s=this._handleFlowLoaded.bind(this),e=this._handleShowPrompt.bind(this);this.watch(l.EventType.FLOW_LOADED,s),this.watch(l.EventType.PROMPT_SHOW,e)}_handleFlowLoaded(){return i(this,void 0,void 0,function*(){yield this.run()})}_handleShowPrompt(){return i(this,void 0,void 0,function*(){this.context.app.loadConfig.manualPromptMode||(yield this._attemptToShow(!0))})}run(s={}){const e=Object.create(null,{run:{get:()=>super.run}});return i(this,void 0,void 0,function*(){this.shown||(yield e.run.call(this,s),this._runMixedIntegrationCheck(),(yield this._canShow())?(this.dispatch(new n.EventModel(l.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),yield this._attemptToShow(!!s.bypassEligibilityCheck)):this.dispatch(new n.EventModel(l.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())))})}_canShow(){const t=Object.create(null,{_canShow:{get:()=>super._canShow}});return i(this,void 0,void 0,function*(){var s=yield t._canShow.call(this),e=(yield this.context.user.getComputedPushPermission(this.context)).subscription;return s&&!e||u.Logger.debug("Native prompt cannot show due to current subscription state."),s&&!e})}_attemptToShow(e=!1){const t=Object.create(null,{_attemptToShow:{get:()=>super._attemptToShow}});return i(this,void 0,void 0,function*(){var s;yield t._attemptToShow.call(this),this.shown||(s=this.settings.prompt.is_auto_show||e,this._isPlacementEnabled()?(yield this._canShow())&&s&&(yield this._evaluateRunConditions(),(yield this._canShow())&&(yield this._show())):u.Logger.info("Current prompt is not enabled for this placement"))})}_show(){const s=Object.create(null,{_show:{get:()=>super._show}});return i(this,void 0,void 0,function*(){this.shown||(yield s._show.call(this),this.shown=!0,yield this.dispatch(new n.EventModel(l.EventType.PROMPT_ALLOWED,this._buildDispatchEventPack(),this.context,this)))})}_runMixedIntegrationCheck(){var s=this.context.domain.integrationType;if(this.context.env.primaryRuntimeEnvironment===p.RuntimeEnvironment.DIRECT&&s===d.IntegrationType.PROXY)throw this.debugPromptNotShown(this.context,"mixed_integration"),new c.FailException(null,r.ExceptionMessage.MIXED_INTEGRATION)}}e.NativePrompt=h},"./src/sdk/prompts/slide.prompt.ts":function(s,e,n){"use strict";var r=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})},t=(Object.defineProperty(e,"__esModule",{value:!0}),e.SlidePrompt=void 0,n("./src/sdk/prompts/dom.prompt.ts"));const i=n("./src/sdk/constants.ts"),o=n("./src/sdk/models/events/event.model.ts"),p=n("./src/sdk/enums/event-type.enum.ts"),l=n("./src/sdk/services/logging.service.ts"),u={top:"d-top",bottom:"d-bottom",disabled:"d-disabled"},d={top:"m-top",bottom:"m-bottom",disabled:"m-disabled"};class c extends t.DomPrompt{constructor(){super(...arguments),this.shown=!1,this.stylesAdded=!1}get promptImage(){return this.promptTheme.image}_wireEvents(){var s=this._handleFlowLoaded.bind(this),e=this._handlePromptHide.bind(this),t=this._handleShowPrompt.bind(this),i=[p.EventType.PROMPT_ALLOWED,p.EventType.PROMPT_DISMISSED,p.EventType.PERMISSION_DIALOG_SHOWN,p.EventType.PERMISSION_DENIED,p.EventType.REGISTRATION_SUBSCRIBED,p.EventType.REGISTRATION_MIGRATED];this.watch(p.EventType.FLOW_LOADED,s),this.watch(i,e),this.watch(p.EventType.PROMPT_SHOW,t)}_handleFlowLoaded(){return r(this,void 0,void 0,function*(){yield this.run()})}_handlePromptHide(){return r(this,void 0,void 0,function*(){yield this._hide()})}_handleShowPrompt(){return r(this,void 0,void 0,function*(){this.context.app.loadConfig.manualPromptMode||this.element&&!this.element.classList.contains(i.DEFAULT_CLASSNAME_PROMPT_VISIBLE)&&(yield this._attemptToShow(!0))})}_wireElementEvents(){this.allowBtn.addEventListener("click",this._allow.bind(this)),this.dismissBtn.addEventListener("click",this._dismiss.bind(this))}attachToDom(i){const o=Object.create(null,{attachToDom:{get:()=>super.attachToDom}});return r(this,void 0,void 0,function*(){if(this.stylesAdded||(this.stylesAdded=!0,n("./src/sdk/styles/popover.scss")),yield o.attachToDom.call(this,i),this.parentReady){var s=this._buildTemplate();const e=["pushly_popover","pushly-prompt-window",this.promptTheme.layout||"normal",this.promptConfig.managed?"managed":"non-managed",u[this.promptTheme.position.desktop],d[this.promptTheme.position.mobile]],t=this.element=this._createDivElement({className:e.join(" "),style:"z-index: 999999999"});t.appendChild(s),this.element&&this.parent.appendChild(this.element),this._wireElementEvents()}})}_buildTemplate(){const s=this._createDivElement({className:"pushly_popover-box pushly-prompt-slide",style:"background-color: "+this.promptTheme.background_color}),e=this._createDivElement({className:"pushly_popover-first pushly-prompt-icon"});s.appendChild(e),this.promptImage?(o=this._createImgElement(this.promptImage,this.context.domain.name+" Logo"),e.appendChild(o)):e.style.display="none";const t=this._createDivElement({className:"pushly_popover-second pushly-prompt-content"}),i=(s.appendChild(t),this._createDivElement({className:"pushly_popover-message pushly-prompt-message"}));t.appendChild(i);var o=this._createDivElement({className:"pushly_popover-message-headline pushly-prompt-message-headline",style:"color: "+this.promptTheme.title.text_color,innerText:this.promptTheme.title.text}),o=(i.appendChild(o),this._createDivElement({className:"pushly_popover-message-headline pushly-prompt-message-headline",style:"color: "+this.promptTheme.subtitle.text_color,innerText:this.promptTheme.subtitle.text}));i.appendChild(o);const n=this._createDivElement({className:"pushly_popover-buttons pushly-prompt-actions"});return t.appendChild(n),this.dismissBtn=this._createButtonElement({className:"pushly_popover-buttons-dismiss pushly-prompt-buttons-dismiss",style:`color: ${this.promptTheme.dismiss_button.text_color}; background-color: ${this.promptTheme.dismiss_button.background_color};`,innerText:this.promptTheme.dismiss_button.text}),n.appendChild(this.dismissBtn),this.allowBtn=this._createButtonElement({className:"pushly_popover-buttons-allow pushly-prompt-buttons-allow",style:`color: ${this.promptTheme.allow_button.text_color}; background-color: ${this.promptTheme.allow_button.background_color};`,innerText:this.promptTheme.allow_button.text}),n.appendChild(this.allowBtn),s}run(s={}){const e=Object.create(null,{run:{get:()=>super.run}});return r(this,void 0,void 0,function*(){this.shown||(yield e.run.call(this,s),(yield this._canShow())?(this.dispatch(new o.EventModel(p.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),yield this._attemptToShow(!!s.bypassEligibilityCheck)):this.dispatch(new o.EventModel(p.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())))})}_attemptToShow(e=!1){const t=Object.create(null,{_attemptToShow:{get:()=>super._attemptToShow}});return r(this,void 0,void 0,function*(){var s;yield t._attemptToShow.call(this),this.shown||(s=this.settings.prompt.is_auto_show||e,this._isPlacementEnabled()?(yield this._canShow())&&s&&(yield this._evaluateRunConditions(),yield this._show()):l.Logger.info("Current prompt is not enabled for this placement"))})}_show(){const s=Object.create(null,{_show:{get:()=>super._show}});return r(this,void 0,void 0,function*(){this.shown||(yield s._show.call(this),this.shown=!0)})}}e.SlidePrompt=c},"./src/sdk/repositories/application.repository.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.ApplicationRepository=void 0;const o=t("./src/sdk/utils.ts"),n=t("./src/sdk/data-providers/cookie.data-provider.ts"),r=t("./src/sdk/services/logging.service.ts"),p=t("./src/sdk/models/application/app.model.ts");e.ApplicationRepository=class{static get(){return i(this,void 0,void 0,function*(){let s=new p.AppModel;return r.Logger.info("Data mode: CDM"),s.isVisibleLoggingEnabled=(0,o.tryParseJSON)(yield n.CookieDataProvider.getmv("_pnvl",!1,"pushly.app_visibleLogs")),this.removeDeprecatedCookies(),s})}static set(s){return i(this,void 0,void 0,function*(){return yield n.CookieDataProvider.set("_pnvl",!0===s.isVisibleLoggingEnabled),this})}static purgeCookies(){return i(this,void 0,void 0,function*(){yield this.removeDeprecatedCookies();for(const s of["_pnvl","_pndbg","_pndbgpr"])(yield n.CookieDataProvider.has(s))&&(yield n.CookieDataProvider.clear(s))})}static removeDeprecatedCookies(){return i(this,void 0,void 0,function*(){for(const s of["pushly.app_env","pushly.app_version","pushly.app_workerVersion","pushly_view_logs"])(yield n.CookieDataProvider.has(s))&&(yield n.CookieDataProvider.clear(s))})}}},"./src/sdk/repositories/domain.repository.ts":function(s,e,t){"use strict";var o=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DomainRepository=void 0;const n=t("./src/common/data-providers/api.data-provider.ts"),r=t("./src/sdk/constants.ts"),p=t("./src/sdk/models/domains/domain.model.ts"),l=t("./src/sdk/exceptions/domain-load.exception.ts"),u=t("./src/sdk/services/logging.service.ts");class i extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{static get(i){return o(this,void 0,void 0,function*(){var e;const t=new p.DomainModel;Object.assign(t,{}),u.Logger.info("Updating domain cache");try{let s=r.INJECTED_DOMAIN_SETTINGS;(s=!r.DOMAIN_SETTINGS_INJECTION_FAILED.test(s)&&"domain"in s?s:yield n.ApiDataProvider.get(r.SETTINGS_ENDPOINT+"/"+i))&&(e=s.domain,t.id=e.id,t.name=e.name,t.domainKey=i,t.senderId=e.sender_id,t.customAllowDomain=e.custom_allow_domain,t.frequencyCaps=e.frequency_caps,t.globalPromptSettings=e.global_prompt_settings,t.integrationType=e.integration_type,t.whitelistDomains=e.whitelist_domains,t.sdkEventOnlyDomains=e.sdk_event_only_domains,t.apnsConfiguration=e.apns_configuration,t.flags=e.flags||t.flags||[],t.vapidPublicKey=e.vapid_public_key,t.additionalSubscriptionData=e.additional_subscription_data,t.promptGroups=s.prompt_groups,t.prompts=s.prompts)}catch(s){throw u.Logger.warn("Unable to load remote domain settings.",s),this.debugPromptNotShown({domainKey:i},"load_failed"),new l.DomainLoadException(s)}return t})}}e.DomainRepository=i},"./src/sdk/repositories/subscription.repository.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.SubscriptionRepository=void 0;const o=t("./src/_utils/service-worker-registration.ts");class n extends t("./src/sdk/models/events/eventable.model.ts").EventableModel{static unregister(t){return i(this,void 0,void 0,function*(){let e=!0;try{const s=yield(0,o.getPushlyServiceWorkerRegistration)(t);s&&(e=yield s.unregister())}catch(s){e=!1}return e})}}e.SubscriptionRepository=n},"./src/sdk/repositories/user.repository.ts":function(s,e,t){"use strict";var r=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.UserRepository=void 0;const p=t("./src/sdk/constants.ts"),l=t("./src/sdk/data-providers/cookie.data-provider.ts"),u=t("./src/sdk/prompts/base.prompt.ts"),i=t("./src/sdk/models/users/user.model.ts");e.UserRepository=class{static get(){return r(this,void 0,void 0,function*(){let s={};return s.puuid=s.puuid||l.CookieDataProvider.get("pushly.user_puuid"),s.externalId=s.externalId||l.CookieDataProvider.getmv("_pnxd",null,"pushly.user_externalId"),s.subscriberState=s.subscriberState||l.CookieDataProvider.getmv("_pnss",null,"pushly.user_subscriberState"),s.lastSeenPromptId=s.lastSeenPromptId||l.CookieDataProvider.getmv("_pnlspid",null,"pushly.user_lastSeenPromptId"),"subscribed"===s.subscriberState&&(s.token=s.token||l.CookieDataProvider.getmv("_pntx",null,"pushly.user_token")),s.promptFcapSeconds=l.CookieDataProvider.getmv("_pnfcps",null,"pushly.user_promptFcapSeconds"),s.promptCountState=l.CookieDataProvider.getmv("_pnpcs",null,"pushly.user_promptCountState"),this.removeDeprecatedCookies(),i.UserModel.of(s)})}static set(s){return r(this,void 0,void 0,function*(){return l.CookieDataProvider.set("pushly.user_puuid",s.puuid),l.CookieDataProvider.set("_pnxd",s.externalId),l.CookieDataProvider.set("_pnss",s.subscriberState),l.CookieDataProvider.set("_pnlspid",s.lastSeenPromptId),s.token?l.CookieDataProvider.set("_pntx",s.token):l.CookieDataProvider.clear("_pntx"),this})}static getWithCachePriority(){return r(this,void 0,void 0,function*(){let s={};return s.puuid=l.CookieDataProvider.get("pushly.user_puuid")||s.puuid,s.subscriberState=l.CookieDataProvider.getmv("_pnss",null,"pushly.user_subscriberState")||s.subscriberState,s.lastSeenPromptId=l.CookieDataProvider.getmv("_pnlspid",null,"pushly.user_lastSeenPromptId")||s.lastSeenPromptId,"subscribed"===s.subscriberState&&(s.token=l.CookieDataProvider.getmv("_pntx",null,"pushly.user_token")||s.token),s.promptFcapSeconds=l.CookieDataProvider.getmv("_pnfcps",null,"pushly.user_promptFcapSeconds"),s.promptCountState=l.CookieDataProvider.getmv("_pnpcs",null,"pushly.user_promptCountState"),i.UserModel.of(s)})}static setPromptState(t,i){return r(this,void 0,void 0,function*(){var{promptFcapSeconds:s,promptCountState:e}=t;return l.CookieDataProvider.setWithRawExpires("_pnfcps",s,i),l.CookieDataProvider.setWithRawExpires("_pnpcs",e,i),this})}static clearPromptState(){return r(this,void 0,void 0,function*(){return l.CookieDataProvider.clear("_pnfcps"),l.CookieDataProvider.clear("_pnpcs"),this})}static setPromptDismissedState(o,n){return r(this,void 0,void 0,function*(){let s=p.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT,e="d",t={};var i;return"cookie_length_seconds"in(t=n instanceof u.BasePrompt?n.promptConfig.behavior||{}:n.promptBehavior||{})&&(null!=(i=t.cookie_length_seconds)&&(s=i,e="s")),0!==s?(o.subscriberState="dismissed",l.CookieDataProvider.set("_pnpdm",!0,s,e)):o.subscriberState="none",yield this.set(o),self})}static getPromptDismissedState(){return r(this,void 0,void 0,function*(){var s=l.CookieDataProvider.getmv("_pnpdm",!1,"pushly.prompt_dismissed");return"true"===s||!0===s})}static purgeCookies(){this.removeDeprecatedCookies();["pushly.user_puuid","_pnss","_pnlspid","_pnupf","_pntx","_pnfcps","_pnpcs","_pnpdm"].forEach(s=>{l.CookieDataProvider.has(s)&&l.CookieDataProvider.clear(s)})}static removeDeprecatedCookies(){["pushly.user_createdAt","pushly.user_updatedAt","pushly.user_profile","pushly.user_lifetimeViewedKeywordMap","pushly_uqid","pushly_uqid_timestamp","pushly_subscriber_data_updated_at","pushly_do_not_track","pushly_apns_token","pushly_fcm_token","pushly_subscribed","_pndnt","_dor","_pnupf"].forEach(s=>{l.CookieDataProvider.has(s)&&l.CookieDataProvider.clear(s)})}}},"./src/sdk/sdk.ts":function(s,e,t){"use strict";var o=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.SDK=void 0;const u=t("./src/sdk/enums/event-type.enum.ts"),n=t("./src/sdk/services/logging.service.ts"),i=t("./src/_utils/validate-only-instance-of-sdk.ts"),r=t("./src/sdk/services/user-debug.service.ts"),p=t("./src/sdk/enums/steamable-event-type.enum.ts"),l=t("./src/sdk/enums/consent.enum.ts"),d=t("./src/sdk/constants.ts"),c=t("./src/sdk/factories/data-provider-factory.ts"),h=t("./src/sdk/exceptions/exit.exception.ts"),a=t("./src/sdk/exceptions/fail.exception.ts"),m=t("./src/sdk/services/flow.service.ts"),v=t("./src/_utils/consent.ts"),y=t("./src/sdk/services/prompt.service.ts"),f=t("./src/sdk/exceptions/pushly.exception.ts"),_=t("./src/sdk/data-providers/cookie.data-provider.ts"),b=t("./src/sdk/services/app.service.ts"),g=t("./src/sdk/enums/runtime-environment.enum.ts"),w=t("./src/sdk/services/user.service.ts"),A=t("./src/sdk/services/domain.service.ts"),k=t("./src/sdk/exceptions/domain-load.exception.ts"),x=t("./src/sdk/cross-frame-messenger/messenger-server.ts"),E=t("./src/sdk/services/registration.service.ts");var I=t("./src/sdk/models/events/eventable.model.ts");const P=t("./src/sdk/models/events/event.model.ts"),S=t("./src/sdk/enums/exception-message.enum.ts"),C=t("./src/sdk/exceptions/invalid-event.exception.ts"),O=t("./src/sdk/services/environment.service.ts"),j=t("./src/sdk/exceptions/worker-registration.exception.ts"),M=t("./src/sdk/utils.ts"),D=t("./src/_utils/interval-runner.ts");class B extends I.EventableModel{constructor(s){super(),this.context=s,this.iid=(0,M.randomString)(),this._swsts_=Date.now(),this._swclk_=0,(this._swclkInitialized_=!1,i.validateOnlyInstanceOfSdk)(this),this.t(),this.p()}push(i){return o(this,void 0,void 0,function*(){let s=i[0];const e=/^on_/i;try{var t;e.test(s)?(s=s.replace(e,""),this.watch(s,i[1])):(t=new P.EventModel(s,i[1]),yield this.dispatch(t))}catch(s){if(!(s instanceof C.InvalidEventException))throw s;n.Logger.warn(s.message)}})}on(s,e){return o(this,void 0,void 0,function*(){yield this.push(["on_"+s,e])})}trigger(s,e){return o(this,void 0,void 0,function*(){yield this.push([s,e])})}showLogs(s=!0){return o(this,void 0,void 0,function*(){this.context.app.isVisibleLoggingEnabled=!!s,yield b.AppService.saveApp(this.context.app),n.Logger.setVisibleLogsEnabled(s)})}getLogs(){return n.Logger.logs}load(s,e=!1){return o(this,void 0,void 0,function*(){try{yield this.l(s,e)}catch(s){let e=!1;s&&(s instanceof a.FailException||s instanceof k.DomainLoadException||s instanceof j.WorkerRegistrationException?(e=!0,n.Logger.error(this.context,s)):(s instanceof f.PushlyException||s&&s.isPushlyException)&&(e=!0,n.Logger.warn(s.message)),(s instanceof j.WorkerRegistrationException||s instanceof k.DomainLoadException||"object"==typeof s&&"message"in s&&s.message===S.ExceptionMessage.HOST_NOT_WHITELISTED)&&this.dispatch(new P.EventModel(u.EventType.APPLICATION_ERROR,{message:s.message}))),e||(yield this.u(s))}})}requestNotificationPermission(s=0,e){return o(this,void 0,void 0,function*(){if(!this.context.domain.isEventOnlyMode())return E.RegistrationService.performManualRegistrationAttempt(this.context,s,e);n.Logger.warn("Requesting notification permission is not available while in event only mode.")})}isUserSoftUnsubscribed(){return o(this,void 0,void 0,function*(){return this.context.user.isInUdr})}isUserEligibleToPrompt(){return o(this,void 0,void 0,function*(){return yield this.context.user.isEligibleToPrompt(this.context)})}isUserSubscribed(){return o(this,void 0,void 0,function*(){return yield this.context.user.isSubscribed(this.context)})}l(s,e){return o(this,void 0,void 0,function*(){if(this.context.runtimeEnvironment=s._subRuntimeEnvironmentOverride,this.context.runtimeEnvironment!==g.RuntimeEnvironment.AMP_FRAME_HELPER&&this.context.runtimeEnvironment!==g.RuntimeEnvironment.BROKERED_DATA_SERVER||x.MessengerServer.global.accept(),(0,i.validateOnlyInstanceOfSdk)(this),s.domainKey&&""!==s.domainKey.trim())return this.context.c=s,this.context.domainKey=s.domainKey,this.context.consent=(0,v.buildSdkConsentContext)(s,e),n.Logger.info("Loading: "+this.context.domainKey),this.context.domain=yield A.DomainService.loadDomain(this.context.domainKey),_.CookieDataProvider.domain=this.context.domain,this._runtimeEnvShouldSendSdkImpression(s)&&!b.AppService.inUdrContext()&&this.debug(this.context,p.StreamableEventType.SDK_IMPRESSION),this.context.env=yield O.EnvironmentService.loadEnv(),yield O.EnvironmentService.verifyEnvironmentSupport(s,this.context),yield A.DomainService.verifyEnvironmentSupport(this.context),this.context.domain.hasFlag("FEAT_SDK_RESTRICT_MULTI_SUBS")&&!this.context.domain.isEventOnlyMode()&&O.EnvironmentService.verifyNoSiblingSubscriptions(s,this.context),this.h();throw new h.ExitException(null,S.ExceptionMessage.DOMAIN_KEY_NOT_SPECIFIED)})}h(){return o(this,void 0,void 0,function*(){var e=this.context.c;if(this.context.consent.required&&this.context.consent.status===l.ConsentStatus.UNCONFIRMED)n.Logger.info("Awaiting Consent");else{this.context.app=yield b.AppService.loadApp(e),this.context.env.mode=this.context.app.mode,n.Logger.setVisibleLogsEnabled(this.context.app.isVisibleLoggingEnabled);let s=this.context.app.mode;this.context.domain.isEventOnlyMode()&&(s+=" [event only]"),n.Logger.info("Application Mode: "+s),n.Logger.info("Version: "+d.PUSHLY_APPLICATION_VERSION);try{const i=yield c.DataProviderFactory.getSessionDataProvider(this.context);var t=parseInt((yield i.getCurrentSession()).sessionStart);t<this._swsts_?this._swsts_=t:yield i.set("sessionStart",this._swsts_)}catch(s){}if(this.context.user=yield w.UserService.loadUser(e,this.context),!this.context.user)throw new a.FailException(null,S.ExceptionMessage.USER_UNABLE_TO_LOAD);yield O.EnvironmentService.verifyUdrState(this.context),e.externalId&&this.push(["profile",{external_id:e.externalId}]),r.UserDebugService.shouldShowDebugPanel()&&r.UserDebugService.showDebugPanel(this.context),O.EnvironmentService.configureRuntimeEnvironments(this.context),this.context.app.isLoaded=!0,n.Logger.info("Loaded"),this.dispatch(new P.EventModel(u.EventType.APPLICATION_LOADED)),this.context.user.isInUdr?(yield this.m(),n.Logger.info("Halting (UDR)")):yield this._loadFlows(e)}})}_loadFlows(t){return o(this,void 0,void 0,function*(){if(t.disableWebFlow)yield this.m();else{const e=m.FlowService.loadFlow(this.context);var s;!t.manualPromptMode&&e.isPromptableFlow&&(yield w.UserService.verifyUserSubscriptionState(this.context),this.context.domain.isEventOnlyMode()||(s={isSafari:this.context.env.isSafari()},y.PromptService.loadPrompts(this.context,s))),yield e.run()}})}_runtimeEnvShouldSendSdkImpression(s){const e=[g.RuntimeEnvironment.AMP_FRAME_HELPER,g.RuntimeEnvironment.AMP_PERMISSION_DIALOG,g.RuntimeEnvironment.PROXY,g.RuntimeEnvironment.PROXY_FRAME_HELPER,g.RuntimeEnvironment.PROXY_PERMISSION_DIALOG,g.RuntimeEnvironment.AMP,g.RuntimeEnvironment.AMP_FRAME_HELPER,g.RuntimeEnvironment.BROKERED_DATA_SERVER];return-1===e.indexOf(s._subRuntimeEnvironmentOverride)}t(){var s,e,t,i,o,n,r,p,l;this.context.app&&this.context.app.isLoaded||(s=this.v.bind(this),e=this.m.bind(this),t=this.y.bind(this),i=this.f.bind(this),o=this._.bind(this),n=this.b.bind(this),r=this.g.bind(this),p=this.w.bind(this),l=this.A.bind(this),this.watchOnce(u.EventType.CONFIRM_CONSENT,s),this.watchOnce(u.EventType.APPLICATION_LOAD,i),this.watchOnce(u.EventType.AMP_FRAME_HELPER_LOAD,o),this.watchOnce(u.EventType.AMP_PERMISSION_DIALOG_LOAD,n),this.watchOnce(u.EventType.PROXY_PERMISSION_DIALOG_LOAD,r),this.watchOnce(u.EventType.BROKERED_DATA_SERVER_LOAD,l),this.watchOnce(u.EventType.FLOW_LOADED,e),this.watch(u.EventType.REVERT_USER_DELETION,p),this.watch(u.EventType.PROMPT_SHOW,t),w.UserService.wireProfileEvents(this.context))}v(){this.context.app&&this.context.app.isLoaded||this.load(this.context.c,!0)}w(){return o(this,void 0,void 0,function*(){_.CookieDataProvider.has("_pnudr")&&(yield w.UserService.handleUdrRevert(this.context))})}f(s){this.load(s)}_(s){s._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.AMP_FRAME_HELPER,n.Logger.setSubApplicationName("amp-helper-frame"),n.Logger.setColor("#7CBE7B"),n.Logger.setBackgroundColor("black"),this.load(s)}b(s){s._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.AMP_PERMISSION_DIALOG,n.Logger.setSubApplicationName("amp-permission-dialog"),this.load(s)}g(s){s._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.PROXY_PERMISSION_DIALOG,n.Logger.setSubApplicationName("proxy-permission-dialog"),this.load(s)}A(s){n.Logger.setSubApplicationName("brokered-data-server"),n.Logger.setColor("#FFC152"),n.Logger.setBackgroundColor("black"),s._subRuntimeEnvironmentOverride=g.RuntimeEnvironment.BROKERED_DATA_SERVER,this.load(s)}y(s){return o(this,void 0,void 0,function*(){this.k(()=>{this.context.domain.isEventOnlyMode()?n.Logger.warn("Manual prompting is not available while in event only mode."):(this.context.app.loadConfig.manualPromptMode||n.Logger.warn("Manual prompt mode is not enabled."),y.PromptService.performManualPromptLoad(this.context,s))},"Delaying 'show_prompt' request.")})}m(){return o(this,void 0,void 0,function*(){n.Logger.info("Ready"),this.context.app.isReady=!0,this.dispatch(new P.EventModel(u.EventType.APPLICATION_READY,this.context))})}k(s,e){this.context.app&&this.context.app.isReady?s():(n.Logger.debug(e||"Delaying request until application is in ready state."),this.watchOnce(u.EventType.APPLICATION_READY,s))}u(e){return o(this,void 0,void 0,function*(){if("object"==typeof e){e.context=Object.assign(Object.assign({},e.context),{sw_error:!1});const s=new RegExp(d.UNCAUGHT_ERROR_BLACKLIST.map(s=>`(${s})`).join("|"),"i");s.test(e.name)||s.test(e.message)?n.Logger.warn(this.context,e):n.Logger.error(this.context,e)}else n.Logger.error(this.context,e)})}p(){return o(this,void 0,void 0,function*(){this._swclkInitialized_||(this._swclkInitialized_=!0,(0,D.setIntervalRunner)(()=>{this._swclk_+=1,this.context.clock=this._swclk_},1e3))})}}e.SDK=B},"./src/sdk/services/app.service.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.AppService=void 0;const o=t("./src/sdk/data-providers/cookie.data-provider.ts"),n=t("./src/sdk/repositories/application.repository.ts"),r=t("./src/sdk/exceptions/exit.exception.ts"),p=t("./src/_utils/global-env.ts");e.AppService=new class{loadApp(e){return i(this,void 0,void 0,function*(){const s=yield n.ApplicationRepository.get();if(s.loadConfig=e,s.loadConfig.classNames=s.loadConfig.classNames||{},s.mode=(s.loadConfig.mode||s.mode||"production").toString().toLowerCase(),["production","development"].includes(s.mode))return yield this.saveApp(s),s.classNames=e.classNames,s;throw new r.ExitException("Invalid sdk mode specified.")})}saveApp(s){return i(this,void 0,void 0,function*(){return yield n.ApplicationRepository.set(s),s})}processUdr(){return i(this,void 0,void 0,function*(){return o.CookieDataProvider.set("_pnudr",1),n.ApplicationRepository.purgeCookies()})}inUdrContext(){return this.udrCookiePresent()||this.udrParamPresent()}udrCookiePresent(){let s=!1;try{s=!!o.CookieDataProvider.get("_pnudr")}catch(s){}return s}udrParamPresent(){var s=(0,p.getLocation)();let e=!1;try{e=/(^|[?&#])(push(ly)?_udr)=1(?=[&#]|$)/i.test(s.search)}catch(s){}return e}}},"./src/sdk/services/domain.service.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DomainService=void 0;const l=t("./src/_utils/global-env.ts"),o=t("./src/sdk/models/events/event.model.ts"),u=t("./src/sdk/enums/exception-message.enum.ts"),n=t("./src/sdk/enums/event-type.enum.ts"),d=t("./src/sdk/exceptions/exit.exception.ts");var r=t("./src/sdk/models/events/eventable.model.ts");const p=t("./src/sdk/repositories/domain.repository.ts");class c extends r.EventableModel{loadDomain(s){return i(this,void 0,void 0,function*(){return p.DomainRepository.get(s)})}verifyEnvironmentSupport(s){return i(this,void 0,void 0,function*(){if(s.env.isSafari()&&!s.env.isPushManagerInScope()){if(!s.domain.hasApnsConfig())throw this.debugPromptNotShown(s,"apns_not_configured"),this.dispatch(new o.EventModel(n.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.EventModel(n.EventType.DOMAIN_APNS_NOT_CONFIGURED)),new d.ExitException(null,u.ExceptionMessage.DOMAIN_APNS_NOT_CONFIGURED);if(!s.domain.isApnsConfigEnabled())throw this.debugPromptNotShown(s,"apns_not_enabled"),this.dispatch(new o.EventModel(n.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.EventModel(n.EventType.DOMAIN_APNS_NOT_ENABLED)),new d.ExitException(null,u.ExceptionMessage.DOMAIN_APNS_NOT_ENABLED);if(!s.domain.getWebsitePushId())throw this.debugPromptNotShown(s,"apns_invalid_config"),this.dispatch(new o.EventModel(n.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.EventModel(n.EventType.DOMAIN_APNS_INVALID_CONFIG)),new d.ExitException(null,u.ExceptionMessage.DOMAIN_APNS_INVALID_CONFIG)}this.validateHostAvailability(s)})}validateHostAvailability(s){var e=(0,l.getLocation)();let t,i=s.domain.whitelistDomains;if(i)if(Array.isArray(i)&&0!==i.length){0<i.length&&s.env.isSafari()&&(i=[i[0]]);var o=["localhost","127.0.0.1"];const n=e.protocol+"//"+e.hostname,r=e.protocol+"//"+e.host,p=e.href;e=[...i,...o].some(s=>{/^\*/.test(s)&&(s="."+s);const e=new RegExp(`^(http[s]?://)?${s}$`,"i");return e.test(n)||e.test(r)||e.test(p)});t=!e}else t=!1;else t=!1;if(t)throw this.debugPromptNotShown(s,"host_not_whitelisted"),new d.ExitException(null,u.ExceptionMessage.HOST_NOT_WHITELISTED)}}e.DomainService=new c},"./src/sdk/services/environment.service.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.EnvironmentService=void 0;const n=t("./src/sdk/services/logging.service.ts"),o=t("./src/sdk/services/app.service.ts"),r=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),p=t("./src/sdk/enums/runtime-environment.enum.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/services/user.service.ts");var d=t("./src/sdk/models/events/eventable.model.ts");const c=t("./src/sdk/models/events/event.model.ts"),h=t("./src/sdk/enums/exception-message.enum.ts"),a=t("./src/sdk/enums/steamable-event-type.enum.ts"),m=t("./src/sdk/models/application/environment.model.ts"),v=t("./src/sdk/factories/data-provider-factory.ts"),y=t("./src/sdk/exceptions/exit.exception.ts"),f=t("./src/sdk/enums/integration-type.enum.ts");class _ extends d.EventableModel{loadEnv(){return i(this,void 0,void 0,function*(){return new m.EnvironmentModel})}verifyNoSiblingSubscriptions(e,s){if(s.env.document.cookie.split(";").map(s=>s.toString().trim().split("=")).find(s=>/^_pnss/.test(s[0])&&!new RegExp(e.domainKey.substr(-8)+"$").test(s[0])&&"subscribed"===s[1]))throw this.debugPromptNotShown(s,"sibling_subscription_detected",s.env.unsupportedReason),this.dispatch(new c.EventModel(l.EventType.EXISTING_SUBSCRIPTION_DETECTED,void 0,e,s.env)),new y.ExitException(null,h.ExceptionMessage.EXISTING_SUBSCRIPTION_DETECTED)}verifyEnvironmentSupport(e,t){return i(this,void 0,void 0,function*(){var s=!!t.env&&(yield t.env.isPushSupported());if(s)return this.dispatch(new c.EventModel(l.EventType.WEB_PUSH_SUPPORTED)),s;throw this.debugPromptNotShown(t,"web_push_unsupported",t.env.unsupportedReason),this.dispatch(new c.EventModel(l.EventType.WEB_PUSH_NOT_SUPPORTED,void 0,e,t.env)),new y.ExitException(null,h.ExceptionMessage.ENV_NOT_SUPPORTED)})}verifyUdrState(e){return i(this,void 0,void 0,function*(){if(o.AppService.inUdrContext()){e.user.isInUdr=!0;try{o.AppService.udrParamPresent()&&!o.AppService.udrCookiePresent()&&(yield this.post(new r.SubscriberStreamableEventModel(a.StreamableEventType.UDR,{},e)),yield o.AppService.processUdr(),yield u.UserService.processUdr(),this.dispatch(new c.EventModel(l.EventType.USER_DELETION_REQUEST)));const s=yield v.DataProviderFactory.getPermissionDataProvider(e);yield s.removeRegistration()}catch(s){"NoResponseException"!==s.name&&n.Logger.warn("Error processing UDR:",s)}}})}configureRuntimeEnvironments(s){const{app:e,domain:t,env:i}=s;if(t.integrationType===f.IntegrationType.DIRECT&&t.customAllowDomain&&!i.isHTTPS()&&!i.isDevMode())i.primaryRuntimeEnvironment=p.RuntimeEnvironment.PROXY;else if(e.loadConfig._subRuntimeEnvironmentOverride){var o=e.loadConfig._subRuntimeEnvironmentOverride;switch(o){case p.RuntimeEnvironment.BROKERED_DATA_SERVER:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.BROKERED_DATA_SERVER;break;case p.RuntimeEnvironment.AMP_FRAME_HELPER||p.RuntimeEnvironment.AMP_PERMISSION_DIALOG:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.AMP,i.subRuntimeEnvironment=o;break;case p.RuntimeEnvironment.PROXY_PERMISSION_DIALOG:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.PROXY,i.subRuntimeEnvironment=o}}i.primaryRuntimeEnvironment||(t.integrationType===f.IntegrationType.PROXY?i.primaryRuntimeEnvironment=p.RuntimeEnvironment.PROXY:i.primaryRuntimeEnvironment=p.RuntimeEnvironment.DIRECT),n.Logger.info("Current runtime environment: "+p.RuntimeEnvironmentName[i.subRuntimeEnvironment||i.primaryRuntimeEnvironment])}}e.EnvironmentService=new _},"./src/sdk/services/flow.service.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlowService=e.FlowSvc=void 0;const i=t("./src/sdk/factories/flow.factory.ts");class o{loadFlow(s){return i.FlowFactory.getFlow(s)}}e.FlowSvc=o,e.FlowService=new o},"./src/sdk/services/helpers/apns.service-helpers.ts":function(s,e,t){"use strict";var o=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.ApnsServiceHelpers=void 0;const u=t("./src/sdk/services/logging.service.ts"),d=t("./src/sdk/constants.ts"),n=t("./src/sdk/enums/exception-message.enum.ts"),r=t("./src/sdk/enums/notification-permission-state.enum.ts"),p=t("./src/sdk/exceptions/fail.exception.ts");e.ApnsServiceHelpers=class{static getToken(t){return o(this,void 0,void 0,function*(){let s;var e=yield t.user.getComputedPushPermission(t);return s=e.deviceToken?e.deviceToken:s})}static requestNotificationPermission(t,i){return o(this,void 0,void 0,function*(){const s={permissionState:"default"};var e=t.domain.getWebsitePushId(),e=(u.Logger.info("APNS checking permission for",e),yield t.user.getComputedPushPermission(t));if(s.permissionState=e.permission,s.permissionState===r.NotificationPermissionState.GRANTED)u.Logger.info("APNS permission already granted"),s.token=e.deviceToken;else{e=yield this._checkRemotePermission(t,s,i);if(s.permissionState=e.permission,u.Logger.info("APNS response",e),e.permission===r.NotificationPermissionState.GRANTED&&(s.token=e.deviceToken,t.user.setPushPermission(e),!s.token))throw new p.FailException(null,n.ExceptionMessage.APNS_FAILED_TO_GET_GRANTED_TOKEN)}return s})}static _checkRemotePermission(s,e,t){return o(this,void 0,void 0,function*(){if(null!==e&&e.permissionState!==r.NotificationPermissionState.DEFAULT)return e;if(t)try{t()}catch(s){}return this._requestSafariPermissions(s)})}static _requestSafariPermissions(l){return o(this,void 0,void 0,function*(){return new Promise(e=>{u.Logger.info("Setting permission scope");const t=l.env.scope,i=(u.Logger.info("Gathering permission snapshot"),t.safari.pushNotification.permission(l.domain.getWebsitePushId())||{});let o,n=0,r=!1;function p(){clearInterval(o),r=!0}u.Logger.info("Requesting permission"),t.safari.pushNotification.requestPermission(d.APNS_URL,l.domain.getWebsitePushId(),{domain_key:l.domainKey,pushly_unique_user_id:l.user.puuid},s=>{r||(p(),e(s),u.Logger.info(`Native permission response sent [${s.permission}]`))}),o=setInterval(()=>{try{var s;r||(n+=1,s=t.safari.pushNotification.permission(l.domain.getWebsitePushId())||{},600<=n?(clearInterval(o),u.Logger.info(`Fallback permission retry attempts exhausted, [${s.permission}]`)):s.permission!==i.permission&&(p(),e(s),u.Logger.info(`Fallback permission response sent [${s.permission}]`)))}catch(s){u.Logger.warn("sw.apns.error",s)}},500)})})}}},"./src/sdk/services/helpers/user-profile.service-helpers.ts":function(s,e,t){"use strict";var p=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.UserProfileServiceHelpers=void 0;const l=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),i=t("./src/sdk/enums/steamable-event-type.enum.ts"),u=t("./src/sdk/exceptions/profile.exception.ts");var o=t("./src/sdk/models/events/eventable.model.ts");const d=t("./src/sdk/utils.ts"),n=t("./src/sdk/enums/event-priority.enum.ts");class r extends o.EventableModel{static saveUserTags(s,e,t=0){return p(this,void 0,void 0,function*(){Array.isArray(e)||(e=[e]),yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,s,{tag:e},t)})}static saveUserEvent(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,s,{event:[e]})})}static saveUserProfileData(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,s,{profile:e})})}static appendProfileArrayValue(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_APPEND,s,{profile:e})})}static removeProfileArrayValue(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_REMOVE,s,{profile:e})})}static pageTagVisit(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PAGE_TAG_VISITS,s,{page_tags:e})})}static viewItem(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.VIEW_ITEM,s,e)})}static saveItem(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.SAVE_ITEM,s,e)})}static addToCart(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.ADD_TO_CART,s,e,null,n.EventPriority.IMMEDIATE)})}static updateCartItem(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.UPDATE_CART_ITEM,s,e,null,n.EventPriority.IMMEDIATE)})}static purchase(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PURCHASE,s,e,null,n.EventPriority.IMMEDIATE)})}static saveExternalUserId(s,e){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.PROFILE_UPDATE,s,{profile:{external_id:e}},0)})}static deregisterExternalUserId(s){return p(this,void 0,void 0,function*(){yield this.patchProfile(i.StreamableEventType.DEREGISTER_EXTERNAL_ID,s,{},0)})}static patchProfile(t,i,o,n=0,r){return p(this,void 0,void 0,function*(){try{n&&0<n&&(yield(0,d.delayRandom)(n));let s={};o&&o.meta&&(s=o.meta);var e=(yield i.user.getComputedPushPermission(i)).subscription;s.subscription_data=e||void 0,yield this.post(new l.SubscriberStreamableEventModel(t,Object.assign(Object.assign({},o),{meta:s}),i),null,r)}catch(s){throw new u.ProfileException(s)}})}}e.UserProfileServiceHelpers=r},"./src/sdk/services/helpers/vapid.service-helpers.ts":function(s,e,t){"use strict";var p=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.VapidServiceHelpers=void 0;const l=t("./src/sdk/services/logging.service.ts"),r=t("./src/common/md5.ts"),u=t("./src/sdk/services/worker.service.ts"),d=t("./src/_utils/service-worker-registration.ts"),n=t("./src/_utils/base-64.ts"),c=t("./src/sdk/data-providers/local-permission.data-provider.ts"),h=t("./src/sdk/enums/exception-message.enum.ts"),i=t("./src/sdk/enums/notification-permission-state.enum.ts"),a=t("./src/sdk/exceptions/fail.exception.ts"),m=t("./src/sdk/utils.ts");e.VapidServiceHelpers=class{static getToken(o){return p(this,void 0,void 0,function*(){let e,t=yield this.getSubscription(o,!1);var s=o.user.isSubscribed(o);if(t&&t.endpoint&&(e=(0,r.MD5)(t.endpoint),o.domain&&o.domain.vapidPublicKey)){var i=o.domain.vapidPublicKey;let s;(s=t.options&&t.options.applicationServerKey?(0,n.arrayBufferToBase64)(t.options.applicationServerKey):s)!==i&&(t=yield this.subscribe(i,o,t),e=(0,r.MD5)(t.endpoint))}i=yield o.user.getLocalPushPermission(o);return e=!e&&s&&"granted"===i.permission&&(s=yield this.handleNotificationPermissionGranted(o,{permissionState:"granted"}))&&s.token?s.token:e})}static getSubscription(e,t=!0){return p(this,void 0,void 0,function*(){let s=null;return(yield(0,d.getPushlyServiceWorkerRegistration)(e))?s=yield(0,d.getPushSubscription)(e):t&&(yield u.WorkerService.registerWorker(e)),s})}static requestNotificationPermission(t,i){return p(this,void 0,void 0,function*(){var s=yield t.user.getLocalPushPermission(t);const e={permissionState:s.permission};return"default"===s.permission&&(i&&i(),l.Logger.debug("Requesting browser notification permission"),e.permissionState=yield Notification.requestPermission()),e})}static handleNotificationPermissionGranted(o,n){return p(this,void 0,void 0,function*(){var s=yield o.user.getLocalPushPermission(o,!0);if(n.permissionState=s.permission,n.permissionState===i.NotificationPermissionState.GRANTED){let s,t,i=1e3;for(let e=0;e<10;e++){try{if(n.subscription=yield this.subscribe(o.domain.vapidPublicKey,o),s=n.subscription?n.subscription.endpoint:s)break}catch(s){e<9?l.Logger.warn(s):t=s}l.Logger.info("Retrying fetch token"),i*=3,yield(0,m.delay)(i)}if(!s)throw new a.FailException(t,h.ExceptionMessage.FAILED_TO_GET_GRANTED_TOKEN);if("string"!=typeof s){const e=new a.FailException(null,h.ExceptionMessage.INVALID_TOKEN_TYPE);throw e.context={token:s},e}n.token=(0,r.MD5)(s)}return n})}static subscribe(s,n,r){return p(this,void 0,void 0,function*(){let e=yield(0,d.getPushlyServiceWorkerRegistration)(n);e=e||(yield u.WorkerService.registerWorker(n));try{yield(0,d.createPushSubscription)(n,e)}catch(s){if(!/unsubscribe then resubscribe/i.test(s.message))throw s;var t;if(r)l.Logger.info("Attempting to unsubscribe previous subscription"),yield r.unsubscribe();else for(t of yield(0,d.getServiceWorkerRegistrations)(n)){const o=yield t.pushManager.getSubscription();yield o.unsubscribe()}l.Logger.info("Resubscribing"),yield(0,d.createPushSubscription)(n,e)}const s=new c.LocalPermissionDataProvider(n);var i=yield s.getPushPermission();return n.user.setPushPermission(i),i.subscription})}}},"./src/sdk/services/logging.service.ts":function(s,e,t){"use strict";var n=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;const i=t("./node_modules/error-stack-parser/error-stack-parser.js"),l=t("./src/sdk/constants.ts"),r=t("./src/_utils/global-env.ts"),p=t("./src/sdk/utils.ts"),u=t("./src/sdk/exceptions/pushly.exception.ts"),d=t("./src/sdk/enums/steamable-event-type.enum.ts"),c=t("./src/sdk/models/context.model.ts"),h=["test",l.ENV_NAME_DEV,l.ENV_NAME_LOCAL,l.ENV_NAME_STAGING],a=["test",l.ENV_NAME_LOCAL_PRODUCTION,l.ENV_NAME_PRODUCTION];e.Logger=new class{constructor(){this.logs=[],this.applicationName=l.PUSHLY_SDK_APPLICATION_NAME,this.color=null,this.backgroundColor=null,this.subApplicationName=null,this.plugins=[];var s=(this.visibleLogsEnabled=!1,r.getNavigator)();try{if("plugins"in s)for(var e=0;e<s.plugins.length;e++)this.plugins.push(s.plugins[e].name)}catch(s){this.plugins.push("unable to collect plugin information")}}setVisibleLogsEnabled(s){this.visibleLogsEnabled=s}getComputedApplicationName(){let s=this.applicationName;return s=this.subApplicationName?this.applicationName+"::"+this.subApplicationName:s}print(s,e){var t;if((0,r.getSelf)().console)for(t of Array.isArray(e)?e:[e]){t instanceof Object&&(t=JSON.stringify(t));const i=[`[${this.getComputedApplicationName()}] `+t],o=[];this.color&&o.push("color: "+this.color),this.backgroundColor&&o.push("background-color: "+this.backgroundColor),o&&(i[0]="%c"+i[0],i.push(o.join(";"))),console[s].apply(console,i)}}getBacktrace(e){let t=[];try{let s=(0,i.parse)(e);s.forEach(s=>{t.push({file:s.fileName,line:s.lineNumber,column:s.columnNumber,function:s.functionName})})}catch(e){this.warn(e),t.push({file:"logging.service.ts",line:"1",function:"getBacktrace"})}return t}debug(...s){this.logs=Array.prototype.concat(this.logs,s.map(s=>["debug",s])),!this.visibleLogsEnabled&&-1===h.indexOf(l.ENV_NAME)||this.print("debug",s)}info(...s){this.logs=Array.prototype.concat(this.logs,s.map(s=>["info",s])),!this.visibleLogsEnabled&&-1===h.indexOf(l.ENV_NAME)||this.print("log",s)}warn(...s){this.logs=Array.prototype.concat(this.logs,s.map(s=>["warn",s])),!this.visibleLogsEnabled&&-1===h.indexOf(l.ENV_NAME)||this.print("warn",s)}error(...o){let n;if(o[0]instanceof c.ContextModel&&(n=o.shift()),this.logs=Array.prototype.concat(this.logs,o.map(s=>["error",s])),!this.visibleLogsEnabled&&-1===h.indexOf(l.ENV_NAME)||this.print("error",o),n&&0<o.length){let s=0,t=[],e=(this.logs.forEach(s=>{var e=s[0],s=s[1]instanceof Error?s[1].message:s[1];t.push([e,s])}),1<o.length&&-1===(s=o.findIndex(s=>s instanceof Error))&&(s=0),o.splice(s,1)),i=(e&&0<e.length?e=e[0]:(e=new Error("Cannot resolve error from logs")).code="sw/cannot-resolve-error-from-logs",e instanceof Error?e:new Error(e));if(i instanceof Error){let s=!1;const p={error_type:i.name,error_message:i.message,backtrace:this.getBacktrace(i),logs:Array.from(t).splice(t.length-15,15),plugins:this.plugins};i instanceof u.PushlyException&&(s=i.shouldSuppress(),"originError"in i&&i.originError instanceof Error&&(p.error_message!=i.originError.message&&(p.error_message=p.error_message+"; "+i.originError.message),p.backtrace=this.getBacktrace(i.originError)));var{context:o,code:r}=i;r&&(p.error_code=r),p.context={suppressed:s||!1,originError:i.originError||null};try{p.context=Object.assign(Object.assign({},p.context),o)}catch(s){}let e=!1;n.domain&&n.domain.hasFlag("SDK_DEBUG_EVENTS")&&(e=!0),s&&!e||this.streamError(n,p)}}}streamError(i,o){return n(this,void 0,void 0,function*(){var s=i.domain||{},e=i.user||{},t=(o=Object.assign(Object.assign({},o),{sdk_version:2,source:{application:this.applicationName,version:l.PUSHLY_APPLICATION_VERSION},page_url:i.env.location.toString(),pushly_unique_user_id:e.puuid}),"safari"in(0,r.getSelf)()?"apns_token":"fcm_subscription_id"),t=(o[t]=e.token,{action:d.StreamableEventType.ERROR,domain_id:s.id,domain_key:i.domainKey,event_date:(new Date).toISOString(),meta:o});-1!==a.indexOf(l.ENV_NAME)?(0,p.retryFetch)(l.EVENTS_ENDPOINT,{headers:{"content-type":"text/plain"},method:"POST",body:JSON.stringify(t)},()=>{}):console.log(t)})}setSubApplicationName(s){this.subApplicationName=s}setColor(s){this.color=s}setBackgroundColor(s){this.backgroundColor=s}}},"./src/sdk/services/prompt.service.ts":function(s,e,t){"use strict";var o=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.PromptService=void 0;const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/services/logging.service.ts"),p=t("./src/_utils/global-env.ts"),i=t("./src/sdk/enums/prompt-style.enum.ts"),l=t("./src/sdk/prompts/native.prompt.ts"),u=t("./src/sdk/enums/event-type.enum.ts");var d=t("./src/sdk/models/events/eventable.model.ts");const c=t("./src/sdk/models/events/event.model.ts"),h=t("./src/sdk/prompts/dom.prompt.ts"),a=t("./src/sdk/prompts/custom.prompt.ts"),m=t("./src/sdk/factories/prompt.factory.ts"),v=t("./src/sdk/prompts/bell.prompt.ts"),y=t("./src/sdk/prompts/slide.prompt.ts");class f extends d.EventableModel{constructor(){super(),this.x=[],this.I={},this._wireEvents()}_wireEvents(){var s=this._handleWebPushNotSupported.bind(this);this.watch(u.EventType.WEB_PUSH_NOT_SUPPORTED,s)}_handleWebPushNotSupported(s,e,t){this.setCustomPromptUnsupportedClassname(e,t)}performManualPromptLoad(t,i){return o(this,void 0,void 0,function*(){let s;var e;(i=i||{}).id?s=this.I[i.id]:0<this.x.length&&(s=this.x[0])&&r.Logger.info(`No prompt ID specified - using already loaded prompt ${s.promptId}.`),s?(r.Logger.info(`Prompt, ${s.promptId}, is already running.`),s.bypassEligibilityCheck=void 0===i.checkEligibility||!i.checkEligibility,s.hasOwnProperty("shown")&&!s.shown&&s.run({bypassEligibilityCheck:s.bypassEligibilityCheck})):(i.id?s=this.getPromptById(t,i.id):(e=this.loadPrompts(t,{isSafari:t.env.isSafari()}),0<length&&(s=e[0])),s&&(s instanceof h.DomPrompt&&(yield s.attachToDom()),yield s.run({bypassEligibilityCheck:void 0===i.checkEligibility||!i.checkEligibility})))})}loadPrompts(s,e={}){const t=m.PromptFactory.getPrompts(s,e);return t.forEach(s=>{this._cachePrompt(s.promptId,s)}),t&&0===length&&this.dispatch(new c.EventModel(u.EventType.NO_ELIGIBLE_PROMPTS)),t}setCustomPromptUnsupportedClassname(s,e){return o(this,void 0,void 0,function*(){(yield this._locateCustomPrompt())&&this._loadUnsupportedCustomPrompt(s,e)})}getPromptById(s,e){const t={};let i;if(t.prompt=s.domain.prompts.find(s=>s.id.toString()===e.toString()),t.prompt&&(t.group=s.domain.promptGroups.find(s=>s.id.toString()===t.prompt.prompt_group_id.toString())),t.group){const o=this._selectPromptClass(t.prompt.style);i=new o(s,t)}return i}_selectPromptClass(s){return{[i.PromptStyle.Native]:l.NativePrompt,[i.PromptStyle.Slide]:y.SlidePrompt,[i.PromptStyle.Bell]:v.BellPrompt,[i.PromptStyle.Custom]:a.CustomPrompt}[s]}_cachePrompt(s,e){this.x.push(e),this.I[s]=e}_locateCustomPrompt(){return o(this,void 0,void 0,function*(){let o=0;return new Promise((t,s)=>{const i=setInterval(()=>{20<=o&&(clearInterval(i),t(!1)),o++;const s=(0,p.getDocument)();var e;s.getElementsByClassName&&(e=s.getElementsByClassName(n.DEFAULT_CLASSNAME_PROMPT_CUSTOM))&&0<e.length&&(clearInterval(i),t(!0))},500)})})}_loadUnsupportedCustomPrompt(s,e){s={app:{loadConfig:s},user:{env:e}};const t=new a.CustomPrompt(s,{},!1);t.runInUnsupportedMode()}}e.PromptService=new f},"./src/sdk/services/registration.service.ts":function(s,e,t){"use strict";var d=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.RegistrationService=void 0;const c=t("./src/sdk/constants.ts"),r=t("./src/sdk/services/helpers/apns.service-helpers.ts"),p=t("./src/sdk/services/helpers/vapid.service-helpers.ts"),h=t("./src/sdk/services/logging.service.ts"),l=t("./src/sdk/services/user.service.ts"),o=t("./src/sdk/services/worker.service.ts"),a=t("./src/sdk/utils.ts"),m=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),u=t("./src/sdk/models/events/event.model.ts"),v=t("./src/sdk/data-providers/cookie.data-provider.ts"),y=t("./src/sdk/enums/runtime-environment.enum.ts"),f=t("./src/sdk/repositories/user.repository.ts"),_=t("./src/sdk/enums/steamable-event-type.enum.ts"),i=t("./src/sdk/prompts/dom.prompt.ts"),b=t("./src/sdk/enums/event-type.enum.ts");var n=t("./src/sdk/models/events/eventable.model.ts");const g=t("./src/sdk/prompts/base.prompt.ts");class w extends n.EventableModel{constructor(){super(),this._wireEvents()}_wireEvents(){var s=this._handlePromptAllowed.bind(this),e=this._handlePromptDisabled.bind(this);this.watch(b.EventType.PROMPT_ALLOWED,s),this.watch(b.EventType.PROMPT_DISABLED,e)}_handlePromptAllowed(s,e,t){return d(this,void 0,void 0,function*(){if(!e.domain.isEventOnlyMode())return this._tryRegistration(e,t);h.Logger.warn("Prompt events are suppressed while in event only mode")})}_handlePromptDisabled(s,e,t){return d(this,void 0,void 0,function*(){var s;e.domain.isEventOnlyMode()?h.Logger.warn("Prompt events are suppressed while in event only mode"):(s=this._getPromptRegistrationData(e,t),this._handlePermissionDenied(e,s))})}tryMigration(o,n=!0){return d(this,void 0,void 0,function*(){if(o.domain.isEventOnlyMode())h.Logger.warn("Cannot try migration while in event only mode");else{let s;var e,t,i;(s=o.env.isPushManagerInScope()?yield p.VapidServiceHelpers.getToken(o):yield r.ApnsServiceHelpers.getToken(o))&&s!==o.user.token&&(h.Logger.info("Subscription token refreshed by the remote end. Migrating subscription."),"granted"===(i=yield o.user.getLocalPushPermission(o)).permission&&(o.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.PROXY||(yield o.user.isUnsubscribed(o)))||(e=yield o.user.isSubscribed(o),t=o.user.token,o.user.token=s,yield f.UserRepository.set(o.user),i=this._sendSubscriptionToRemote(o,{subscription_data:i.subscription||void 0,token:s,previous_token:t,external_id:o.user.externalId,domain_key:o.domain.domainKey,amp:o.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.AMP,migrated:!0,pushly_subscriber_data_present:e}),n&&(yield i),this.dispatch(new u.EventModel(b.EventType.REGISTRATION_MIGRATED,s))))}})}_shouldOpenProxyRegistrationWindow(s){return!s.domain.isEventOnlyMode()&&s.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.PROXY&&s.env.subRuntimeEnvironment!==y.RuntimeEnvironment.PROXY_PERMISSION_DIALOG}_tryRegistration(e,t){return d(this,void 0,void 0,function*(){var s;{if(!e.domain.isEventOnlyMode())return s=this._getPromptRegistrationData(e,t),this._shouldOpenProxyRegistrationWindow(e)?this._openProxyRegistrationWindow(e,s):this._register(e,s);h.Logger.warn("Cannot try registration while in event only mode")}})}performManualRegistrationAttempt(e,t,i){return d(this,void 0,void 0,function*(){var s;{if(!e.domain.isEventOnlyMode())return yield o.WorkerService.registerWorker(e),s=this._getPromptRegistrationData(e,{promptId:t,promptKeywords:i}),this._shouldOpenProxyRegistrationWindow(e)?this._openProxyRegistrationWindow(e,s):this._register(e,s);h.Logger.warn("Cannot perform manual registration attempt while in event only mode")}})}unsubscribe(i,o="blocked"){return d(this,void 0,void 0,function*(){if(i.domain.isEventOnlyMode())h.Logger.warn("Cannot perform unsubscribe request while in event only mode");else{const e=this._buildPromptPermissionEventPack(),t=yield i.user.getLocalPushPermission(i);var s=yield i.user.isSubscribed(i);t.subscription&&s&&i.env.isPushManagerInScope()&&i.env.primaryRuntimeEnvironment!==y.RuntimeEnvironment.PROXY&&(h.Logger.info("Processing subscription unsubscribe request"),e.meta=Object.assign(Object.assign({},e.meta),{subscription_data:t.subscription}),yield t.subscription.unsubscribe(),i.user.setPushPermission(t)),s&&(yield l.UserService.setSubscriptionState(i.user,o),this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.MANUAL_UNSUBSCRIBED,e,i)),this.dispatch(new u.EventModel(b.EventType.REGISTRATION_UNSUBSCRIBED,this._buildClientFeedbackEventPack())),h.Logger.info("User has been unsubscribed from notifications"))}})}_register(i,o){return d(this,void 0,void 0,function*(){if(i.domain.isEventOnlyMode())h.Logger.warn("Cannot perform registration while in event only mode");else{let s;var e=this._handlePermissionPrompted.bind(this,i,o);const{env:t}=i["user"];"granted"===(s=t.isPushManagerInScope()?yield p.VapidServiceHelpers.requestNotificationPermission(i,e):yield r.ApnsServiceHelpers.requestNotificationPermission(i,e)).permissionState?(yield this._handlePermissionGranted(i,o),i.domain.shouldUseVapid()&&(s=yield p.VapidServiceHelpers.handleNotificationPermissionGranted(i,s)),yield this._handleSubscriptionSuccess(i,s,o)):"default"===s.permissionState?this._handlePermissionDismissed(i,o):"denied"===s.permissionState?this._handlePermissionDenied(i,o):h.Logger.warn("Unknown")}})}_sendSubscriptionToRemote(t,i){return d(this,void 0,void 0,function*(){if(t.domain.isEventOnlyMode())h.Logger.warn("Cannot send subscription data while in event only mode");else if(t.user.subscriptionRegistered)h.Logger.warn(t,"Attempt to register subscription token more than once detected");else{const e={meta:Object.assign({},i)};var s=this.gatherAdditionalSubData(t),s=(s&&(e.meta.page_meta_properties=s),i.previous_token?e.meta.migrated=!0:e.meta.subscribed_referrer=(t.user.lastReferrerState||{}).referrer,new m.SubscriberStreamableEventModel(_.StreamableEventType.SUBSCRIBED,e,t));yield this.post(s,c.ALLOW_ENDPOINT),t.user.subscriptionRegistered=!0,yield f.UserRepository.set(t.user)}})}gatherAdditionalSubData(o){try{var s=o["domain"];const n={};if(Array.isArray(s.additionalSubscriptionData)){const e=s.additionalSubscriptionData;e.forEach(s=>{try{var e=s.profile_property;const i=s.selectors;if(e&&Array.isArray(i)){let t;i.some(s=>{var e=s.selector,s=s.value;return e&&s&&(e=o.env.document.head.querySelector(`[${e}~='${s}'][content]`),t=(e||{}).content),!!t}),t&&(n[e]=t)}}catch(s){}})}if(0<Object.keys(n).length)return n}catch(s){}}_handlePermissionPrompted(s,e){s.domain.isEventOnlyMode()?h.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_PROMPTED,Object.assign({},e.streamPack),s)),this.dispatch(new u.EventModel(b.EventType.LEGACY_PERMISSION_DIALOG_SHOWN)),this.dispatch(new u.EventModel(b.EventType.PERMISSION_DIALOG_SHOWN,e.clientPack)))}_handlePermissionGranted(s,e){return d(this,void 0,void 0,function*(){s.domain.isEventOnlyMode()?h.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_ACCEPTED,Object.assign({},e.streamPack),s)),this.dispatch(new u.EventModel(b.EventType.LEGACY_PERMISSION_GRANTED)),this.dispatch(new u.EventModel(b.EventType.PERMISSION_GRANTED,e.clientPack)))})}_handleSubscriptionSuccess(n,r,p){return d(this,void 0,void 0,function*(){if(n.domain.isEventOnlyMode())h.Logger.warn("Permission events are suppressed while in event only mode");else{h.Logger.info("Got token: "+r.token);const i=n["domain"];n.user.token=r.token;var e=n.env.isPushManagerInScope()?"fcm_subscription_id":"apns_token",t=n.env.getQueryString();let s=n.env.location.href;c.PUSHLY_SUBSCRIBED_URL_QS in t&&(s=decodeURIComponent(t[c.PUSHLY_SUBSCRIBED_URL_QS]));const o={[e]:i.shouldUseVapid()?void 0:r.token,subscription_data:r.subscription||void 0,external_id:n.user.externalId,subscribed_url:s,prompt_id:p.promptId,domain_key:n.domain.domainKey,amp:n.env.primaryRuntimeEnvironment===y.RuntimeEnvironment.AMP};p.promptId&&p.promptKeywords&&(o.tag=p.promptKeywords,o.keywords=p.promptKeywords),yield this._sendSubscriptionToRemote(n,o),l.UserService.setSubscriptionState(n.user,"subscribed",r.token),v.CookieDataProvider.set("_pnpds",window.location.hostname),this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PAGE_VIEW,{meta:{subscription_data:r.subscription}},n)),this.dispatch(new u.EventModel(b.EventType.REGISTRATION_SUBSCRIBED,r.token))}})}_handlePermissionDismissed(s,e){s.domain.isEventOnlyMode()?h.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_DISMISSED,Object.assign({},e.streamPack),s)),l.UserService.setSubscriptionState(s.user,"dismissed",null,e),this.dispatch(new u.EventModel(b.EventType.PERMISSION_DISMISSED,e.clientPack)))}_handlePermissionDenied(s,e){s.domain.isEventOnlyMode()?h.Logger.warn("Permission events are suppressed while in event only mode"):(this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PERMISSION_DENIED,Object.assign({},e.streamPack),s)),l.UserService.setSubscriptionState(s.user,"blocked",null,e),this.dispatch(new u.EventModel(b.EventType.PERMISSION_DENIED,e.clientPack)))}_getPromptRegistrationData(s,e){const t={};s=s.env.getQueryString();return e instanceof g.BasePrompt?(t.promptId=e?e.promptId:void 0,t.promptBehavior=e?e.promptConfig.behavior:void 0,e&&e instanceof i.DomPrompt&&(t.promptKeywords=e.keywords)):(t.promptId=(e||{}).promptId,t.promptKeywords=(e||{}).promptKeywords),c.PUSHLY_PROMPT_ID_QS in s&&(t.promptId=(0,a.tryParseInt)(s[c.PUSHLY_PROMPT_ID_QS])),t.streamPack=this._buildPromptPermissionEventPack(t.promptId,t.promptKeywords),t.clientPack=this._buildClientFeedbackEventPack(t.promptId,t.promptKeywords),t}_openProxyRegistrationWindow(l,u){return d(this,void 0,void 0,function*(){if(l.domain.isEventOnlyMode())h.Logger.warn("Cannot open proxy registration window while in event only mode");else{const t=l.env.document;var s=l.domain.customAllowDomain;const i=t.createElement("a");var e,s=`https://${s}/`+l.domain.domainKey;i.href=s;const o=(0,a.parseQueryString)(i.search),n=(o[c.PUSHLY_SUBSCRIBED_URL_QS]=encodeURIComponent(l.env.location.toString()),o[c.PUSHLY_UNIQUE_USER_ID_QS]=l.user.puuid,o[c.PUSHLY_DOMAIN_KEY_QS]=l.domain.domainKey,o[c.PUSHLY_PROMPT_ID_QS]=u.promptId,[]);for(e in o)n.push(e+"="+o[e]);s=`${i.protocol}//${i.host}${i.pathname}?`+n.join("&");const r=l.env.scope.open(s,"Push Notification Registration","directories=0,toolbar=0,status=0,menubar=0,width=680,height=550");if(r){this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PROXY_WINDOW_OPENED,{meta:{promptId:u.promptId}},l));const p=l.env.scope.setInterval(()=>{r.closed&&(clearInterval(p),this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PROXY_WINDOW_CLOSED,{meta:{promptId:u.promptId}},l)))},1e3)}else this.post(new m.SubscriberStreamableEventModel(_.StreamableEventType.PROXY_WINDOW_BLOCKED,{meta:{promptId:u.promptId}},l))}})}_buildPromptPermissionEventPack(s=null,e){const t={meta:{promptId:s}};return s&&e&&(t.meta.keywords=e),t}_buildClientFeedbackEventPack(s=null,e=[]){return{prompt:{id:s,keywords:e}}}}e.RegistrationService=new w},"./src/sdk/services/user-debug.service.ts":function(s,e,t){"use strict";var i=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.UserDebugService=void 0;const g=t("./src/sdk/services/logging.service.ts"),o=t("./src/_utils/global-env.ts");e.UserDebugService=class{static shouldShowDebugPanel(){var s=(0,o.getLocation)();let e=!1;try{e="search"in s&&/(^|[?&#])((pushly_debug73485)|(push(ly)?_debug))=1(?=[&#]|$)/i.test(s.search)}catch(s){}return e}static showDebugPanel(b){return i(this,void 0,void 0,function*(){b.domain;const e=b.user,t=b.env;try{const p=t.document,l=p.createElement("style");p.head.appendChild(l),l.innerHTML=`
.sw-user-debug-drawer-wrapper {
  display: block !important;
  box-sizing: border-box;
  position: absolute;
  z-index: 7777;
  bottom: 120px;
  left: -320px;
  width: 320px;
  border: 1px solid #d9d9d9;
  border-left: none;
  box-shadow: 0 1px 4px #e9e9e9;
  background: #f5f5f7;
  transition: left .24s linear;
}
.sw-user-debug-drawer-wrapper.open {
  left: 0;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-shadow {
  visibility: hidden;
  border: none;
  box-shadow: none;
  outline: none;
  position: absolute;
  z-index: -1;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-shadow.copying {
  visibility: visible;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-handle {
  cursor: pointer;
  display: block;
  box-sizing: border-box;
  position: absolute;
  background: #0077a0;
  border-radius: 0 0 12px 12px;
  border: 1px solid #888;
  border-top: none;
  top: 50%;
  transform: translateY(-50%) rotate(-90deg);
  padding: 8px 38px 8px 38px;
  right: -90px;
  box-shadow: 0 1px 3px #e9e9e9;
  color: #fff;
  font-family: arial;
  font-size: 13px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content {
  color: #545454;
  font-family: arial;
  font-size: 13px;
  padding: 14px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-label {
  color: #949494;
  display: block;
  box-sizing: border-box;
  margin-bottom: 4px;
}
.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-value {
  display: block;
  word-break: break-all;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-puuid {
  border-bottom: 1px solid #d9d9d9;
  padding: 0 12px 6px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-substate {
  border-bottom: 1px solid #d9d9d9;
  padding: 6px 12px;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-token {
  padding: 6px 12px 0;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-action-wrapper {
  text-align: right;
}

.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-copy-btn {
  display: inline-block;
  margin: 12px 12px 0;
  padding: 4px 14px;
  background: #0077a0;
  border-radius: 3px;
  color: #fff;
  transition: all .24s;
  cursor: pointer;
}
.sw-user-debug-drawer-wrapper .sw-user-debug-drawer .sw-user-debug-drawer-content .sw-user-debug-copy-btn.success {
  background: green;
}
`.trim();var i,o=e.puuid,n=e.subscriberState.toString().replace(/(^.)/,s=>s.toUpperCase()),r="subscribed"===e.subscriberState?e.token:"N/A";let s="Unable to Resolve";try{t.isPushManagerInScope()?(i=(yield b.user.getComputedPushPermission(b)).subscription)&&(s=i.endpoint):s="N/A"}catch(s){}const u=p.createElement("div"),d=(u.classList.add("sw-user-debug-drawer-wrapper"),u.setAttribute("style","display:none;"),p.createElement("div")),c=(u.appendChild(d),d.classList.add("sw-user-debug-drawer"),p.createElement("div")),h=(d.appendChild(c),c.classList.add("sw-user-debug-drawer-handle"),c.onclick=()=>{u.classList.contains("open")?u.classList.remove("open"):u.classList.add("open")},c.innerHTML=`
<span class="sw-user-debug-label">
    Push SDK
</span>
`.trim(),p.createElement("div")),a=(d.appendChild(h),h.classList.add("sw-user-debug-drawer-content"),p.createElement("div")),m=(h.appendChild(a),a.classList.add("sw-user-debug-puuid"),a.innerHTML=`
<span class="sw-user-debug-label">
    Push User ID
</span>
<span class="sw-user-debug-value">
    ${o}
</span>
`.trim(),p.createElement("div")),v=(h.appendChild(m),m.classList.add("sw-user-debug-substate"),m.innerHTML=`
<span class="sw-user-debug-label">
    Subscriber State
</span>
<span class="sw-user-debug-value">
    ${n}
</span>
`.trim(),p.createElement("div")),y=(h.appendChild(v),v.classList.add("sw-user-debug-token"),v.innerHTML=`
<span class="sw-user-debug-label">
    Subscriber Token
</span>
<span class="sw-user-debug-value">
    ${r}
</span>
`.trim(),p.createElement("input")),f=(u.appendChild(y),y.classList.add("sw-user-debug-shadow"),y.type="textarea",y.defaultValue=`
Push User ID: ${o}, \r

Subscriber State: ${n}, \r

Token: ${r}, \r

Endpoint: ${s}, \r

Browser Permissions: ${(yield b.user.getComputedPushPermission(b)).permission}, \r

UserAgent: ${t.userAgent}
`.trim(),p.createElement("div")),_=(h.appendChild(f),f.classList.add("sw-user-debug-action-wrapper"),p.createElement("div"));f.appendChild(_),_.classList.add("sw-user-debug-copy-btn"),_.innerText="Copy",_.onclick=()=>{y.classList.add("copying"),y.select(),p.execCommand("copy"),y.classList.remove("copying"),_.classList.add("success"),setTimeout(()=>{_.classList.remove("success")},240)},p.body.appendChild(u)}catch(s){g.Logger.warn(s)}})}}},"./src/sdk/services/user.service.ts":function(s,e,t){"use strict";var p=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.UserService=void 0;const r=t("./src/sdk/services/helpers/user-profile.service-helpers.ts"),i=t("./src/sdk/models/events/subscriber-streamable-event.model.ts"),l=t("./src/sdk/data-providers/cookie.data-provider.ts"),o=t("./src/sdk/repositories/subscription.repository.ts"),u=t("./src/sdk/enums/event-type.enum.ts"),d=t("./src/_utils/global-env.ts"),n=t("./src/sdk/repositories/application.repository.ts"),c=t("./src/sdk/services/logging.service.ts"),h=t("./src/sdk/services/registration.service.ts");var a=t("./src/sdk/models/events/eventable.model.ts");const m=t("./src/sdk/models/events/event.model.ts"),v=t("./src/sdk/repositories/user.repository.ts"),y=t("./src/sdk/constants.ts"),f=t("./src/sdk/enums/steamable-event-type.enum.ts"),_=t("./src/sdk/utils.ts"),b=t("./src/sdk/services/worker.service.ts");class g extends a.EventableModel{constructor(){super(...arguments),this.userProfileEventsWired=!1}loadUser(s,i){return p(this,void 0,void 0,function*(){let s=yield v.UserRepository.get();var e=!s.puuid;let t;return i.env.inWorkerGlobalScope()||(t=i.env.getQueryString()[y.PUSHLY_UNIQUE_USER_ID_QS]),s.env=i.env,e&&(s.puuid=t||(0,_.randomString)()),s.puuid&&/undefined/i.test(s.puuid.toString())&&(s.puuid=(0,_.randomString)()),i.domain.isEventOnlyMode()||!(yield v.UserRepository.getPromptDismissedState())&&s.isDismissed()&&(s.subscriberState="none"),yield v.UserRepository.set(s),s})}reloadUserWithCachePriority(e){return p(this,void 0,void 0,function*(){var s=yield v.UserRepository.getWithCachePriority();return e.puuid=s.puuid||e.puuid,e.subscriberState=s.subscriberState||e.subscriberState,e.token=s.token||e.token,e})}wireProfileEvents(e){if(!this.userProfileEventsWired){this.userProfileEventsWired=!0;const s=[u.EventType.PROFILE_UPDATE,u.EventType.PROFILE_UPDATE_EXTERNAL_ID,u.EventType.PROFILE_DEREGISTER_EXTERNAL_ID,u.EventType.PROFILE_UPDATE_USER_EVENT,u.EventType.PROFILE_UPDATE_TAGS,u.EventType.PROFILE_APPEND,u.EventType.PROFILE_REMOVE,u.EventType.PAGE_TAG_VISIT,u.EventType.VIEW_ITEM,u.EventType.SAVE_ITEM,u.EventType.ADD_TO_CART,u.EventType.UPDATE_CART_ITEM,u.EventType.PURCHASE,u.EventType.REQUEST_USER_DELETION];s.forEach(s=>{this._wireProfileEvent(e,s)})}}verifyUserSubscriptionState(r){return p(this,void 0,void 0,function*(){const e=r.env,s=r.domain,t=r.user;if(s.isEventOnlyMode())c.Logger.info("Skipping user subscription state verification while in event only mode");else{c.Logger.info("Verifying user subscription state");let s;(e.isHTTPS()||e.isDevMode())&&(s=yield r.user.getComputedPushPermission(r));var i=l.CookieDataProvider.get("_pnss"),o="subscribed"===(t.subscriberState=i),n="dismissed"===i;"blocked"===i?!(r.env.isSafari()&&"PushManager"in(0,d.getSelf)())&&s&&"denied"!==s.permission?"granted"===s.permission&&s.host===(0,d.getSelf)().location.hostname?yield h.RegistrationService.performManualRegistrationAttempt(r,t.lastSeenPromptId):"default"===s.permission&&this.setSubscriptionState(t,"none"):("blocked"!==t.subscriberState&&(t.subscriberState="blocked"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):n?s&&"default"!==s.permission?"granted"===s.permission&&s.host===(0,d.getSelf)().location.hostname?yield h.RegistrationService.performManualRegistrationAttempt(r,t.lastSeenPromptId):"denied"===s.permission&&(yield this.setSubscriptionState(t,"blocked"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):("dismissed"!==t.subscriberState&&(t.subscriberState="dismissed"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DISMISSED)),this.debugPromptNotShown(r,"user_permission_dismissed")):o?s&&"granted"!==s.permission?"default"===s.permission?(yield this.setSubscriptionState(t,"none"),yield h.RegistrationService.unsubscribe(r,"none")):"denied"===s.permission&&(t.token=null,yield h.RegistrationService.unsubscribe(r),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):"subscribed"!==t.subscriberState&&(t.subscriberState="subscribed"):s&&"default"!==s.permission?"granted"===s.permission?(t.subscriberState="subscribed",s.host===(0,d.getSelf)().location.hostname&&(yield h.RegistrationService.performManualRegistrationAttempt(r,t.lastSeenPromptId))):"denied"===s.permission&&(yield this.setSubscriptionState(t,"blocked"),this.dispatch(new m.EventModel(u.EventType.EXIT_PERMISSIONS_DENIED)),this.debugPromptNotShown(r,"user_permission_denied")):"none"!==t.subscriberState&&(t.subscriberState="none")}"none"===t.subscriberState?c.Logger.info("Subscription state is currently set to none."):"subscribed"===t.subscriberState?c.Logger.info("Subscription state is currently set to subscribed."):"dismissed"===t.subscriberState?c.Logger.info("Subscription state is currently set to dismissed."):"blocked"===t.subscriberState&&c.Logger.info("Subscription state is currently set to blocked."),yield v.UserRepository.set(t)})}setExternalId(s,e){return p(this,void 0,void 0,function*(){s.externalId=e,yield v.UserRepository.set(s)})}saveExternalId(s,e){return p(this,void 0,void 0,function*(){yield this.setExternalId(s.user,e),yield r.UserProfileServiceHelpers.saveExternalUserId(s,e)})}setToken(s,e){return p(this,void 0,void 0,function*(){s.token=e,yield v.UserRepository.set(s)})}setSubscriptionState(s,e,t,i){return p(this,void 0,void 0,function*(){c.Logger.info("Updating subscriber state to "+e),s.subscriberState=e,t?s.token=t:t=null,yield v.UserRepository.set(s),"dismissed"===s.subscriberState&&i&&(yield v.UserRepository.setPromptDismissedState(s,i))})}setLastSeenPromptId(s,e){return p(this,void 0,void 0,function*(){s.lastSeenPromptId=e,yield v.UserRepository.set(s)})}setPromptState(s,e,t,i){return p(this,void 0,void 0,function*(){s.promptFcapSeconds=e,s.promptCountState=t,yield v.UserRepository.setPromptState(s,i)})}clearPromptFcapState(){return p(this,void 0,void 0,function*(){yield v.UserRepository.clearPromptState()})}setPromptDismissed(s,e){return p(this,void 0,void 0,function*(){yield v.UserRepository.setPromptDismissedState(s,e)})}setLastReferrerState(s,e){return p(this,void 0,void 0,function*(){s.lastReferrerState={referrer:e,lastSetAt:(new Date).getTime()},yield v.UserRepository.set(s)})}clearLastReferrerState(s){return p(this,void 0,void 0,function*(){delete s.lastReferrerState,yield v.UserRepository.set(s)})}handleUdrRequest(t){return p(this,void 0,void 0,function*(){var s=t.env,e=!!s&&!!l.CookieDataProvider.get("_pnudr");l.CookieDataProvider.set("_pnudr","1"),e?c.Logger.warn("User deletion has already been requested."):(yield this.post(new i.SubscriberStreamableEventModel(f.StreamableEventType.UDR,{},t)),yield o.SubscriptionRepository.unregister(t),n.ApplicationRepository.purgeCookies(),v.UserRepository.purgeCookies(),this.dispatch(new m.EventModel(u.EventType.USER_DELETION_REQUEST,void 0,t.app.loadConfig,s)))})}handleUdrRevert(s){return p(this,void 0,void 0,function*(){l.CookieDataProvider.clear("_pnudr"),yield b.WorkerService.unregisterWorker(s),yield h.RegistrationService.performManualRegistrationAttempt(s,s.user.lastSeenPromptId),c.Logger.warn("User deletion reverted")})}processUdr(){return p(this,void 0,void 0,function*(){return v.UserRepository.purgeCookies()})}_wireProfileEvent(o,n){this.watch(n,t=>{const i=()=>p(this,void 0,void 0,function*(){if(o.app&&o.app.isLoaded){var s=yield o.user.getComputedPushPermission(o);if((s.subscription||s.deviceToken||o.domain.isEventOnlyMode())&&(yield o.user.isSubscribed(o)))try{switch(n){case u.EventType.PROFILE_UPDATE:yield r.UserProfileServiceHelpers.saveUserProfileData(o,t);break;case u.EventType.PROFILE_UPDATE_EXTERNAL_ID:yield this.setExternalId(o.user,t),yield r.UserProfileServiceHelpers.saveExternalUserId(o,t);break;case u.EventType.PROFILE_DEREGISTER_EXTERNAL_ID:yield this.setExternalId(o.user,null),yield r.UserProfileServiceHelpers.deregisterExternalUserId(o);break;case u.EventType.PROFILE_UPDATE_USER_EVENT:yield r.UserProfileServiceHelpers.saveUserEvent(o,t);break;case u.EventType.PROFILE_UPDATE_TAGS:yield r.UserProfileServiceHelpers.saveUserTags(o,t);break;case u.EventType.PROFILE_APPEND:yield r.UserProfileServiceHelpers.appendProfileArrayValue(o,t);break;case u.EventType.PROFILE_REMOVE:yield r.UserProfileServiceHelpers.removeProfileArrayValue(o,t);break;case u.EventType.PAGE_TAG_VISIT:t=Array.isArray(t)?t:[t],yield r.UserProfileServiceHelpers.pageTagVisit(o,t);break;case u.EventType.VIEW_ITEM:yield r.UserProfileServiceHelpers.viewItem(o,t);break;case u.EventType.SAVE_ITEM:yield r.UserProfileServiceHelpers.saveItem(o,t);break;case u.EventType.ADD_TO_CART:yield r.UserProfileServiceHelpers.addToCart(o,t);break;case u.EventType.UPDATE_CART_ITEM:yield r.UserProfileServiceHelpers.updateCartItem(o,t);break;case u.EventType.PURCHASE:yield r.UserProfileServiceHelpers.purchase(o,t);break;case u.EventType.REQUEST_USER_DELETION:yield this.handleUdrRequest(o)}}catch(s){c.Logger.error(o,s)}else{let s=!0,e;if(n===u.EventType.PROFILE_UPDATE_EXTERNAL_ID?(e=t,s=!1):t instanceof Object&&"external_id"in t&&(e=t.external_id),e&&(yield this.setExternalId(o.user,e)),s){let s,e;s=this.watchOnce(u.EventType.REGISTRATION_SUBSCRIBED,()=>{e&&e(),i()}),e=this.watchOnce(u.EventType.REGISTRATION_MIGRATED,()=>{s&&s(),i()})}}}else this.watchOnce(u.EventType.APPLICATION_LOADED,i)});i()})}}e.UserService=new g},"./src/sdk/services/worker.service.ts":function(s,e,t){"use strict";var o=this&&this.__awaiter||function(s,r,p,l){return new(p=p||Promise)(function(t,e){function i(s){try{n(l.next(s))}catch(s){e(s)}}function o(s){try{n(l.throw(s))}catch(s){e(s)}}function n(s){var e;s.done?t(s.value):((e=s.value)instanceof p?e:new p(function(s){s(e)})).then(i,o)}n((l=l.apply(s,r||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerService=void 0;const n=t("./src/sdk/constants.ts"),r=t("./src/sdk/services/logging.service.ts"),i=t("./src/_utils/service-worker-registration.ts"),p=t("./src/sdk/models/events/event.model.ts"),l=t("./src/sdk/enums/event-type.enum.ts"),u=t("./src/sdk/repositories/application.repository.ts");var d=t("./src/sdk/models/events/eventable.model.ts");const c=t("./src/sdk/exceptions/worker-registration.exception.ts");class h extends d.EventableModel{_installPushlyServiceWorker(t){return o(this,void 0,void 0,function*(){const s=t.env.navigator;var e=(0,i.getPushlyWorkerConfig)(t);return s.serviceWorker.register(e.installationPath,{updateViaCache:"none",scope:e.scope})})}unregisterWorker(e){return o(this,void 0,void 0,function*(){const s=yield(0,i.getPushlyServiceWorkerRegistration)(e);s&&(yield s.unregister())})}registerWorker(e){return o(this,void 0,void 0,function*(){let s=null;try{(s=yield(0,i.getPushlyServiceWorkerRegistration)(e))||(r.Logger.info("Registering new ServiceWorker"),s=yield this._installPushlyServiceWorker(e),this.dispatch(new p.EventModel(l.EventType.SW_INSTALLED,{registration:s}))),yield u.ApplicationRepository.set(e.app),this.dispatch(new p.EventModel(l.EventType.SW_SETUP_COMPLETE,{registration:s}))}catch(s){throw r.Logger.warn({type:s.type,code:s.code,message:s.message,error:s}),new c.WorkerRegistrationException(s)}return s})}loadServiceWorkerDependencyScript(i){return o(this,void 0,void 0,function*(){const s=i.env.document;if(s&&s.body){const e=s.createElement("script"),t=(e.onload=()=>{r.Logger.info("ServiceWorker dependency script loaded")},e.async=!0,e.src=n.SW_DEPENDENCY_URL,s.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}})}}e.WorkerService=new h},"./src/sdk/utils.ts":(s,e,t)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tryParseJSON=e.parseQueryString=e.hashFromString=e.isProductionBuild=e.simpleUnHash=e.simpleHash=e.atobShim=e.delayRandom=e.delay=e.tryParseInt=e.randomString=e.retryFetch=void 0;var i=t("./src/common/utils.ts");Object.defineProperty(e,"retryFetch",{enumerable:!0,get:function(){return i.retryFetch}}),Object.defineProperty(e,"randomString",{enumerable:!0,get:function(){return i.randomString}}),Object.defineProperty(e,"tryParseInt",{enumerable:!0,get:function(){return i.tryParseInt}}),Object.defineProperty(e,"delay",{enumerable:!0,get:function(){return i.delay}}),Object.defineProperty(e,"delayRandom",{enumerable:!0,get:function(){return i.delayRandom}});const o=t("./src/sdk/constants.ts");e.atobShim=s=>{let e="";try{if("string"==typeof(e=window.atob(s)))return e}catch(s){}e="";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(s=String(s).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(s))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");s+="==".slice(2-(3&s.length));let i,o,n,r=0;for(;r<s.length;)i=t.indexOf(s.charAt(r++))<<18|t.indexOf(s.charAt(r++))<<12|(o=t.indexOf(s.charAt(r++)))<<6|(n=t.indexOf(s.charAt(r++))),e+=64===o?String.fromCharCode(i>>16&255):64===n?String.fromCharCode(i>>16&255,i>>8&255):String.fromCharCode(i>>16&255,i>>8&255,255&i);return e},e.simpleHash=s=>window.btoa(JSON.stringify(s)),e.simpleUnHash=s=>(0,e.tryParseJSON)((0,e.atobShim)(s)),e.isProductionBuild=()=>"production"===o.ENV_NAME||"prod"===o.ENV_NAME,e.hashFromString=s=>{let e=5381,t=s.length;for(;t;)e=33*e^s.charCodeAt(--t);return e>>>0},e.parseQueryString=s=>{s=s.split("?").pop().split("&");let e={};try{for(var t of s){const i=t.split("=");i[0]&&(i[1]=i[1]?i[1].replace(/\+/gi," "):"",e[i[0]]=decodeURIComponent(i[1]))}}catch(s){}return e};e.tryParseJSON=s=>{let e;try{e=JSON.parse(s)}catch(s){}return e}}},i={};function p(s){var e=i[s];if(void 0!==e)return e.exports;e=i[s]={id:s,exports:{}};return t[s].call(e.exports,e,e.exports,p),e.exports}p.n=s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return p.d(e,{a:e}),e},p.d=(s,e)=>{for(var t in e)p.o(e,t)&&!p.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})},p.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),p.r=s=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},p.nc=void 0;var l={};(()=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});var e=p("./src/sdk/exceptions/pushly.exception.ts");const s=p("./src/sdk/models/context.model.ts"),t=p("./src/sdk/sdk.ts"),i=p("./src/sdk/services/logging.service.ts");try{const r=new t.SDK(new s.ContextModel);var o=window.PushlySDK;if(o&&o instanceof Array)for(var n of o)r.push(n);window.PushlySDK=r}catch(s){if(!(s instanceof e.PushlyException))throw s;console.log(s),i.Logger.warn("[pushly-sdk]",s.message)}})()})();

(function(){
if (document.location.pathname != '/') {
    PushlySDK.watch('ready', () => {
        const qs = document.querySelector('meta[name="keywords"]');
        if (qs && qs.content) {
            PushlySDK.push(['page_tag_visit', qs.content.split(',').map(v => v.trim())]);
        }
    });
}

})();